!function(t){"use strict";const e="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},n="1.4.0",r=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;const s=function(t){const e=new Set([t]),n=new Set,s=t.match(r);if(!s)return()=>!1;const i=+s[1],o=+s[2],a=+s[3];if(null!=s[4])return function(e){return e===t};function c(t){return n.add(t),!1}function u(t){return e.add(t),!0}return function(t){if(e.has(t))return!0;if(n.has(t))return!1;const s=t.match(r);if(!s)return c(t);const l=+s[1],d=+s[2],h=+s[3];return null!=s[4]||i!==l?c(t):0===i?o===d&&a<=h?u(t):c(t):o<=d?u(t):c(t)}}(n),i=n.split(".")[0],o=Symbol.for(`opentelemetry.js.api.${i}`),a=e;function c(t,e,r,s=!1){var i;const c=a[o]=null!==(i=a[o])&&void 0!==i?i:{version:n};if(!s&&c[t]){const e=new Error(`@opentelemetry/api: Attempted duplicate registration of API: ${t}`);return r.error(e.stack||e.message),!1}if(c.version!==n){const t=new Error("@opentelemetry/api: All API registration versions must match");return r.error(t.stack||t.message),!1}return c[t]=e,r.debug(`@opentelemetry/api: Registered a global for ${t} v1.4.0.`),!0}function u(t){var e,n;const r=null===(e=a[o])||void 0===e?void 0:e.version;if(r&&s(r))return null===(n=a[o])||void 0===n?void 0:n[t]}function l(t,e){e.debug(`@opentelemetry/api: Unregistering a global for ${t} v1.4.0.`);const n=a[o];n&&delete n[t]}class d{constructor(t){this._namespace=t.namespace||"DiagComponentLogger"}debug(...t){return h("debug",this._namespace,t)}error(...t){return h("error",this._namespace,t)}info(...t){return h("info",this._namespace,t)}warn(...t){return h("warn",this._namespace,t)}verbose(...t){return h("verbose",this._namespace,t)}}function h(t,e,n){const r=u("diag");if(r)return n.unshift(e),r[t](...n)}var p;!function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"}(p||(p={}));class _{constructor(){function t(t){return function(...e){const n=u("diag");if(n)return n[t](...e)}}const e=this;e.setLogger=(t,n={logLevel:p.INFO})=>{var r,s,i;if(t===e){const t=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return e.error(null!==(r=t.stack)&&void 0!==r?r:t.message),!1}"number"==typeof n&&(n={logLevel:n});const o=u("diag"),a=function(t,e){function n(n,r){const s=e[n];return"function"==typeof s&&t>=r?s.bind(e):function(){}}return t<p.NONE?t=p.NONE:t>p.ALL&&(t=p.ALL),e=e||{},{error:n("error",p.ERROR),warn:n("warn",p.WARN),info:n("info",p.INFO),debug:n("debug",p.DEBUG),verbose:n("verbose",p.VERBOSE)}}(null!==(s=n.logLevel)&&void 0!==s?s:p.INFO,t);if(o&&!n.suppressOverrideMessage){const t=null!==(i=(new Error).stack)&&void 0!==i?i:"<failed to generate stacktrace>";o.warn(`Current logger will be overwritten from ${t}`),a.warn(`Current logger will overwrite one already registered from ${t}`)}return c("diag",a,e,!0)},e.disable=()=>{l("diag",e)},e.createComponentLogger=t=>new d(t),e.verbose=t("verbose"),e.debug=t("debug"),e.info=t("info"),e.warn=t("warn"),e.error=t("error")}static instance(){return this._instance||(this._instance=new _),this._instance}}class E{constructor(t){this._entries=t?new Map(t):new Map}getEntry(t){const e=this._entries.get(t);if(e)return Object.assign({},e)}getAllEntries(){return Array.from(this._entries.entries()).map((([t,e])=>[t,e]))}setEntry(t,e){const n=new E(this._entries);return n._entries.set(t,e),n}removeEntry(t){const e=new E(this._entries);return e._entries.delete(t),e}removeEntries(...t){const e=new E(this._entries);for(const n of t)e._entries.delete(n);return e}clear(){return new E}}const m=Symbol("BaggageEntryMetadata"),T=_.instance();function f(t={}){return new E(new Map(Object.entries(t)))}function g(t){return"string"!=typeof t&&(T.error("Cannot create baggage metadata from unknown type: "+typeof t),t=""),{__TYPE__:m,toString:()=>t}}function v(t){return Symbol.for(t)}class S{constructor(t){const e=this;e._currentContext=t?new Map(t):new Map,e.getValue=t=>e._currentContext.get(t),e.setValue=(t,n)=>{const r=new S(e._currentContext);return r._currentContext.set(t,n),r},e.deleteValue=t=>{const n=new S(e._currentContext);return n._currentContext.delete(t),n}}}const R=new S,O=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}];class b{}class L{addCallback(t){}removeCallback(t){}}const A=new class{constructor(){}createHistogram(t,e){return y}createCounter(t,e){return N}createUpDownCounter(t,e){return w}createObservableGauge(t,e){return I}createObservableCounter(t,e){return P}createObservableUpDownCounter(t,e){return C}addBatchObservableCallback(t,e){}removeBatchObservableCallback(t){}},N=new class extends b{add(t,e){}},y=new class extends b{record(t,e){}},w=new class extends b{add(t,e){}},P=new class extends L{},I=new class extends L{},C=new class extends L{};var M;!function(t){t[t.INT=0]="INT",t[t.DOUBLE=1]="DOUBLE"}(M||(M={}));const U={get(t,e){if(null!=t)return t[e]},keys:t=>null==t?[]:Object.keys(t)},D={set(t,e,n){null!=t&&(t[e]=n)}};const x="context",B=new class{active(){return R}with(t,e,n,...r){return e.call(n,...r)}bind(t,e){return e}enable(){return this}disable(){return this}};class k{constructor(){}static getInstance(){return this._instance||(this._instance=new k),this._instance}setGlobalContextManager(t){return c(x,t,_.instance())}active(){return this._getContextManager().active()}with(t,e,n,...r){return this._getContextManager().with(t,e,n,...r)}bind(t,e){return this._getContextManager().bind(t,e)}_getContextManager(){return u(x)||B}disable(){this._getContextManager().disable(),l(x,_.instance())}}var V;!function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"}(V||(V={}));const F="0000000000000000",j="00000000000000000000000000000000",H={traceId:j,spanId:F,traceFlags:V.NONE};class ${constructor(t=H){this._spanContext=t}spanContext(){return this._spanContext}setAttribute(t,e){return this}setAttributes(t){return this}addEvent(t,e){return this}setStatus(t){return this}updateName(t){return this}end(t){}isRecording(){return!1}recordException(t,e){}}const G=v("OpenTelemetry Context Key SPAN");function X(t){return t.getValue(G)||void 0}function Y(){return X(k.getInstance().active())}function z(t,e){return t.setValue(G,e)}function W(t){return t.deleteValue(G)}function q(t,e){return z(t,new $(e))}function K(t){var e;return null===(e=X(t))||void 0===e?void 0:e.spanContext()}const Q=/^([0-9a-f]{32})$/i,J=/^[0-9a-f]{16}$/i;function Z(t){return Q.test(t)&&t!==j}function tt(t){return J.test(t)&&t!==F}function et(t){return Z(t.traceId)&&tt(t.spanId)}function nt(t){return new $(t)}const rt=k.getInstance();class st{startSpan(t,e,n=rt.active()){if(Boolean(null==e?void 0:e.root))return new $;const r=n&&K(n);return"object"==typeof(s=r)&&"string"==typeof s.spanId&&"string"==typeof s.traceId&&"number"==typeof s.traceFlags&&et(r)?new $(r):new $;var s}startActiveSpan(t,e,n,r){let s,i,o;if(arguments.length<2)return;2===arguments.length?o=e:3===arguments.length?(s=e,o=n):(s=e,i=n,o=r);const a=null!=i?i:rt.active(),c=this.startSpan(t,s,a),u=z(a,c);return rt.with(u,o,void 0,c)}}const it=new st;class ot{constructor(t,e,n,r){this._provider=t,this.name=e,this.version=n,this.options=r}startSpan(t,e,n){return this._getTracer().startSpan(t,e,n)}startActiveSpan(t,e,n,r){const s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)}_getTracer(){if(this._delegate)return this._delegate;const t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):it}}const at=new class{getTracer(t,e,n){return new st}};class ct{getTracer(t,e,n){var r;return null!==(r=this.getDelegateTracer(t,e,n))&&void 0!==r?r:new ot(this,t,e,n)}getDelegate(){var t;return null!==(t=this._delegate)&&void 0!==t?t:at}setDelegate(t){this._delegate=t}getDelegateTracer(t,e,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(t,e,n)}}var ut,lt,dt;!function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(ut||(ut={})),function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"}(lt||(lt={})),function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"}(dt||(dt={}));const ht=new RegExp("^(?:[a-z][_0-9a-z-*/]{0,255}|[a-z0-9][_0-9a-z-*/]{0,240}@[a-z][_0-9a-z-*/]{0,13})$"),pt=/^[ -~]{0,255}[!-~]$/,_t=/,|=/;class Et{constructor(t){this._internalState=new Map,t&&this._parse(t)}set(t,e){const n=this._clone();return n._internalState.has(t)&&n._internalState.delete(t),n._internalState.set(t,e),n}unset(t){const e=this._clone();return e._internalState.delete(t),e}get(t){return this._internalState.get(t)}serialize(){return this._keys().reduce(((t,e)=>(t.push(e+"="+this.get(e)),t)),[]).join(",")}_parse(t){t.length>512||(this._internalState=t.split(",").reverse().reduce(((t,e)=>{const n=e.trim(),r=n.indexOf("=");if(-1!==r){const s=n.slice(0,r),i=n.slice(r+1,e.length);(function(t){return ht.test(t)})(s)&&function(t){return pt.test(t)&&!_t.test(t)}(i)&&t.set(s,i)}return t}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const t=new Et;return t._internalState=new Map(this._internalState),t}}const mt=k.getInstance(),Tt=_.instance();const ft=new class{getMeter(t,e,n){return A}},gt="metrics";class vt{constructor(){}static getInstance(){return this._instance||(this._instance=new vt),this._instance}setGlobalMeterProvider(t){return c(gt,t,_.instance())}getMeterProvider(){return u(gt)||ft}getMeter(t,e,n){return this.getMeterProvider().getMeter(t,e,n)}disable(){l(gt,_.instance())}}const St=vt.getInstance();const Rt=v("OpenTelemetry Baggage Key");function Ot(t){return t.getValue(Rt)||void 0}function bt(){return Ot(k.getInstance().active())}function Lt(t,e){return t.setValue(Rt,e)}function At(t){return t.deleteValue(Rt)}const Nt="propagation",yt=new class{inject(t,e){}extract(t,e){return t}fields(){return[]}};class wt{constructor(){this.createBaggage=f,this.getBaggage=Ot,this.getActiveBaggage=bt,this.setBaggage=Lt,this.deleteBaggage=At}static getInstance(){return this._instance||(this._instance=new wt),this._instance}setGlobalPropagator(t){return c(Nt,t,_.instance())}inject(t,e,n=D){return this._getGlobalPropagator().inject(t,e,n)}extract(t,e,n=U){return this._getGlobalPropagator().extract(t,e,n)}fields(){return this._getGlobalPropagator().fields()}disable(){l(Nt,_.instance())}_getGlobalPropagator(){return u(Nt)||yt}}const Pt=wt.getInstance(),It="trace";class Ct{constructor(){this._proxyTracerProvider=new ct,this.wrapSpanContext=nt,this.isSpanContextValid=et,this.deleteSpan=W,this.getSpan=X,this.getActiveSpan=Y,this.getSpanContext=K,this.setSpan=z,this.setSpanContext=q}static getInstance(){return this._instance||(this._instance=new Ct),this._instance}setGlobalTracerProvider(t){const e=c(It,this._proxyTracerProvider,_.instance());return e&&this._proxyTracerProvider.setDelegate(t),e}getTracerProvider(){return u(It)||this._proxyTracerProvider}getTracer(t,e){return this.getTracerProvider().getTracer(t,e)}disable(){l(It,_.instance()),this._proxyTracerProvider=new ct}}const Mt=Ct.getInstance();var Ut={context:mt,diag:Tt,metrics:St,propagation:Pt,trace:Mt},Dt=Object.freeze({__proto__:null,context:mt,diag:Tt,metrics:St,propagation:Pt,trace:Mt,default:Ut,baggageEntryMetadataFromString:g,createContextKey:v,ROOT_CONTEXT:R,DiagConsoleLogger:class{constructor(){function t(t){return function(...e){if(console){let n=console[t];if("function"!=typeof n&&(n=console.log),"function"==typeof n)return n.apply(console,e)}}}for(let e=0;e<O.length;e++)this[O[e].n]=t(O[e].c)}},get DiagLogLevel(){return p},createNoopMeter:function(){return A},get ValueType(){return M},defaultTextMapGetter:U,defaultTextMapSetter:D,ProxyTracer:ot,ProxyTracerProvider:ct,get SamplingDecision(){return ut},get SpanKind(){return lt},get SpanStatusCode(){return dt},get TraceFlags(){return V},createTraceState:function(t){return new Et(t)},isSpanContextValid:et,isValidTraceId:Z,isValidSpanId:tt,INVALID_SPANID:F,INVALID_TRACEID:j,INVALID_SPAN_CONTEXT:H});const xt=v("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function Bt(t){return!0===t.getValue(xt)}const kt=",",Vt="baggage";function Ft(t){const e=t.split(";");if(e.length<=0)return;const n=e.shift();if(!n)return;const r=n.split("=");if(2!==r.length)return;const s=decodeURIComponent(r[0].trim()),i=decodeURIComponent(r[1].trim());let o;return e.length>0&&(o=g(e.join(";"))),{key:s,value:i,metadata:o}}function jt(t){return"string"!=typeof t||0===t.length?{}:t.split(kt).map((t=>Ft(t))).filter((t=>void 0!==t&&t.value.length>0)).reduce(((t,e)=>(t[e.key]=e.value,t)),{})}class Ht{inject(t,e,n){const r=Pt.getBaggage(t);if(!r||Bt(t))return;const s=function(t){return t.reduce(((t,e)=>{const n=`${t}${""!==t?kt:""}${e}`;return n.length>8192?t:n}),"")}(function(t){return t.getAllEntries().map((([t,e])=>{let n=`${encodeURIComponent(t)}=${encodeURIComponent(e.value)}`;return void 0!==e.metadata&&(n+=";"+e.metadata.toString()),n}))}(r).filter((t=>t.length<=4096)).slice(0,180));s.length>0&&n.set(e,Vt,s)}extract(t,e,n){const r=n.get(e,Vt),s=Array.isArray(r)?r.join(kt):r;if(!s)return t;const i={};if(0===s.length)return t;return s.split(kt).forEach((t=>{const e=Ft(t);if(e){const t={value:e.value};e.metadata&&(t.metadata=e.metadata),i[e.key]=t}})),0===Object.entries(i).length?t:Pt.setBaggage(t,Pt.createBaggage(i))}fields(){return[Vt]}}function $t(t){const e={};if("object"!=typeof t||null==t)return e;for(const[n,r]of Object.entries(t))Gt(n)?Xt(r)?Array.isArray(r)?e[n]=r.slice():e[n]=r:Tt.warn(`Invalid attribute value set for key: ${n}`):Tt.warn(`Invalid attribute key: ${n}`);return e}function Gt(t){return"string"==typeof t&&t.length>0}function Xt(t){return null==t||(Array.isArray(t)?function(t){let e;for(const n of t)if(null!=n){if(!e){if(Yt(n)){e=typeof n;continue}return!1}if(typeof n!==e)return!1}return!0}(t):Yt(t))}function Yt(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}let zt=t=>{Tt.error(function(t){return"string"==typeof t?t:JSON.stringify(function(t){const e={};let n=t;for(;null!==n;)Object.getOwnPropertyNames(n).forEach((t=>{if(e[t])return;const r=n[t];r&&(e[t]=String(r))})),n=Object.getPrototypeOf(n);return e}(t))}(t))};function Wt(t){try{zt(t)}catch(t){}}var qt;!function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"}(qt||(qt={}));const Kt="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},Qt=["OTEL_SDK_DISABLED"];function Jt(t){return Qt.indexOf(t)>-1}const Zt=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function te(t){return Zt.indexOf(t)>-1}const ee=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function ne(t){return ee.indexOf(t)>-1}const re=1/0,se={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:p.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:re,OTEL_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:re,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:qt.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};function ie(t,e,n){if(void 0===n[t])return;const r=String(n[t]);e[t]="true"===r.toLowerCase()}function oe(t,e,n,r=-1/0,s=1/0){if(void 0!==n[t]){const i=Number(n[t]);isNaN(i)||(e[t]=i<r?r:i>s?s:i)}}function ae(t,e,n,r=","){const s=n[t];"string"==typeof s&&(e[t]=s.split(r).map((t=>t.trim())))}const ce={ALL:p.ALL,VERBOSE:p.VERBOSE,DEBUG:p.DEBUG,INFO:p.INFO,WARN:p.WARN,ERROR:p.ERROR,NONE:p.NONE};function ue(t,e,n){const r=n[t];if("string"==typeof r){const n=ce[r.toUpperCase()];null!=n&&(e[t]=n)}}function le(t){const e={};for(const n in se){const r=n;switch(r){case"OTEL_LOG_LEVEL":ue(r,e,t);break;default:if(Jt(r))ie(r,e,t);else if(te(r))oe(r,e,t);else if(ne(r))ae(r,e,t);else{const n=t[r];null!=n&&(e[r]=String(n))}}}return e}function de(){const t=le(Kt);return Object.assign({},se,t)}function he(t){const e=t.length;let n="";for(let r=0;r<e;r+=2){const e=t.substring(r,r+2),s=parseInt(e,16);n+=String.fromCharCode(s)}return btoa(n)}const pe=Array(32);function _e(t){return function(){for(let e=0;e<2*t;e++)pe[e]=Math.floor(16*Math.random())+48,pe[e]>=58&&(pe[e]+=39);return String.fromCharCode.apply(null,pe.slice(0,2*t))}}const Ee=performance,me="exception.type",Te="exception.message",fe="exception.stacktrace",ge="http.method",ve="http.url",Se="http.host",Re="http.scheme",Oe="http.status_code",be="http.user_agent",Le="http.response_content_length",Ae="http.response_content_length_uncompressed",Ne="deployment.environment",ye="service.name",we="telemetry.sdk.name",Pe="telemetry.sdk.language",Ie="telemetry.sdk.version",Ce={[we]:"opentelemetry",["process.runtime.name"]:"browser",[Pe]:"webjs",[Ie]:"1.9.0"};const Me=Math.pow(10,6),Ue=Math.pow(10,9);function De(t){const e=t/1e3;return[Math.trunc(e),Math.round(t%1e3*Me)]}function xe(){let t=Ee.timeOrigin;if("number"!=typeof t){const e=Ee;t=e.timing&&e.timing.fetchStart}return t}function Be(t){return He(De(xe()),De("number"==typeof t?t:Ee.now()))}function ke(t){if(Fe(t))return t;if("number"==typeof t)return t<xe()?Be(t):De(t);if(t instanceof Date)return De(t.getTime());throw TypeError("Invalid input type")}function Ve(t){return t[0]*Ue+t[1]}function Fe(t){return Array.isArray(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]}function je(t){return Fe(t)||"number"==typeof t||t instanceof Date}function He(t,e){const n=[t[0]+e[0],t[1]+e[1]];return n[1]>=Ue&&(n[1]-=Ue,n[0]+=1),n}var $e;!function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"}($e||($e={}));class Ge{constructor(t={}){var e;this._propagators=null!==(e=t.propagators)&&void 0!==e?e:[],this._fields=Array.from(new Set(this._propagators.map((t=>"function"==typeof t.fields?t.fields():[])).reduce(((t,e)=>t.concat(e)),[])))}inject(t,e,n){for(const r of this._propagators)try{r.inject(t,e,n)}catch(t){Tt.warn(`Failed to inject with ${r.constructor.name}. Err: ${t.message}`)}}extract(t,e,n){return this._propagators.reduce(((t,r)=>{try{return r.extract(t,e,n)}catch(t){Tt.warn(`Failed to inject with ${r.constructor.name}. Err: ${t.message}`)}return t}),t)}fields(){return this._fields.slice()}}const Xe=new RegExp("^(?:[a-z][_0-9a-z-*/]{0,255}|[a-z0-9][_0-9a-z-*/]{0,240}@[a-z][_0-9a-z-*/]{0,13})$"),Ye=/^[ -~]{0,255}[!-~]$/,ze=/,|=/;class We{constructor(t){this._internalState=new Map,t&&this._parse(t)}set(t,e){const n=this._clone();return n._internalState.has(t)&&n._internalState.delete(t),n._internalState.set(t,e),n}unset(t){const e=this._clone();return e._internalState.delete(t),e}get(t){return this._internalState.get(t)}serialize(){return this._keys().reduce(((t,e)=>(t.push(e+"="+this.get(e)),t)),[]).join(",")}_parse(t){t.length>512||(this._internalState=t.split(",").reverse().reduce(((t,e)=>{const n=e.trim(),r=n.indexOf("=");if(-1!==r){const s=n.slice(0,r),i=n.slice(r+1,e.length);(function(t){return Xe.test(t)})(s)&&function(t){return Ye.test(t)&&!ze.test(t)}(i)&&t.set(s,i)}return t}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const t=new We;return t._internalState=new Map(this._internalState),t}}const qe="traceparent",Ke="tracestate",Qe=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");class Je{inject(t,e,n){const r=Mt.getSpanContext(t);if(!r||Bt(t)||!et(r))return;const s=`00-${r.traceId}-${r.spanId}-0${Number(r.traceFlags||V.NONE).toString(16)}`;n.set(e,qe,s),r.traceState&&n.set(e,Ke,r.traceState.serialize())}extract(t,e,n){const r=n.get(e,qe);if(!r)return t;const s=Array.isArray(r)?r[0]:r;if("string"!=typeof s)return t;const i=function(t){const e=Qe.exec(t);return e?"00"===e[1]&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}:null}(s);if(!i)return t;i.isRemote=!0;const o=n.get(e,Ke);if(o){const t=Array.isArray(o)?o.join(","):o;i.traceState=new We("string"==typeof t?t:void 0)}return Mt.setSpanContext(t,i)}fields(){return[qe,Ke]}}var Ze;!function(t){t.HTTP="http"}(Ze||(Ze={}));const tn="[object Null]",en="[object Undefined]",nn=Function.prototype.toString,rn=nn.call(Object),sn=(on=Object.getPrototypeOf,an=Object,function(t){return on(an(t))});var on,an;const cn=Object.prototype,un=cn.hasOwnProperty,ln=Symbol?Symbol.toStringTag:void 0,dn=cn.toString;function hn(t){if(!function(t){return null!=t&&"object"==typeof t}(t)||"[object Object]"!==function(t){if(null==t)return void 0===t?en:tn;return ln&&ln in Object(t)?function(t){const e=un.call(t,ln),n=t[ln];let r=!1;try{t[ln]=void 0,r=!0}catch(t){}const s=dn.call(t);r&&(e?t[ln]=n:delete t[ln]);return s}(t):function(t){return dn.call(t)}(t)}(t))return!1;const e=sn(t);if(null===e)return!0;const n=un.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&nn.call(n)===rn}function pn(t){return mn(t)?t.slice():t}function _n(t,e,n=0,r){let s;if(!(n>20)){if(n++,gn(t)||gn(e)||Tn(e))s=pn(e);else if(mn(t)){if(s=t.slice(),mn(e))for(let t=0,n=e.length;t<n;t++)s.push(pn(e[t]));else if(fn(e)){const t=Object.keys(e);for(let n=0,r=t.length;n<r;n++){const r=t[n];s[r]=pn(e[r])}}}else if(fn(t))if(fn(e)){if(!function(t,e){if(!hn(t)||!hn(e))return!1;return!0}(t,e))return e;s=Object.assign({},t);const i=Object.keys(e);for(let o=0,a=i.length;o<a;o++){const a=i[o],c=e[a];if(gn(c))void 0===c?delete s[a]:s[a]=c;else{const i=s[a],o=c;if(En(t,a,r)||En(e,a,r))delete s[a];else{if(fn(i)&&fn(o)){const n=r.get(i)||[],s=r.get(o)||[];n.push({obj:t,key:a}),s.push({obj:e,key:a}),r.set(i,n),r.set(o,s)}s[a]=_n(s[a],c,n,r)}}}}else s=e;return s}}function En(t,e,n){const r=n.get(t[e])||[];for(let n=0,s=r.length;n<s;n++){const s=r[n];if(s.key===e&&s.obj===t)return!0}return!1}function mn(t){return Array.isArray(t)}function Tn(t){return"function"==typeof t}function fn(t){return!gn(t)&&!mn(t)&&!Tn(t)&&"object"==typeof t}function gn(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||void 0===t||t instanceof Date||t instanceof RegExp||null===t}function vn(t,e){return"string"==typeof e?t===e:!!t.match(e)}function Sn(t,e){if(!e)return!1;for(const n of e)if(vn(t,n))return!0;return!1}class Rn{constructor(){this._promise=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}get promise(){return this._promise}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}class On{constructor(t,e){this._callback=t,this._that=e,this._isCalled=!1,this._deferred=new Rn}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...t){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...t)).then((t=>this._deferred.resolve(t)),(t=>this._deferred.reject(t)))}catch(t){this._deferred.reject(t)}}return this._deferred.promise}}class bn{constructor(t,e,n,r,s,i,o=[],a,c){this.attributes={},this.links=[],this.events=[],this.status={code:dt.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=n,this._spanContext=r,this.parentSpanId=i,this.kind=s,this.links=o;const u=Date.now();this._performanceStartTime=Ee.now(),this._performanceOffset=u-(this._performanceStartTime+xe()),this._startTimeProvided=null!=a,this.startTime=this._getTime(null!=a?a:u),this.resource=t.resource,this.instrumentationLibrary=t.instrumentationLibrary,this._spanLimits=t.getSpanLimits(),this._spanProcessor=t.getActiveSpanProcessor(),this._spanProcessor.onStart(this,e),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0}spanContext(){return this._spanContext}setAttribute(t,e){return null==e||this._isSpanEnded()?this:0===t.length?(Tt.warn(`Invalid attribute key: ${t}`),this):Xt(e)?(Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,t)||(this.attributes[t]=this._truncateToSize(e)),this):(Tt.warn(`Invalid attribute value set for key: ${t}`),this)}setAttributes(t){for(const[e,n]of Object.entries(t))this.setAttribute(e,n);return this}addEvent(t,e,n){if(this._isSpanEnded())return this;if(0===this._spanLimits.eventCountLimit)return Tt.warn("No events allowed."),this;this.events.length>=this._spanLimits.eventCountLimit&&(Tt.warn("Dropping extra events."),this.events.shift()),je(e)&&(je(n)||(n=e),e=void 0);const r=$t(e);return this.events.push({name:t,attributes:r,time:this._getTime(n)}),this}setStatus(t){return this._isSpanEnded()||(this.status=t),this}updateName(t){return this._isSpanEnded()||(this.name=t),this}end(t){this._isSpanEnded()?Tt.error("You can only call end() on a span once."):(this._ended=!0,this.endTime=this._getTime(t),this._duration=function(t,e){let n=e[0]-t[0],r=e[1]-t[1];return r<0&&(n-=1,r+=Ue),[n,r]}(this.startTime,this.endTime),this._duration[0]<0&&(Tt.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._spanProcessor.onEnd(this))}_getTime(t){if("number"==typeof t&&t<Ee.now())return Be(t+this._performanceOffset);if("number"==typeof t)return De(t);if(t instanceof Date)return De(t.getTime());if(Fe(t))return t;if(this._startTimeProvided)return De(Date.now());const e=Ee.now()-this._performanceStartTime;return He(this.startTime,De(e))}isRecording(){return!1===this._ended}recordException(t,e){const n={};"string"==typeof t?n[Te]=t:t&&(t.code?n[me]=t.code.toString():t.name&&(n[me]=t.name),t.message&&(n[Te]=t.message),t.stack&&(n[fe]=t.stack)),n[me]||n[Te]?this.addEvent("exception",n,e):Tt.warn(`Failed to record an exception ${t}`)}get duration(){return this._duration}get ended(){return this._ended}_isSpanEnded(){return this._ended&&Tt.warn(`Can not execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`),this._ended}_truncateToLimitUtil(t,e){return t.length<=e?t:t.substr(0,e)}_truncateToSize(t){const e=this._attributeValueLengthLimit;return e<=0?(Tt.warn(`Attribute value limit must be positive, got ${e}`),t):"string"==typeof t?this._truncateToLimitUtil(t,e):Array.isArray(t)?t.map((t=>"string"==typeof t?this._truncateToLimitUtil(t,e):t)):t}}var Ln;!function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Ln||(Ln={}));class An{shouldSample(){return{decision:Ln.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}class Nn{shouldSample(){return{decision:Ln.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}class yn{constructor(t){var e,n,r,s;this._root=t.root,this._root||(Wt(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Nn),this._remoteParentSampled=null!==(e=t.remoteParentSampled)&&void 0!==e?e:new Nn,this._remoteParentNotSampled=null!==(n=t.remoteParentNotSampled)&&void 0!==n?n:new An,this._localParentSampled=null!==(r=t.localParentSampled)&&void 0!==r?r:new Nn,this._localParentNotSampled=null!==(s=t.localParentNotSampled)&&void 0!==s?s:new An}shouldSample(t,e,n,r,s,i){const o=Mt.getSpanContext(t);return o&&et(o)?o.isRemote?o.traceFlags&V.SAMPLED?this._remoteParentSampled.shouldSample(t,e,n,r,s,i):this._remoteParentNotSampled.shouldSample(t,e,n,r,s,i):o.traceFlags&V.SAMPLED?this._localParentSampled.shouldSample(t,e,n,r,s,i):this._localParentNotSampled.shouldSample(t,e,n,r,s,i):this._root.shouldSample(t,e,n,r,s,i)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}}class wn{constructor(t=0){this._ratio=t,this._ratio=this._normalize(t),this._upperBound=Math.floor(4294967295*this._ratio)}shouldSample(t,e){return{decision:Z(e)&&this._accumulate(e)<this._upperBound?Ln.RECORD_AND_SAMPLED:Ln.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(t){return"number"!=typeof t||isNaN(t)?0:t>=1?1:t<=0?0:t}_accumulate(t){let e=0;for(let n=0;n<t.length/8;n++){const r=8*n;e=(e^parseInt(t.slice(r,r+8),16))>>>0}return e}}const Pn=de(),In=qt.AlwaysOn;function Cn(){return{sampler:Mn(Pn),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:de().OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:de().OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:de().OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:de().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:de().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:de().OTEL_SPAN_EVENT_COUNT_LIMIT}}}function Mn(t=de()){switch(t.OTEL_TRACES_SAMPLER){case qt.AlwaysOn:return new Nn;case qt.AlwaysOff:return new An;case qt.ParentBasedAlwaysOn:return new yn({root:new Nn});case qt.ParentBasedAlwaysOff:return new yn({root:new An});case qt.TraceIdRatio:return new wn(Un(t));case qt.ParentBasedTraceIdRatio:return new yn({root:new wn(Un(t))});default:return Tt.error(`OTEL_TRACES_SAMPLER value "${t.OTEL_TRACES_SAMPLER} invalid, defaulting to ${In}".`),new Nn}}function Un(t){if(void 0===t.OTEL_TRACES_SAMPLER_ARG||""===t.OTEL_TRACES_SAMPLER_ARG)return Tt.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1;const e=Number(t.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(Tt.error(`OTEL_TRACES_SAMPLER_ARG=${t.OTEL_TRACES_SAMPLER_ARG} was given, but it is invalid, defaulting to 1.`),1):e<0||e>1?(Tt.error(`OTEL_TRACES_SAMPLER_ARG=${t.OTEL_TRACES_SAMPLER_ARG} was given, but it is out of range ([0..1]), defaulting to 1.`),1):e}function Dn(t){var e,n,r,s,i,o,a,c,u,l,d,h;const p=Object.assign({},t.spanLimits),_="undefined"!=typeof process?le(process.env):le(Kt);return p.attributeCountLimit=null!==(o=null!==(i=null!==(s=null!==(n=null===(e=t.spanLimits)||void 0===e?void 0:e.attributeCountLimit)&&void 0!==n?n:null===(r=t.generalLimits)||void 0===r?void 0:r.attributeCountLimit)&&void 0!==s?s:_.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)&&void 0!==i?i:_.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==o?o:128,p.attributeValueLengthLimit=null!==(h=null!==(d=null!==(l=null!==(c=null===(a=t.spanLimits)||void 0===a?void 0:a.attributeValueLengthLimit)&&void 0!==c?c:null===(u=t.generalLimits)||void 0===u?void 0:u.attributeValueLengthLimit)&&void 0!==l?l:_.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==d?d:_.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==h?h:re,Object.assign({},t,{spanLimits:p})}class xn extends class{constructor(t,e){this._exporter=t,this._finishedSpans=[];const n=de();this._maxExportBatchSize="number"==typeof(null==e?void 0:e.maxExportBatchSize)?e.maxExportBatchSize:n.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==e?void 0:e.maxQueueSize)?e.maxQueueSize:n.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==e?void 0:e.scheduledDelayMillis)?e.scheduledDelayMillis:n.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==e?void 0:e.exportTimeoutMillis)?e.exportTimeoutMillis:n.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new On(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(Tt.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}onStart(t,e){}onEnd(t){this._shutdownOnce.isCalled||0!=(t.spanContext().traceFlags&V.SAMPLED)&&this._addToBuffer(t)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return Promise.resolve().then((()=>this.onShutdown())).then((()=>this._flushAll())).then((()=>this._exporter.shutdown()))}_addToBuffer(t){this._finishedSpans.length>=this._maxQueueSize||(this._finishedSpans.push(t),this._maybeStartTimer())}_flushAll(){return new Promise(((t,e)=>{const n=[];for(let t=0,e=Math.ceil(this._finishedSpans.length/this._maxExportBatchSize);t<e;t++)n.push(this._flushOneBatch());Promise.all(n).then((()=>{t()})).catch(e)}))}_flushOneBatch(){return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise(((t,e)=>{const n=setTimeout((()=>{e(new Error("Timeout"))}),this._exportTimeoutMillis);mt.with(function(t){return t.setValue(xt,!0)}(mt.active()),(()=>{this._exporter.export(this._finishedSpans.splice(0,this._maxExportBatchSize),(r=>{var s;clearTimeout(n),r.code===$e.SUCCESS?t():e(null!==(s=r.error)&&void 0!==s?s:new Error("BatchSpanProcessor: span export failed"))}))}))}))}_maybeStartTimer(){void 0===this._timer&&(this._timer=window.setTimeout((()=>{this._flushOneBatch().then((()=>{this._finishedSpans.length>0&&(this._clearTimer(),this._maybeStartTimer())})).catch((t=>{Wt(t)}))}),this._scheduledDelayMillis),this._timer)}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}}{constructor(t,e){super(t,e),this.onInit(e)}onInit(t){!0!==(null==t?void 0:t.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=()=>{"hidden"===document.visibilityState&&this.forceFlush()},this._pageHideListener=()=>{this.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))}onShutdown(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))}}class Bn{constructor(){this.generateTraceId=Vn(16),this.generateSpanId=Vn(8)}}const kn=Array(32);function Vn(t){return function(){for(let e=0;e<2*t;e++)kn[e]=Math.floor(16*Math.random())+48,kn[e]>=58&&(kn[e]+=39);return String.fromCharCode.apply(null,kn.slice(0,2*t))}}class Fn{constructor(t,e,n){this._tracerProvider=n;const r=function(t){const e={sampler:Mn()},n=Cn(),r=Object.assign({},n,e,t);return r.generalLimits=Object.assign({},n.generalLimits,t.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,t.spanLimits||{}),r}(e);this._sampler=r.sampler,this._generalLimits=r.generalLimits,this._spanLimits=r.spanLimits,this._idGenerator=e.idGenerator||new Bn,this.resource=n.resource,this.instrumentationLibrary=t}startSpan(t,e={},n=mt.active()){var r,s;e.root&&(n=Mt.deleteSpan(n));const i=Mt.getSpan(n);if(Bt(n)){Tt.debug("Instrumentation suppressed, returning Noop Span");return Mt.wrapSpanContext(H)}const o=null==i?void 0:i.spanContext(),a=this._idGenerator.generateSpanId();let c,u,l;o&&Mt.isSpanContextValid(o)?(c=o.traceId,u=o.traceState,l=o.spanId):c=this._idGenerator.generateTraceId();const d=null!==(r=e.kind)&&void 0!==r?r:lt.INTERNAL,h=(null!==(s=e.links)&&void 0!==s?s:[]).map((t=>({context:t.context,attributes:$t(t.attributes)}))),p=$t(e.attributes),_=this._sampler.shouldSample(n,c,t,d,p,h),E={traceId:c,spanId:a,traceFlags:_.decision===ut.RECORD_AND_SAMPLED?V.SAMPLED:V.NONE,traceState:u};if(_.decision===ut.NOT_RECORD){Tt.debug("Recording is off, propagating context in a non-recording span");return Mt.wrapSpanContext(E)}const m=new bn(this,n,t,E,d,l,h,e.startTime),T=$t(Object.assign(p,_.attributes));return m.setAttributes(T),m}startActiveSpan(t,e,n,r){let s,i,o;if(arguments.length<2)return;2===arguments.length?o=e:3===arguments.length?(s=e,o=n):(s=e,i=n,o=r);const a=null!=i?i:mt.active(),c=this.startSpan(t,s,a),u=Mt.setSpan(a,c);return mt.with(u,o,void 0,c)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}getActiveSpanProcessor(){return this._tracerProvider.getActiveSpanProcessor()}}function jn(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))}class Hn{constructor(t){this.attributes=t}static empty(){return Hn.EMPTY}static default(){return new Hn({[ye]:"unknown_service",[Pe]:Ce[Pe],[we]:Ce[we],[Ie]:Ce[Ie]})}merge(t){if(!t||!Object.keys(t.attributes).length)return this;const e=Object.assign({},this.attributes,t.attributes);return new Hn(e)}}Hn.EMPTY=new Hn({});class $n{constructor(t){this._spanProcessors=t}forceFlush(){const t=[];for(const e of this._spanProcessors)t.push(e.forceFlush());return new Promise((e=>{Promise.all(t).then((()=>{e()})).catch((t=>{Wt(t||new Error("MultiSpanProcessor: forceFlush failed")),e()}))}))}onStart(t,e){for(const n of this._spanProcessors)n.onStart(t,e)}onEnd(t){for(const e of this._spanProcessors)e.onEnd(t)}shutdown(){const t=[];for(const e of this._spanProcessors)t.push(e.shutdown());return new Promise(((e,n)=>{Promise.all(t).then((()=>{e()}),n)}))}}class Gn{onStart(t,e){}onEnd(t){}shutdown(){return Promise.resolve()}forceFlush(){return Promise.resolve()}}var Xn,Yn;!function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"}(Xn||(Xn={}));class zn{constructor(t={}){var e;this._registeredSpanProcessors=[],this._tracers=new Map;const n=function(...t){let e=t.shift();const n=new WeakMap;for(;t.length>0;)e=_n(e,t.shift(),0,n);return e}({},Cn(),Dn(t));this.resource=null!==(e=n.resource)&&void 0!==e?e:Hn.empty(),this.resource=Hn.default().merge(this.resource),this._config=Object.assign({},n,{resource:this.resource});const r=this._buildExporterFromEnv();if(void 0!==r){const t=new xn(r);this.activeSpanProcessor=t}else this.activeSpanProcessor=new Gn}getTracer(t,e,n){const r=`${t}@${e||""}:${(null==n?void 0:n.schemaUrl)||""}`;return this._tracers.has(r)||this._tracers.set(r,new Fn({name:t,version:e,schemaUrl:null==n?void 0:n.schemaUrl},this._config,this)),this._tracers.get(r)}addSpanProcessor(t){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch((t=>Tt.error("Error while trying to shutdown current span processor",t))),this._registeredSpanProcessors.push(t),this.activeSpanProcessor=new $n(this._registeredSpanProcessors)}getActiveSpanProcessor(){return this.activeSpanProcessor}register(t={}){Mt.setGlobalTracerProvider(this),void 0===t.propagator&&(t.propagator=this._buildPropagatorFromEnv()),t.contextManager&&mt.setGlobalContextManager(t.contextManager),t.propagator&&Pt.setGlobalPropagator(t.propagator)}forceFlush(){const t=this._config.forceFlushTimeoutMillis,e=this._registeredSpanProcessors.map((e=>new Promise((n=>{let r;const s=setTimeout((()=>{n(new Error(`Span processor did not completed within timeout period of ${t} ms`)),r=Xn.timeout}),t);e.forceFlush().then((()=>{clearTimeout(s),r!==Xn.timeout&&(r=Xn.resolved,n(r))})).catch((t=>{clearTimeout(s),r=Xn.error,n(t)}))}))));return new Promise(((t,n)=>{Promise.all(e).then((e=>{const r=e.filter((t=>t!==Xn.resolved));r.length>0?n(r):t()})).catch((t=>n([t])))}))}shutdown(){return this.activeSpanProcessor.shutdown()}_getPropagator(t){var e;return null===(e=this.constructor._registeredPropagators.get(t))||void 0===e?void 0:e()}_getSpanExporter(t){var e;return null===(e=this.constructor._registeredExporters.get(t))||void 0===e?void 0:e()}_buildPropagatorFromEnv(){const t=Array.from(new Set(de().OTEL_PROPAGATORS)),e=t.map((t=>{const e=this._getPropagator(t);return e||Tt.warn(`Propagator "${t}" requested through environment variable is unavailable.`),e})).reduce(((t,e)=>(e&&t.push(e),t)),[]);return 0===e.length?void 0:1===t.length?e[0]:new Ge({propagators:e})}_buildExporterFromEnv(){const t=de().OTEL_TRACES_EXPORTER;if("none"===t||""===t)return;const e=this._getSpanExporter(t);return e||Tt.error(`Exporter "${t}" requested through environment variable is unavailable.`),e}}zn._registeredPropagators=new Map([["tracecontext",()=>new Je],["baggage",()=>new Ht]]),zn._registeredExporters=new Map;class Wn{constructor(){this._enabled=!1,this._currentContext=R}_bindFunction(t=R,e){const n=this,r=function(...r){return n.with(t,(()=>e.apply(this,r)))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:e.length}),r}active(){return this._currentContext}bind(t,e){return void 0===t&&(t=this.active()),"function"==typeof e?this._bindFunction(t,e):e}disable(){return this._currentContext=R,this._enabled=!1,this}enable(){return this._enabled||(this._enabled=!0,this._currentContext=R),this}with(t,e,n,...r){const s=this._currentContext;this._currentContext=t||R;try{return e.call(n,...r)}finally{this._currentContext=s}}}class qn extends zn{constructor(t={}){if(super(t),t.contextManager)throw"contextManager should be defined in register method not in constructor";if(t.propagator)throw"propagator should be defined in register method not in constructor"}register(t={}){void 0===t.contextManager&&(t.contextManager=new Wn),t.contextManager&&t.contextManager.enable(),super.register(t)}}let Kn;function Qn(t,e){return e in t}function Jn(t,e,n){if(Qn(n,e)&&"number"==typeof n[e])return t.addEvent(e,n[e]),t}function Zn(t,e){Jn(t,Yn.FETCH_START,e),Jn(t,Yn.DOMAIN_LOOKUP_START,e),Jn(t,Yn.DOMAIN_LOOKUP_END,e),Jn(t,Yn.CONNECT_START,e),Jn(t,Yn.SECURE_CONNECTION_START,e),Jn(t,Yn.CONNECT_END,e),Jn(t,Yn.REQUEST_START,e),Jn(t,Yn.RESPONSE_START,e),Jn(t,Yn.RESPONSE_END,e);const n=e[Yn.ENCODED_BODY_SIZE];void 0!==n&&t.setAttribute(Le,n);const r=e[Yn.DECODED_BODY_SIZE];void 0!==r&&n!==r&&t.setAttribute(Ae,r)}function tr(t,e,n,r,s=new WeakSet,i){const o=er(t),a=function(t,e,n,r,s,i){const o=Ve(e),a=Ve(n);let c=r.filter((e=>{const n=Ve(ke(e[Yn.FETCH_START])),r=Ve(ke(e[Yn.RESPONSE_END]));return e.initiatorType.toLowerCase()===(i||"xmlhttprequest")&&e.name===t&&n>=o&&r<=a}));c.length>0&&(c=c.filter((t=>!s.has(t))));return c}(t=o.toString(),e,n,r,s,i);if(0===a.length)return{mainRequest:void 0};if(1===a.length)return{mainRequest:a[0]};const c=function(t){return t.slice().sort(((t,e)=>{const n=t[Yn.FETCH_START],r=e[Yn.FETCH_START];return n>r?1:n<r?-1:0}))}(a);if(o.origin!==location.origin&&c.length>1){let t=c[0],e=function(t,e,n){const r=Ve(n),s=Ve(ke(e));let i,o=t[1];const a=t.length;for(let e=1;e<a;e++){const n=t[e],a=Ve(ke(n[Yn.FETCH_START])),c=r-Ve(ke(n[Yn.RESPONSE_END]));a>=s&&(!i||c<i)&&(i=c,o=n)}return o}(c,t[Yn.RESPONSE_END],n);const r=t[Yn.RESPONSE_END];return e[Yn.FETCH_START]<r&&(e=t,t=void 0),{corsPreFlightRequest:t,mainRequest:e}}return{mainRequest:a[0]}}function er(t){if("function"==typeof URL)return new URL(t,location.href);const e=(Kn||(Kn=document.createElement("a")),Kn);return e.href=t,e}function nr(t,e){if(t.nodeType===Node.DOCUMENT_NODE)return"/";const n=function(t,e){const n=t.nodeType,r=function(t){if(!t.parentNode)return 0;const e=[t.nodeType];t.nodeType===Node.CDATA_SECTION_NODE&&e.push(Node.TEXT_NODE);let n=Array.from(t.parentNode.childNodes);if(n=n.filter((n=>{const r=n.localName;return e.indexOf(n.nodeType)>=0&&r===t.localName})),n.length>=1)return n.indexOf(t)+1;return 0}(t);let s="";if(n===Node.ELEMENT_NODE){const n=t.getAttribute("id");if(e&&n)return`//*[@id="${n}"]`;s=t.localName}else if(n===Node.TEXT_NODE||n===Node.CDATA_SECTION_NODE)s="text()";else{if(n!==Node.COMMENT_NODE)return"";s="comment()"}if(s&&r>1)return`/${s}[${r}]`;return`/${s}`}(t,e);if(e&&n.indexOf("@id")>0)return n;let r="";return t.parentNode&&(r+=nr(t.parentNode,!1)),r+=n,r}function rr(t,e){let n=e||[];("string"==typeof n||n instanceof RegExp)&&(n=[n]);return er(t).origin===location.origin||n.some((e=>vn(t,e)))}function sr(t=[]){let e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(Array.isArray(r)){const t=sr(r);e=e.concat(t.instrumentations)}else"function"==typeof r?e.push(new r):r.instrumentationName&&e.push(r)}return{instrumentations:e}}function ir(t){const{instrumentations:e}=sr(t.instrumentations),n=t.tracerProvider||Mt.getTracerProvider(),r=t.meterProvider||St.getMeterProvider();return function(t,e,n){for(let r=0,s=t.length;r<s;r++){const s=t[r];e&&s.setTracerProvider(e),n&&s.setMeterProvider(n),s.getConfig().enabled||s.enable()}}(e,n,r),()=>{!function(t){t.forEach((t=>t.disable()))}(e)}}function or(t){return"function"==typeof t}!function(t){t.CONNECT_END="connectEnd",t.CONNECT_START="connectStart",t.DECODED_BODY_SIZE="decodedBodySize",t.DOM_COMPLETE="domComplete",t.DOM_CONTENT_LOADED_EVENT_END="domContentLoadedEventEnd",t.DOM_CONTENT_LOADED_EVENT_START="domContentLoadedEventStart",t.DOM_INTERACTIVE="domInteractive",t.DOMAIN_LOOKUP_END="domainLookupEnd",t.DOMAIN_LOOKUP_START="domainLookupStart",t.ENCODED_BODY_SIZE="encodedBodySize",t.FETCH_START="fetchStart",t.LOAD_EVENT_END="loadEventEnd",t.LOAD_EVENT_START="loadEventStart",t.NAVIGATION_START="navigationStart",t.REDIRECT_END="redirectEnd",t.REDIRECT_START="redirectStart",t.REQUEST_START="requestStart",t.RESPONSE_END="responseEnd",t.RESPONSE_START="responseStart",t.SECURE_CONNECTION_START="secureConnectionStart",t.UNLOAD_EVENT_END="unloadEventEnd",t.UNLOAD_EVENT_START="unloadEventStart"}(Yn||(Yn={}));var ar=console.error.bind(console);function cr(t,e,n){var r=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:r,writable:!0,value:n})}function ur(t){t&&t.logger&&(or(t.logger)?ar=t.logger:ar("new logger isn't a function, not replacing"))}function lr(t,e,n){if(t&&t[e]){if(!n)return ar("no wrapper function"),void ar((new Error).stack);if(or(t[e])&&or(n)){var r=t[e],s=n(r,e);return cr(s,"__original",r),cr(s,"__unwrap",(function(){t[e]===s&&cr(t,e,r)})),cr(s,"__wrapped",!0),cr(t,e,s),s}ar("original object and wrapper must be functions")}else ar("no original function "+e+" to wrap")}function dr(t,e){return t&&t[e]?t[e].__unwrap?t[e].__unwrap():void ar("no original to unwrap to -- has "+e+" already been unwrapped?"):(ar("no function to unwrap."),void ar((new Error).stack))}ur.wrap=lr,ur.massWrap=function(t,e,n){if(!t)return ar("must provide one or more modules to patch"),void ar((new Error).stack);Array.isArray(t)||(t=[t]),e&&Array.isArray(e)?t.forEach((function(t){e.forEach((function(e){lr(t,e,n)}))})):ar("must provide one or more functions to wrap on modules")},ur.unwrap=dr,ur.massUnwrap=function(t,e){if(!t)return ar("must provide one or more modules to patch"),void ar((new Error).stack);Array.isArray(t)||(t=[t]),e&&Array.isArray(e)?t.forEach((function(t){e.forEach((function(e){dr(t,e)}))})):ar("must provide one or more functions to unwrap on modules")};var hr,pr=ur;class _r extends class{constructor(t,e,n={}){this.instrumentationName=t,this.instrumentationVersion=e,this._wrap=pr.wrap,this._unwrap=pr.unwrap,this._massWrap=pr.massWrap,this._massUnwrap=pr.massUnwrap,this._config=Object.assign({enabled:!0},n),this._diag=Tt.createComponentLogger({namespace:t}),this._tracer=Mt.getTracer(t,e),this._meter=St.getMeter(t,e),this._updateMetricInstruments()}get meter(){return this._meter}setMeterProvider(t){this._meter=t.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}_updateMetricInstruments(){}getConfig(){return this._config}setConfig(t={}){this._config=Object.assign({},t)}setTracerProvider(t){this._tracer=t.getTracer(this.instrumentationName,this.instrumentationVersion)}get tracer(){return this._tracer}}{constructor(t,e,n={}){super(t,e,n),this._config.enabled&&this.enable()}}function Er(t,e,n){let r,s;try{s=t()}catch(t){r=t}finally{if(e(r,s),r&&!n)throw r;return s}}function mr(t){return"function"==typeof t&&"function"==typeof t.__original&&"function"==typeof t.__unwrap&&!0===t.__wrapped}!function(t){t.METHOD_OPEN="open",t.METHOD_SEND="send",t.EVENT_ABORT="abort",t.EVENT_ERROR="error",t.EVENT_LOAD="loaded",t.EVENT_TIMEOUT="timeout"}(hr||(hr={}));const Tr="0.35.0";var fr;!function(t){t.HTTP_STATUS_TEXT="http.status_text"}(fr||(fr={}));class gr extends _r{constructor(t){super("@opentelemetry/instrumentation-xml-http-request",Tr,t),this.component="xml-http-request",this.version=Tr,this.moduleName=this.component,this._tasksCount=0,this._xhrMem=new WeakMap,this._usedResources=new WeakSet}init(){}_getConfig(){return this._config}_addHeaders(t,e){if(!rr(er(e).href,this._getConfig().propagateTraceHeaderCorsUrls)){const t={};return Pt.inject(mt.active(),t),void(Object.keys(t).length>0&&this._diag.debug("headers inject skipped due to CORS policy"))}const n={};Pt.inject(mt.active(),n),Object.keys(n).forEach((e=>{t.setRequestHeader(e,String(n[e]))}))}_addChildSpan(t,e){mt.with(Mt.setSpan(mt.active(),t),(()=>{const t=this.tracer.startSpan("CORS Preflight",{startTime:e[Yn.FETCH_START]});Zn(t,e),t.end(e[Yn.RESPONSE_END])}))}_addFinalSpanAttributes(t,e,n){if("string"==typeof n){const r=er(n);void 0!==e.status&&t.setAttribute(Oe,e.status),void 0!==e.statusText&&t.setAttribute(fr.HTTP_STATUS_TEXT,e.statusText),t.setAttribute(Se,r.host),t.setAttribute(Re,r.protocol.replace(":","")),t.setAttribute(be,navigator.userAgent)}}_applyAttributesAfterXHR(t,e){const n=this._getConfig().applyCustomAttributesOnSpan;"function"==typeof n&&Er((()=>n(t,e)),(t=>{t&&this._diag.error("applyCustomAttributesOnSpan",t)}),!0)}_addResourceObserver(t,e){const n=this._xhrMem.get(t);n&&"function"==typeof PerformanceObserver&&"function"==typeof PerformanceResourceTiming&&(n.createdResources={observer:new PerformanceObserver((t=>{const r=t.getEntries(),s=er(e);r.forEach((t=>{"xmlhttprequest"===t.initiatorType&&t.name===s.href&&n.createdResources&&n.createdResources.entries.push(t)}))})),entries:[]},n.createdResources.observer.observe({entryTypes:["resource"]}))}_clearResources(){0===this._tasksCount&&this._getConfig().clearTimingResources&&(Ee.clearResourceTimings(),this._xhrMem=new WeakMap,this._usedResources=new WeakSet)}_findResourceAndAddNetworkEvents(t,e,n,r,s){if(!(n&&r&&s&&t.createdResources))return;let i=t.createdResources.entries;i&&i.length||(i=Ee.getEntriesByType("resource"));const o=tr(er(n).href,r,s,i,this._usedResources);if(o.mainRequest){const t=o.mainRequest;this._markResourceAsUsed(t);const n=o.corsPreFlightRequest;n&&(this._addChildSpan(e,n),this._markResourceAsUsed(n)),Zn(e,t)}}_cleanPreviousSpanInformation(t){const e=this._xhrMem.get(t);if(e){const n=e.callbackToRemoveEvents;n&&n(),this._xhrMem.delete(t)}}_createSpan(t,e,n){if(Sn(e,this._getConfig().ignoreUrls))return void this._diag.debug("ignoring span as url matches ignored url");const r=`HTTP ${n.toUpperCase()}`,s=this.tracer.startSpan(r,{kind:lt.CLIENT,attributes:{[ge]:n,[ve]:er(e).toString()}});return s.addEvent(hr.METHOD_OPEN),this._cleanPreviousSpanInformation(t),this._xhrMem.set(t,{span:s,spanUrl:e}),s}_markResourceAsUsed(t){this._usedResources.add(t)}_patchOpen(){return t=>{const e=this;return function(...n){const r=n[0],s=n[1];return e._createSpan(this,s,r),t.apply(this,n)}}}_patchSend(){const t=this;function e(e,n){const r=t._xhrMem.get(n);if(!r)return;r.status=n.status,r.statusText=n.statusText,t._xhrMem.delete(n),r.span&&t._applyAttributesAfterXHR(r.span,n);const s=Be(),i=Date.now();setTimeout((()=>{!function(e,n,r,s){const i=n.callbackToRemoveEvents;"function"==typeof i&&i();const{span:o,spanUrl:a,sendStartTime:c}=n;o&&(t._findResourceAndAddNetworkEvents(n,o,a,c,r),o.addEvent(e,s),t._addFinalSpanAttributes(o,n,a),o.end(s),t._tasksCount--),t._clearResources()}(e,r,s,i)}),300)}function n(){e(hr.EVENT_ERROR,this)}function r(){e(hr.EVENT_ABORT,this)}function s(){e(hr.EVENT_TIMEOUT,this)}function i(){this.status<299?e(hr.EVENT_LOAD,this):e(hr.EVENT_ERROR,this)}return e=>function(...o){const a=t._xhrMem.get(this);if(!a)return e.apply(this,o);const c=a.span,u=a.spanUrl;return c&&u&&mt.with(Mt.setSpan(mt.active(),c),(()=>{t._tasksCount++,a.sendStartTime=Be(),c.addEvent(hr.METHOD_SEND),this.addEventListener("abort",r),this.addEventListener("error",n),this.addEventListener("load",i),this.addEventListener("timeout",s),a.callbackToRemoveEvents=()=>{!function(e){e.removeEventListener("abort",r),e.removeEventListener("error",n),e.removeEventListener("load",i),e.removeEventListener("timeout",s);const o=t._xhrMem.get(e);o&&(o.callbackToRemoveEvents=void 0)}(this),a.createdResources&&a.createdResources.observer.disconnect()},t._addHeaders(this,u),t._addResourceObserver(this,u)})),e.apply(this,o)}}enable(){this._diag.debug("applying patch to",this.moduleName,this.version),mr(XMLHttpRequest.prototype.open)&&(this._unwrap(XMLHttpRequest.prototype,"open"),this._diag.debug("removing previous patch from method open")),mr(XMLHttpRequest.prototype.send)&&(this._unwrap(XMLHttpRequest.prototype,"send"),this._diag.debug("removing previous patch from method send")),this._wrap(XMLHttpRequest.prototype,"open",this._patchOpen()),this._wrap(XMLHttpRequest.prototype,"send",this._patchSend())}disable(){this._diag.debug("removing patch from",this.moduleName,this.version),this._unwrap(XMLHttpRequest.prototype,"open"),this._unwrap(XMLHttpRequest.prototype,"send"),this._tasksCount=0,this._xhrMem=new WeakMap,this._usedResources=new WeakSet}}var vr;!function(t){t.COMPONENT="component",t.HTTP_ERROR_NAME="http.error_name",t.HTTP_STATUS_TEXT="http.status_text"}(vr||(vr={}));const Sr="0.35.0";class Rr extends _r{constructor(t){super("@opentelemetry/instrumentation-fetch",Sr,t),this.component="fetch",this.version=Sr,this.moduleName=this.component,this._usedResources=new WeakSet,this._tasksCount=0}init(){}_getConfig(){return this._config}_addChildSpan(t,e){const n=this.tracer.startSpan("CORS Preflight",{startTime:e[Yn.FETCH_START]},Mt.setSpan(mt.active(),t));this._getConfig().ignoreNetworkEvents||Zn(n,e),n.end(e[Yn.RESPONSE_END])}_addFinalSpanAttributes(t,e){const n=er(e.url);t.setAttribute(Oe,e.status),null!=e.statusText&&t.setAttribute(vr.HTTP_STATUS_TEXT,e.statusText),t.setAttribute(Se,n.host),t.setAttribute(Re,n.protocol.replace(":","")),t.setAttribute(be,navigator.userAgent)}_addHeaders(t,e){if(!rr(e,this._getConfig().propagateTraceHeaderCorsUrls)){const t={};return Pt.inject(mt.active(),t),void(Object.keys(t).length>0&&this._diag.debug("headers inject skipped due to CORS policy"))}if(t instanceof Request)Pt.inject(mt.active(),t.headers,{set:(t,e,n)=>t.set(e,"string"==typeof n?n:String(n))});else if(t.headers instanceof Headers)Pt.inject(mt.active(),t.headers,{set:(t,e,n)=>t.set(e,"string"==typeof n?n:String(n))});else{const e={};Pt.inject(mt.active(),e),t.headers=Object.assign({},e,t.headers||{})}}_clearResources(){0===this._tasksCount&&this._getConfig().clearTimingResources&&(performance.clearResourceTimings(),this._usedResources=new WeakSet)}_createSpan(t,e={}){if(Sn(t,this._getConfig().ignoreUrls))return void this._diag.debug("ignoring span as url matches ignored url");const n=(e.method||"GET").toUpperCase(),r=`HTTP ${n}`;return this.tracer.startSpan(r,{kind:lt.CLIENT,attributes:{[vr.COMPONENT]:this.moduleName,[ge]:n,[ve]:t}})}_findResourceAndAddNetworkEvents(t,e,n){let r=e.entries;if(!r.length){if(!performance.getEntriesByType)return;r=performance.getEntriesByType("resource")}const s=tr(e.spanUrl,e.startTime,n,r,this._usedResources,"fetch");if(s.mainRequest){const e=s.mainRequest;this._markResourceAsUsed(e);const n=s.corsPreFlightRequest;n&&(this._addChildSpan(t,n),this._markResourceAsUsed(n)),this._getConfig().ignoreNetworkEvents||Zn(t,e)}}_markResourceAsUsed(t){this._usedResources.add(t)}_endSpan(t,e,n){const r=De(Date.now()),s=Be();this._addFinalSpanAttributes(t,n),setTimeout((()=>{var n;null===(n=e.observer)||void 0===n||n.disconnect(),this._findResourceAndAddNetworkEvents(t,e,s),this._tasksCount--,this._clearResources(),t.end(r)}),300)}_patchConstructor(){return t=>{const e=this;return function(...n){const r=this,s=er(n[0]instanceof Request?n[0].url:n[0]).href,i=n[0]instanceof Request?n[0]:n[1]||{},o=e._createSpan(s,i);if(!o)return t.apply(this,n);const a=e._prepareSpanData(s);function c(t,n){e._applyAttributesAfterFetch(t,i,n),e._endSpan(t,a,{status:n.status||0,statusText:n.message,url:s})}function u(t,n){e._applyAttributesAfterFetch(t,i,n),n.status>=200&&n.status<400?e._endSpan(t,a,n):e._endSpan(t,a,{status:n.status,statusText:n.statusText,url:s})}function l(t,e,n){try{const r=n.clone(),s=n.clone(),i=r.body;if(i){const e=i.getReader(),n=()=>{e.read().then((({done:e})=>{e?u(t,s):n()}),(e=>{c(t,e)}))};n()}else u(t,n)}finally{e(n)}}function d(t,e,n){try{c(t,n)}finally{e(n)}}return new Promise(((n,a)=>mt.with(Mt.setSpan(mt.active(),o),(()=>(e._addHeaders(i,s),e._tasksCount++,t.apply(r,i instanceof Request?[i]:[s,i]).then(l.bind(r,o,n),d.bind(r,o,a)))))))}}}_applyAttributesAfterFetch(t,e,n){const r=this._getConfig().applyCustomAttributesOnSpan;r&&Er((()=>r(t,e,n)),(t=>{t&&this._diag.error("applyCustomAttributesOnSpan",t)}),!0)}_prepareSpanData(t){const e=Be(),n=[];if("function"!=typeof PerformanceObserver)return{entries:n,startTime:e,spanUrl:t};const r=new PerformanceObserver((e=>{e.getEntries().forEach((e=>{"fetch"===e.initiatorType&&e.name===t&&n.push(e)}))}));return r.observe({entryTypes:["resource"]}),{entries:n,observer:r,startTime:e,spanUrl:t}}enable(){mr(fetch)&&(this._unwrap(Kt,"fetch"),this._diag.debug("removing previous patch for constructor")),this._wrap(Kt,"fetch",this._patchConstructor())}disable(){this._unwrap(Kt,"fetch"),this._usedResources=new WeakSet}}const Or=(t,e,n)=>{const r=t[e];return"function"!=typeof r?r:(pr.wrap(t,e,n),br(t[e],r),t[e])},br=(t,e)=>{const n=e.toString;Object.defineProperty(t,"toString",{enumerable:!1,configurable:!0,writable:!0,value(){return n.call(this===t?e:this)}})},Lr=new WeakMap,Ar=(t,e)=>Lr.set(t,e);var Nr,yr,wr,Pr,Ir,Cr,Mr,Ur,Dr,xr;const Br=new Map([[[null===(Nr=globalThis.XMLHttpRequest)||void 0===Nr?void 0:Nr.prototype],["abort","error","load","loadend","loadstart","progress","readystatechange","timeout"]],[[null===(yr=globalThis.MessagePort)||void 0===yr?void 0:yr.prototype],["message","messageerror"]],[[null===(wr=globalThis.WebSocket)||void 0===wr?void 0:wr.prototype],["close","error","open","message"]],[[null===(Pr=globalThis.Worker)||void 0===Pr?void 0:Pr.prototype],["error","message"]],[[null===(Ir=globalThis.IDBIndex)||void 0===Ir?void 0:Ir.prototype,null===(Cr=globalThis.IDBRequest)||void 0===Cr?void 0:Cr.prototype,null===(Mr=globalThis.IDBOpenDBRequest)||void 0===Mr?void 0:Mr.prototype,null===(Ur=globalThis.IDBDatabase)||void 0===Ur?void 0:Ur.prototype,null===(Dr=globalThis.IDBTransaction)||void 0===Dr?void 0:Dr.prototype,null===(xr=globalThis.IDBCursor)||void 0===xr?void 0:xr.prototype],["abort","blocked","close","complete","error","success","upgradeneeded","versionchange"]]]),kr=t=>{const e=new WeakMap,n=(r,s)=>{const i=Object.getOwnPropertyDescriptor(r,s);if(!i){const t=Object.getPrototypeOf(r);if(!t)return;return n(t,s)}Or(i,"get",(t=>function(){var n;const r=null==t?void 0:t.call(this);return null!==(n=e.get(r))&&void 0!==n?n:r})),Or(i,"set",(n=>function(r){let s=null;r&&(s=t.bind(t.active(),r),e.set(s,r)),n.call(this,s)})),Object.defineProperty(r,s,i)},r=new WeakMap;Or(EventTarget.prototype,"addEventListener",(e=>function(...n){const s=n[1];if(s){let e=r.get(s);e||("function"==typeof s?e=t.bind(t.active(),s):s&&"function"==typeof s.handleEvent&&(e=Object.assign(Object.assign({},s),{handleEvent:t.bind(t.active(),s.handleEvent)}))),e&&(r.set(s,e),n[1]=e)}return e.apply(this,n)})),Or(EventTarget.prototype,"removeEventListener",(t=>function(...e){const n=e[1];if(n){const t=r.get(n);t&&(e[1]=t)}return t.apply(this,e)})),Br.forEach(((t,e)=>{e.forEach((e=>{e&&((t,e)=>{e.forEach((e=>{n(t,`on${e}`)}))})(e,t)}))}))},Vr=()=>{const t=(t,e)=>{e.forEach((e=>{((t,e)=>{const n=Object.getOwnPropertyDescriptor(t,e);n&&(pr.unwrap(n,"get"),pr.unwrap(n,"set"),Object.defineProperty(t,e,n))})(t,`on${e}`)}))};pr.unwrap(EventTarget.prototype,"addEventListener"),pr.unwrap(EventTarget.prototype,"removeEventListener"),Br.forEach(((e,n)=>{n.forEach((n=>{n&&t(n,e)}))}))},Fr=t=>{if(!self.MessageChannel||!self.MessagePort)return;const e=new WeakMap;Or(window,"MessageChannel",(t=>class extends t{constructor(...t){super(...t),e.set(this.port1,this.port2),e.set(this.port2,this.port1)}})),Or(MessagePort.prototype,"postMessage",(n=>function(...r){const s=e.get(this);return t.active()&&s&&Ar(s,t.active()),n.apply(this,r)}))},jr=["MutationObserver","IntersectionObserver","ResizeObserver"],Hr=t=>{jr.forEach((e=>{globalThis[e]&&Or(globalThis,e,(n=>{const r=class extends n{constructor(...e){e[0]=t.bind(t.active(),e[0]),super(...e),setTimeout((()=>{Ar(this,R)}),300)}};return Object.defineProperty(r,"name",{enumerable:!1,configurable:!0,writable:!1,value:e}),br(r,n),r}))}))},$r=t=>{window.Promise&&Or(window,"Promise",(e=>{const n=class extends e{};return br(n,e),Or(n.prototype,"then",(e=>function(...n){return n[0]=t.bind(t.active(),n[0]),n[1]=t.bind(t.active(),n[1]),e.apply(this,n)})),Or(n.prototype,"catch",(e=>function(...n){return n[0]=t.bind(t.active(),n[0]),e.apply(this,n)})),Or(n.prototype,"finally",(e=>function(...n){return n[0]=t.bind(t.active(),n[0]),e.apply(this,n)})),n}))},Gr=t=>"number"!=typeof t||t<=1500,Xr=t=>{Or(window,"setTimeout",(e=>function(...n){return Gr(n[1])&&(n[0]=t.bind(t.active(),n[0])),e.apply(this,n)})),Or(window,"setInterval",(e=>function(...n){return Gr(n[1])&&(n[0]=t.bind(t.active(),n[0])),e.apply(this,n)})),Or(window,"setImmediate",(e=>function(...n){return n[0]=t.bind(t.active(),n[0]),e.apply(this,n)})),Or(window,"requestAnimationFrame",(e=>function(...n){return n[0]=t.bind(t.active(),n[0]),e.apply(this,n)})),Or(window,"queueMicrotask",(e=>function(...n){return n[0]=t.bind(t.active(),n[0]),e.apply(this,n)}))},Yr=t=>t?(t=>Lr.get(t))(t):void 0;var zr;!function(t){t.COMPONENT="component",t.DOCUMENT_LOAD="documentLoad",t.DOCUMENT_FETCH="documentFetch",t.RESOURCE_FETCH="resourceFetch",t.PAGE_TITLE="page_title"}(zr||(zr={}));var Wr,qr,Kr,Qr,Jr,Zr=function(t,e){return{name:t,value:void 0===e?-1:e,delta:0,entries:[],id:"v2-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}},ts=function(t,e){try{if(PerformanceObserver.supportedEntryTypes.includes(t)){if("first-input"===t&&!("PerformanceEventTiming"in self))return;var n=new PerformanceObserver((function(t){return t.getEntries().map(e)}));return n.observe({type:t,buffered:!0}),n}}catch(t){}},es=function(t,e){var n=function n(r){"pagehide"!==r.type&&"hidden"!==document.visibilityState||(t(r),e&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},ns=function(t){addEventListener("pageshow",(function(e){e.persisted&&t(e)}),!0)},rs=function(t,e,n){var r;return function(s){e.value>=0&&(s||n)&&(e.delta=e.value-(r||0),(e.delta||void 0===r)&&(r=e.value,t(e)))}},ss=-1,is=function(){return"hidden"===document.visibilityState?0:1/0},os=function(){es((function(t){var e=t.timeStamp;ss=e}),!0)},as=function(){return ss<0&&(ss=is(),os(),ns((function(){setTimeout((function(){ss=is(),os()}),0)}))),{get firstHiddenTime(){return ss}}},cs=function(t,e){var n,r=as(),s=Zr("FCP"),i=function(t){"first-contentful-paint"===t.name&&(a&&a.disconnect(),t.startTime<r.firstHiddenTime&&(s.value=t.startTime,s.entries.push(t),n(!0)))},o=window.performance&&performance.getEntriesByName&&performance.getEntriesByName("first-contentful-paint")[0],a=o?null:ts("paint",i);(o||a)&&(n=rs(t,s,e),o&&i(o),ns((function(r){s=Zr("FCP"),n=rs(t,s,e),requestAnimationFrame((function(){requestAnimationFrame((function(){s.value=performance.now()-r.timeStamp,n(!0)}))}))})))},us=!1,ls=-1,ds={passive:!0,capture:!0},hs=new Date,ps=function(t,e){Wr||(Wr=e,qr=t,Kr=new Date,ms(removeEventListener),_s())},_s=function(){if(qr>=0&&qr<Kr-hs){var t={entryType:"first-input",name:Wr.type,target:Wr.target,cancelable:Wr.cancelable,startTime:Wr.timeStamp,processingStart:Wr.timeStamp+qr};Qr.forEach((function(e){e(t)})),Qr=[]}},Es=function(t){if(t.cancelable){var e=(t.timeStamp>1e12?new Date:performance.now())-t.timeStamp;"pointerdown"==t.type?function(t,e){var n=function(){ps(t,e),s()},r=function(){s()},s=function(){removeEventListener("pointerup",n,ds),removeEventListener("pointercancel",r,ds)};addEventListener("pointerup",n,ds),addEventListener("pointercancel",r,ds)}(e,t):ps(e,t)}},ms=function(t){["mousedown","keydown","touchstart","pointerdown"].forEach((function(e){return t(e,Es,ds)}))},Ts={};!function(t){t.FIRST_PAINT="firstPaint",t.FIRST_CONTENTFUL_PAINT="firstContentfulPaint",t.LARGEST_CONTENTFUL_PAINT="largestContentfulPaint",t.CUMULATIVE_LAYOUT_SHIFT="cumulativeLayoutShift",t.FIRST_INPUT_DELAY="firstInputDelay",t.TIME_TO_FIRST_BYTE="timeToFirstByte"}(Jr||(Jr={}));const fs={FCP:Jr.FIRST_CONTENTFUL_PAINT,FID:Jr.FIRST_INPUT_DELAY,TTFB:Jr.TIME_TO_FIRST_BYTE,LCP:Jr.LARGEST_CONTENTFUL_PAINT,CLS:Jr.CUMULATIVE_LAYOUT_SHIFT},gs={"first-paint":Jr.FIRST_PAINT},vs=new Set([Jr.CUMULATIVE_LAYOUT_SHIFT]),Ss=(t,e)=>{const n={},r=new Set(["FCP","FID","TTFB"]);"chrome"in globalThis&&(r.add("LCP"),r.add("CLS"));let s=!1;const i=()=>{var r,o;if(document.removeEventListener("visibilitychange",i),globalThis.removeEventListener("pagehide",i),!s){const i=null===(o=(r=Ee).getEntriesByType)||void 0===o?void 0:o.call(r,"paint");i&&i.forEach((({name:t,startTime:e})=>{Qn(gs,t)&&(n[gs[t]]=e)})),s=!0,Object.entries(n).forEach((([e,n])=>{t[vs.has(e)?"setAttribute":"addEvent"](e,n)})),e()}},o=t=>{r.delete(t.name),n[fs[t.name]]=t.value,r.size||i()};if(document.addEventListener("visibilitychange",i),globalThis.addEventListener("pagehide",i),function(t,e){us||(cs((function(t){ls=t.value})),us=!0);var n,r=function(e){ls>-1&&t(e)},s=Zr("CLS",0),i=0,o=[],a=function(t){if(!t.hadRecentInput){var e=o[0],r=o[o.length-1];i&&t.startTime-r.startTime<1e3&&t.startTime-e.startTime<5e3?(i+=t.value,o.push(t)):(i=t.value,o=[t]),i>s.value&&(s.value=i,s.entries=o,n())}},c=ts("layout-shift",a);c&&(n=rs(r,s,e),es((function(){c.takeRecords().map(a),n(!0)})),ns((function(){i=0,ls=-1,s=Zr("CLS",0),n=rs(r,s,e)})))}(o),cs(o),function(t,e){var n,r=as(),s=Zr("FID"),i=function(t){t.startTime<r.firstHiddenTime&&(s.value=t.processingStart-t.startTime,s.entries.push(t),n(!0))},o=ts("first-input",i);n=rs(t,s,e),o&&es((function(){o.takeRecords().map(i),o.disconnect()}),!0),o&&ns((function(){var r;s=Zr("FID"),n=rs(t,s,e),Qr=[],qr=-1,Wr=null,ms(addEventListener),r=i,Qr.push(r),_s()}))}(o),function(t,e){var n,r=as(),s=Zr("LCP"),i=function(t){var e=t.startTime;e<r.firstHiddenTime&&(s.value=e,s.entries.push(t),n())},o=ts("largest-contentful-paint",i);if(o){n=rs(t,s,e);var a=function(){Ts[s.id]||(o.takeRecords().map(i),o.disconnect(),Ts[s.id]=!0,n(!0))};["keydown","click"].forEach((function(t){addEventListener(t,a,{once:!0,capture:!0})})),es(a,!0),ns((function(r){s=Zr("LCP"),n=rs(t,s,e),requestAnimationFrame((function(){requestAnimationFrame((function(){s.value=performance.now()-r.timeStamp,Ts[s.id]=!0,n(!0)}))}))}))}}(o),function(t){var e,n=Zr("TTFB");e=function(){try{var e=performance.getEntriesByType("navigation")[0]||function(){var t=performance.timing,e={entryType:"navigation",startTime:0};for(var n in t)"navigationStart"!==n&&"toJSON"!==n&&(e[n]=Math.max(t[n]-t.navigationStart,0));return e}();if(n.value=n.delta=e.responseStart,n.value<0||n.value>performance.now())return;n.entries=[e],t(n)}catch(t){}},"complete"===document.readyState?setTimeout(e,0):addEventListener("load",(function(){return setTimeout(e,0)}))}(o),"function"==typeof PerformanceObserver){const t=new PerformanceObserver((()=>{}));if(t.observe({type:"largest-contentful-paint",buffered:!0}),"function"==typeof t.takeRecords){const[e]=t.takeRecords();e&&(r.delete("LCP"),n[Jr.LARGEST_CONTENTFUL_PAINT]=e.startTime)}}};class Rs extends _r{constructor(t={}){super("@opentelemetry/instrumentation-document-load","0.31.0",t),this.component="document-load",this.version="1",this.moduleName=this.component,this._enabled=!1}init(){}_onDocumentLoaded(){window.setTimeout((()=>{this._collectPerformance()}))}_addResourcesSpans(t){var e,n;const r=null===(n=(e=Ee).getEntriesByType)||void 0===n?void 0:n.call(e,"resource");r&&r.forEach((e=>{this._initResourceSpan(e,t)}))}_collectPerformance(){const t=Array.from(document.getElementsByTagName("meta")).find((t=>t.getAttribute("name")===qe)),e=(()=>{var t,e;const n={},r=null===(e=(t=Ee).getEntriesByType)||void 0===e?void 0:e.call(t,"navigation")[0];if(r)Object.values(Yn).forEach((t=>{if(Qn(r,t)){const e=r[t];"number"==typeof e&&(n[t]=e)}}));else{const t=Ee.timing;t&&Object.values(Yn).forEach((e=>{if(Qn(t,e)){const r=t[e];"number"==typeof r&&(n[e]=r)}}))}return n})(),n=t&&t.content||"";mt.with(Pt.extract(R,{traceparent:n}),(()=>{const t=this._startSpan(zr.DOCUMENT_LOAD,Yn.FETCH_START,e);t&&(mt.with(Mt.setSpan(mt.active(),t),(()=>{const t=this._startSpan(zr.DOCUMENT_FETCH,Yn.FETCH_START,e);t&&(t.setAttribute(ve,location.href),t.setAttribute(be,navigator.userAgent),mt.with(Mt.setSpan(mt.active(),t),(()=>{Zn(t,e),this._endSpan(t,Yn.RESPONSE_END,e)})))})),t.setAttribute(ve,location.href),t.setAttribute(be,navigator.userAgent),t.setAttribute(zr.PAGE_TITLE,document.title),this._addResourcesSpans(t),Jn(t,Yn.FETCH_START,e),Jn(t,Yn.UNLOAD_EVENT_START,e),Jn(t,Yn.UNLOAD_EVENT_END,e),Jn(t,Yn.DOM_INTERACTIVE,e),Jn(t,Yn.DOM_CONTENT_LOADED_EVENT_START,e),Jn(t,Yn.DOM_CONTENT_LOADED_EVENT_END,e),Jn(t,Yn.DOM_COMPLETE,e),Jn(t,Yn.LOAD_EVENT_START,e),Jn(t,Yn.LOAD_EVENT_END,e),Ss(t,(()=>{this._endSpan(t,Yn.LOAD_EVENT_END,e)})))}))}_endSpan(t,e,n){t&&(Qn(n,e)?t.end(n[e]):t.end())}_initResourceSpan(t,e){const n=this._startSpan(zr.RESOURCE_FETCH,Yn.FETCH_START,t,e);n&&(n.setAttribute(ve,t.name),Zn(n,t),this._endSpan(n,Yn.RESPONSE_END,t))}_startSpan(t,e,n,r){if(Qn(n,e)&&"number"==typeof n[e]){const s=this.tracer.startSpan(t,{startTime:n[e]},r?Mt.setSpan(mt.active(),r):void 0);return s.setAttribute(zr.COMPONENT,this.component),s}}_waitForPageLoad(){"complete"!==window.document.readyState||this._enabled?(this._onDocumentLoaded=this._onDocumentLoaded.bind(this),window.addEventListener("load",this._onDocumentLoaded)):(this._enabled=!0,this._onDocumentLoaded())}enable(){window.removeEventListener("load",this._onDocumentLoaded),this._waitForPageLoad()}disable(){window.removeEventListener("load",this._onDocumentLoaded)}}var Os;!function(t){t.COMPONENT="component",t.EVENT_TYPE="event_type",t.TARGET_ELEMENT="target_element",t.TARGET_XPATH="target_xpath",t.HTTP_URL="http.url",t.HTTP_USER_AGENT="http.user_agent"}(Os||(Os={}));const bs="0.32.0",Ls=["click"];function As(){return!1}const Ns=()=>`${location.pathname}${location.search}${location.hash}`;class ys extends _r{constructor(t){var e;super("@opentelemetry/instrumentation-user-interaction",bs,t),this.component="user-interaction",this.version=bs,this.moduleName=this.component,this._spansData=new WeakMap,this._isEnabled=!1,this._wrappedListeners=new WeakMap,this._eventsSpanMap=new WeakMap,this._eventNames=new Set(null!==(e=null==t?void 0:t.eventNames)&&void 0!==e?e:Ls),this._shouldPreventSpanCreation="function"==typeof(null==t?void 0:t.shouldPreventSpanCreation)?t.shouldPreventSpanCreation:As}init(){}_allowEventName(t){return this._eventNames.has(t)}_createSpan(t,e){if(!(t instanceof HTMLElement))return;if(!t.getAttribute)return;if(t.hasAttribute("disabled"))return;if(!this._allowEventName(e))return;const n=nr(t,!0);try{const r=this.tracer.startSpan(e,{attributes:{[Os.COMPONENT]:this.component,[Os.EVENT_TYPE]:e,[Os.TARGET_ELEMENT]:t.tagName,[Os.TARGET_XPATH]:n,[Os.HTTP_URL]:window.location.href,[Os.HTTP_USER_AGENT]:navigator.userAgent}},R);if(!0===this._shouldPreventSpanCreation(e,t,r))return;return this._spansData.set(r,{taskCount:0}),r}catch(t){Tt.error(this.component,t)}}addPatchedListener(t,e,n,r){let s=this._wrappedListeners.get(n);s||(s=new Map,this._wrappedListeners.set(n,s));let i=s.get(e);return i||(i=new Map,s.set(e,i)),!i.has(t)&&(i.set(t,r),!0)}removePatchedListener(t,e,n){const r=this._wrappedListeners.get(n);if(!r)return;const s=r.get(e);if(!s)return;const i=s.get(t);return i&&(s.delete(t),0===s.size&&(r.delete(e),0===r.size&&this._wrappedListeners.delete(n))),i}_invokeListener(t,e,n){return"function"==typeof t?t.apply(e,n):t.handleEvent(n[0])}_patchAddEventListener(){const t=this;return e=>function(n,r,s){if(!r)return e.call(this,n,r,s);const i=s&&"object"==typeof s&&s.once,o=this,a=function(...e){const s=e[0],a=null==s?void 0:s.target;i&&t.removePatchedListener(o,n,r);const c=s&&t._eventsSpanMap.get(s),u=c||t._createSpan(a,n);if(u){s&&!c&&t._eventsSpanMap.set(s,u);const n=t._spansData.get(u),i=mt.with(Mt.setSpan(mt.active(),u),(()=>{void 0===n.currentLocation&&(n.currentLocation=Ns());const s=t._invokeListener(r,this,e);return n.lastListenerEndHrTime=Be(),s}));return s&&!c&&setTimeout((()=>{n.currentLocation!==Ns()&&t._updateSpanAsNavigation(u),u.end(n.lastListenerEndHrTime)}),200),i}return s instanceof UIEvent&&s.isTrusted?mt.with(R,(()=>t._invokeListener(r,this,e))):t._invokeListener(r,this,e)};return t.addPatchedListener(this,n,r,a)?e.call(this,n,a,s):void 0}}_patchRemoveEventListener(){const t=this;return e=>function(n,r,s){const i=t.removePatchedListener(this,n,r);return i?e.call(this,n,i,s):e.call(this,n,r,s)}}_getPatchableEventTargets(){return window.EventTarget?[EventTarget.prototype]:[Node.prototype,Window.prototype]}_updateSpanAsNavigation(t){t.updateName(`Navigation: ${Ns()}`),t.setAttribute("new.location.href",location.href)}enable(){if(this._isEnabled)return;this._isEnabled=!0,Tt.debug("applying patch to",this.moduleName,this.version);this._getPatchableEventTargets().forEach((t=>{this._wrap(t,"addEventListener",this._patchAddEventListener()),this._wrap(t,"removeEventListener",this._patchRemoveEventListener())}))}disable(){if(!this._isEnabled)return;this._isEnabled=!1,Tt.debug("removing patch from",this.moduleName,this.version);this._getPatchableEventTargets().forEach((t=>{mr(t.addEventListener)&&this._unwrap(t,"addEventListener"),mr(t.removeEventListener)&&this._unwrap(t,"removeEventListener")}))}}const ws=1e4;function Ps(t){return"number"==typeof t?t<=0?Is(t,1e4):t:function(){var t;const e=Number(null!==(t=de().OTEL_EXPORTER_OTLP_TRACES_TIMEOUT)&&void 0!==t?t:de().OTEL_EXPORTER_OTLP_TIMEOUT);return e<=0?Is(e,ws):e}()}function Is(t,e){return Tt.warn("Timeout must be greater than 0",t),e}class Cs extends Error{constructor(t,e,n){super(t),this.name="OTLPExporterError",this.data=n,this.code=e}}let Ms=1/0;var Us,Ds,xs,Bs,ks;function Vs(t){return Object.keys(t).map((e=>Fs(e,t[e])))}function Fs(t,e){return{key:t,value:js(e)}}function js(t){const e=typeof t;return"string"===e?{stringValue:t}:"number"===e?Number.isInteger(t)?{intValue:t}:{doubleValue:t}:"boolean"===e?{boolValue:t}:t instanceof Uint8Array?{bytesValue:t}:Array.isArray(t)?{arrayValue:{values:t.map(js)}}:"object"===e&&null!=t?{kvlistValue:{values:Object.entries(t).map((([t,e])=>Fs(t,e)))}}:{}}function Hs(t,e){const n=t.spanContext(),r=t.status,s=e?t.parentSpanId:null!=t.parentSpanId?he(t.parentSpanId):void 0;return{traceId:e?n.traceId:he(n.traceId),spanId:e?n.spanId:he(n.spanId),parentSpanId:s,name:t.name,kind:null==t.kind?0:t.kind+1,startTimeUnixNano:Ve(t.startTime),endTimeUnixNano:Ve(t.endTime),attributes:Vs(t.attributes),droppedAttributesCount:0,events:t.events.map($s),droppedEventsCount:0,status:{code:r.code,message:r.message},links:t.links.map((t=>function(t,e){return{attributes:t.attributes?Vs(t.attributes):[],spanId:e?t.context.spanId:he(t.context.spanId),traceId:e?t.context.traceId:he(t.context.traceId),droppedAttributesCount:0}}(t,e))),droppedLinksCount:0}}function $s(t){return{attributes:t.attributes?Vs(t.attributes):[],name:t.name,timeUnixNano:Ve(t.time),droppedAttributesCount:0}}function Gs(t,e){const n=[],r=function(t){const e=new Map;for(const n of t){let t=e.get(n.resource);t||(t=new Map,e.set(n.resource,t));const r=`${n.instrumentationLibrary.name}@${n.instrumentationLibrary.version||""}:${n.instrumentationLibrary.schemaUrl||""}`;let s=t.get(r);s||(s=[],t.set(r,s)),s.push(n)}return e}(t).entries();let s=r.next();for(;!s.done;){const[t,i]=s.value,o=[],a=i.values();let c=a.next();for(;!c.done;){const t=c.value;if(t.length>0){const{name:n,version:r,schemaUrl:s}=t[0].instrumentationLibrary,i=t.map((t=>Hs(t,e)));o.push({scope:{name:n,version:r},spans:i,schemaUrl:s})}c=a.next()}const u={resource:{attributes:Vs(t.attributes),droppedAttributesCount:0},scopeSpans:o,schemaUrl:void 0};n.push(u),s=r.next()}return n}!function(t){t[t.SPAN_KIND_UNSPECIFIED=0]="SPAN_KIND_UNSPECIFIED",t[t.SPAN_KIND_INTERNAL=1]="SPAN_KIND_INTERNAL",t[t.SPAN_KIND_SERVER=2]="SPAN_KIND_SERVER",t[t.SPAN_KIND_CLIENT=3]="SPAN_KIND_CLIENT",t[t.SPAN_KIND_PRODUCER=4]="SPAN_KIND_PRODUCER",t[t.SPAN_KIND_CONSUMER=5]="SPAN_KIND_CONSUMER"}(Us||(Us={})),function(t){t[t.DELTA=0]="DELTA",t[t.CUMULATIVE=1]="CUMULATIVE"}(Ds||(Ds={})),function(t){t[t.HISTOGRAM=0]="HISTOGRAM",t[t.EXPONENTIAL_HISTOGRAM=1]="EXPONENTIAL_HISTOGRAM",t[t.GAUGE=2]="GAUGE",t[t.SUM=3]="SUM"}(xs||(xs={})),function(t){t[t.DROP=0]="DROP",t[t.SUM=1]="SUM",t[t.LAST_VALUE=2]="LAST_VALUE",t[t.HISTOGRAM=3]="HISTOGRAM"}(Bs||(Bs={})),function(t){t.COUNTER="COUNTER",t.HISTOGRAM="HISTOGRAM",t.UP_DOWN_COUNTER="UP_DOWN_COUNTER",t.OBSERVABLE_COUNTER="OBSERVABLE_COUNTER",t.OBSERVABLE_GAUGE="OBSERVABLE_GAUGE",t.OBSERVABLE_UP_DOWN_COUNTER="OBSERVABLE_UP_DOWN_COUNTER"}(ks||(ks={}));const Xs="v1/traces";class Ys extends class extends class{constructor(t={}){this._sendingPromises=[],this.url=this.getDefaultUrl(t),"string"==typeof t.hostname&&(this.hostname=t.hostname),this.shutdown=this.shutdown.bind(this),this._shutdownOnce=new On(this._shutdown,this),this._concurrencyLimit="number"==typeof t.concurrencyLimit?t.concurrencyLimit:1/0,this.timeoutMillis=Ps(t.timeoutMillis),this.onInit(t)}export(t,e){this._shutdownOnce.isCalled?e({code:$e.FAILED,error:new Error("Exporter has been shutdown")}):this._sendingPromises.length>=this._concurrencyLimit?e({code:$e.FAILED,error:new Error("Concurrent export limit reached")}):this._export(t).then((()=>{e({code:$e.SUCCESS})})).catch((t=>{e({code:$e.FAILED,error:t})}))}_export(t){return new Promise(((e,n)=>{try{Tt.debug("items to be sent",t),this.send(t,e,n)}catch(t){n(t)}}))}shutdown(){return this._shutdownOnce.call()}_shutdown(){return Tt.debug("shutdown started"),this.onShutdown(),Promise.all(this._sendingPromises).then((()=>{}))}}{constructor(t={}){super(t),this._useXHR=!1,this._useXHR=!!t.headers||"function"!=typeof navigator.sendBeacon,this._useXHR?this._headers=Object.assign({},function(t={}){const e={};return Object.entries(t).forEach((([t,n])=>{void 0!==n?e[t]=String(n):Tt.warn(`Header "${t}" has wrong value and will be ignored`)})),e}(t.headers),jt(de().OTEL_EXPORTER_OTLP_HEADERS)):this._headers={}}onInit(){window.addEventListener("unload",this.shutdown)}onShutdown(){window.removeEventListener("unload",this.shutdown)}send(t,e,n){if(this._shutdownOnce.isCalled)return void Tt.debug("Shutdown already started. Cannot send objects");const r=this.convert(t),s=JSON.stringify(r),i=new Promise(((t,e)=>{!this._useXHR&&function(t,e,n){const r=new Blob([t],n);return r.size<Ms&&navigator.sendBeacon(e,r)?(Tt.debug("sendBeacon - can send",t),!0):(Ms=r.size,Tt.info("sendBeacon failed because the given payload was too big; try to lower your span processor limits"),!1)}(s,this.url,{type:"application/json"})?t():function(t,e,n,r,s,i){let o;const a=setTimeout((()=>{o=!0,c.abort()}),r),c=new XMLHttpRequest;c.open("POST",e),Object.entries(Object.assign(Object.assign({},{Accept:"application/json","Content-Type":"application/json"}),n)).forEach((([t,e])=>{c.setRequestHeader(t,e)})),c.send(t),c.onreadystatechange=()=>{if(c.readyState===XMLHttpRequest.DONE)if(c.status>=200&&c.status<=299)clearTimeout(a),Tt.debug("xhr success",t),s();else if(o){const t=new Cs("Request Timeout",c.status);i(t)}else{const t=new Cs(`Failed to export with XHR (status: ${c.status})`,c.status);clearTimeout(a),i(t)}}}(s,this.url,this._headers,this.timeoutMillis,t,e)})).then(e,n);this._sendingPromises.push(i);const o=()=>{const t=this._sendingPromises.indexOf(i);this._sendingPromises.splice(t,1)};i.then(o,o)}}{constructor(t={}){super(t),this._headers=Object.assign(this._headers,jt(de().OTEL_EXPORTER_OTLP_TRACES_HEADERS))}convert(t){return function(t,e){return{resourceSpans:Gs(t,e)}}(t,!0)}getDefaultUrl(t){return"string"==typeof t.url?t.url:de().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT.length>0?function(t){try{const e=new URL(t);return""===e.pathname&&(e.pathname=e.pathname+"/"),e.toString()}catch(e){return Tt.warn(`Could not parse export URL: '${t}'`),t}}(de().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT):de().OTEL_EXPORTER_OTLP_ENDPOINT.length>0?(e=de().OTEL_EXPORTER_OTLP_ENDPOINT,n=Xs,e.endsWith("/")||(e+="/"),e+n):"http://localhost:4318/v1/traces";var e,n}}class zs{constructor(t){this._exporter=t}export(t,e){const n=(r=Be(),Math.round(1e3*r[0]+r[1]/1e6));var r;t.forEach((t=>{t.resource.attributes["sumologic.telemetry.sdk.export_timestamp"]=n})),this._exporter.export(t,e)}shutdown(){return jn(this,void 0,void 0,(function*(){return this._exporter.shutdown()}))}}const Ws="document.visibilityState",qs={visible:"pageshow",hidden:"pagehide"},Ks=[];let Qs=document.visibilityState,Js=Qs;const Zs=()=>{const t=document.visibilityState;if(Js!==t){Js=t;const e=Be();Ks.push({timestampInNanoseconds:Ve(e),timestampInHrTime:e,state:t}),Ks.length>100&&Ks.shift()}};document.addEventListener("visibilitychange",(()=>{Zs()})),window.addEventListener("pagehide",(()=>{Zs()})),window.addEventListener("pageshow",(()=>{Zs()}));const ti=["click","dblclick","submit","reset","pause","play","dragstart","dragend","drop"],ei="root_span.operation",ni="root_span.http.url",ri="xhr.is_root_span",si="http.action_type",ii=1e7;let oi=[],ai=[];const ci=(t,e,n)=>t+ii>=e&&t-ii<=n,ui=(t,e)=>{t.parentSpanId=e.spanContext().spanId,t.spanContext().traceId=e.spanContext().traceId},li=(t,e)=>{if("@opentelemetry/instrumentation-long-task"===t.instrumentationLibrary.name){if(!t.parentSpanId){const e=(t=>{const e=Ve(t);for(let t=oi.length-1;t>=0;t-=1){const n=oi[t];if(ci(e,Ve(n.startTime),Ve(n.endTime)))return n}})(t.startTime);if(!e)return ai.push(t),void(ai.length>10&&ai.shift());ui(t,e)}}else oi.push(t),oi.length>100&&oi.shift(),((t,e)=>{const n=Ve(t.startTime),r=Ve(t.endTime);for(let s=ai.length-1;s>=0;s-=1){const i=ai[s];ci(Ve(i.startTime),n,r)&&(ai.splice(s,1),ui(i,t),e(i))}})(t,e);e(t)},di=t=>t.name.startsWith("HTTP ")&&t.kind===lt.CLIENT,hi=t=>{var e;if(t)return"documentLoad"===(e=t).name&&"@opentelemetry/instrumentation-document-load"===e.instrumentationLibrary.name?"document_loads":t.attributes[ri]?(t=>t.name.startsWith("Navigation: ")&&"@opentelemetry/instrumentation-user-interaction"===t.instrumentationLibrary.name)(t)?"route_changes":"xhr_requests":void 0},pi=t=>t.attributes["new.location.href"]||t.attributes["location.href"],_i={},Ei=[],mi=new WeakMap,Ti=t=>_i[t.spanContext().traceId],fi=t=>t.name.startsWith("HTTP ")&&t.kind===lt.CLIENT,gi=t=>"@opentelemetry/instrumentation-long-task"===t.instrumentationLibrary.name,vi=(t,e)=>{const n=pi(e);t.attributes[ei]=e.name,n&&(t.attributes[ni]=n);if(gi(t)){const n=hi(e);n&&(t.attributes[si]=n)}};var Si;!function(t){t[t.DROP_ROOT_SPAN=0]="DROP_ROOT_SPAN"}(Si||(Si={}));const Ri=[(t,e,n)=>{if(n.shouldDropSingleUserInteractionTraces&&"@opentelemetry/instrumentation-user-interaction"===t.instrumentationLibrary.name&&1===e.length)return Si.DROP_ROOT_SPAN},(t,e)=>{const n=e.filter((t=>"@opentelemetry/instrumentation-long-task"===t.instrumentationLibrary.name&&"longtask"===t.name));if(n.length>0){const e=n.map((t=>Ve(t.duration))).reduce(((t,e)=>t+e),0);t.attributes["http.longtasks_sum"]=e}},(t,e)=>{const n=e.filter(di).sort(((t,e)=>Ve(t.startTime)-Ve(e.startTime)));if(!n.length)return;const[r]=n,s=n[n.length-1];t.attributes["http.time_to_first_xhr"]=Ve(r.startTime)-Ve(t.startTime),t.attributes["http.time_to_last_xhr"]=Ve(s.endTime)-Ve(t.startTime);const i=Math.max(...e.map((t=>Ve(t.endTime))));t.attributes["http.time_to_xhr_processing_end"]=i-Ve(t.startTime);const o=[];n.forEach((t=>{const e=Ve(t.startTime),n=Ve(t.endTime),r=o[o.length-1];!r||e>r[1]?o.push([e,n]):n>r[1]&&(r[1]=n)})),t.attributes["http.time_in_xhr_calls"]=o.reduce(((t,[e,n])=>t+(n-e)),0)}],Oi={},bi="sumoLogicOpenTelemetryRumSessionId",Li=({sessionId:t,lastActivityTimestamp:e})=>{document.cookie=`${bi}=${t}-${e}; path=/`},Ai=new class{constructor(){this.generateTraceId=_e(16),this.generateSpanId=_e(8)}};let Ni=(()=>{const t=document.cookie.split("; ").find((t=>t.startsWith(`${bi}=`)));if(!t)return;const[e,n]=t.split("=")[1].split("-");return{sessionId:e,lastActivityTimestamp:parseInt(n,10)}})();const yi=()=>{const t=Date.now();if(Ni){const e=t-Ni.lastActivityTimestamp;e>3e5?Ni=void 0:e>3e4&&(Ni.lastActivityTimestamp=t,Li(Ni))}return Ni||(Ni={sessionId:Ai.generateTraceId(),lastActivityTimestamp:t},Li(Ni)),Ni.sessionId};class wi extends xn{constructor(t,e){var n,r;super(t,e),this.shouldCollectSessionId=null===(n=e.collectSessionId)||void 0===n||n,this.shouldDropSingleUserInteractionTraces=null===(r=e.dropSingleUserInteractionTraces)||void 0===r||r,this.getOverriddenServiceName=e.getOverriddenServiceName,this.defaultServiceName=e.defaultServiceName,this.traceProcessor=(t=>{const e=()=>{Object.values(Oi).forEach((t=>{n(t)}))};document.addEventListener("visibilitychange",(()=>{e()})),window.addEventListener("pagehide",(()=>{e()}));const n=({traceId:e,rootSpan:n,send:r,spans:s})=>{if(delete Oi[e],!n||!r)return;let i=!0;Ri.forEach((e=>{e(n,s,t)===Si.DROP_ROOT_SPAN&&(i=!1)})),i&&r()},r=t=>{clearTimeout(t.timeout),t.timeout=setTimeout((()=>{n(t)}),3e4)};return{onStart:(t,e)=>{const n=t.spanContext().traceId;let s=Oi[n];s||(s={traceId:n,timeout:-1,spans:[]},Oi[n]=s),t.parentSpanId||s.rootSpan||(s.rootSpan=t),r(s)},onEnd:(t,e)=>{let n=!0;const s=t,i=s.spanContext().traceId,o=Oi[i];o&&(o.spans.push(s),o.rootSpan===s&&(n=!1,o.send=()=>{e(t)}),r(o)),n&&e(t)}}})(this)}onStart(t,e=R){((t,e)=>{t.setAttribute(Ws,Qs);const n=Ve(t.startTime);for(let e=Ks.length-1;e>=0;e-=1){const{timestampInNanoseconds:r,state:s}=Ks[e];if(r<=n){t.setAttribute(Ws,s);break}}})(t),((t,e)=>{const{parentSpanId:n}=t;if(fi(t)&&n){const e=Ti(t);e&&(e.attributes[ri]=!0)}if(!n){const{traceId:e}=t.spanContext();if(_i[e]=t,Ei.push(e),Ei.length>50){const t=Ei.shift();delete _i[t]}}})(t),this.traceProcessor.onStart(t,e),this.shouldCollectSessionId&&((t,e)=>{t.setAttribute("rum.session_id",yi())})(t),((t,e,n)=>{var r;const s=null===(r=null==n?void 0:n.getOverriddenServiceName)||void 0===r?void 0:r.call(n,t);void 0!==s&&(t.setAttribute(ye,s),t.setAttribute("default.service.name",n.defaultServiceName))})(t,0,{getOverriddenServiceName:this.getOverriddenServiceName,defaultServiceName:this.defaultServiceName}),t.setAttribute("location.href",location.href),super.onStart(t,e)}onEnd(t){(t=>{const e=t,n=Ve(e.startTime),r=t.parentSpanId?Ve(e.endTime):1/0;for(let t=Ks.length-1;t>=0;t-=1){const{timestampInNanoseconds:s,timestampInHrTime:i,state:o}=Ks[t];if(s<n)break;s>=n&&s<=r&&(e.events.push({name:qs[o],attributes:void 0,time:i}),"hidden"===o&&(e.attributes[Ws]=o))}})(t),li(t,(t=>{(t=>{const e=t,n=mi.get(e);n&&n.forEach((t=>vi(t,e)));const r=fi(e),s=gi(e);if(t.parentSpanId&&(r||s)){const t=Ti(e);if(t&&(vi(e,t),!t.ended)){const n=mi.get(t);n?n.push(e):mi.set(t,[e])}}})(t),this.traceProcessor.onEnd(t,(t=>{super.onEnd(t)}))}))}}const Pi="0.32.0",Ii="longtask";class Ci extends _r{constructor(t={}){super("@opentelemetry/instrumentation-long-task",Pi,t),this.component="long-task",this.version=Pi,this.moduleName=this.component}init(){}isSupported(){return!("undefined"==typeof PerformanceObserver||!PerformanceObserver.supportedEntryTypes)&&PerformanceObserver.supportedEntryTypes.includes(Ii)}_createSpanFromEntry(t){const e=this.tracer.startSpan(Ii,{startTime:Be(t.startTime)});if(this._config.observerCallback)try{this._config.observerCallback(e,{longtaskEntry:t})}catch(t){Tt.error("longtask instrumentation: observer callback failed",t)}e.setAttribute("component",this.component),e.setAttribute("http.url",location.href),e.setAttribute("longtask.name",t.name),e.setAttribute("longtask.entry_type",t.entryType),e.setAttribute("longtask.duration",t.duration),Array.isArray(t.attribution)&&t.attribution.forEach(((n,r)=>{const s=t.attribution.length>1?`longtask.attribution[${r}]`:"longtask.attribution";e.setAttribute(`${s}.name`,n.name),e.setAttribute(`${s}.entry_type`,n.entryType),e.setAttribute(`${s}.start_time`,n.startTime),e.setAttribute(`${s}.duration`,n.duration),e.setAttribute(`${s}.container_type`,n.containerType),e.setAttribute(`${s}.container_src`,n.containerSrc),e.setAttribute(`${s}.container_id`,n.containerId),e.setAttribute(`${s}.container_name`,n.containerName)})),e.end(Be(t.startTime+t.duration))}enable(){this.isSupported()?this._observer||(this._observer=new PerformanceObserver((t=>{t.getEntries().forEach((t=>this._createSpanFromEntry(t)))})),this._observer.observe({type:Ii,buffered:!0})):this._diag.debug("Environment not supported")}disable(){this._observer&&(this._observer.disconnect(),this._observer=void 0)}}var Mi,Ui="4.3.0";!function(t){t[t.SEVERITY_NUMBER_UNSPECIFIED=0]="SEVERITY_NUMBER_UNSPECIFIED",t[t.SEVERITY_NUMBER_TRACE=1]="SEVERITY_NUMBER_TRACE",t[t.SEVERITY_NUMBER_TRACE2=2]="SEVERITY_NUMBER_TRACE2",t[t.SEVERITY_NUMBER_TRACE3=3]="SEVERITY_NUMBER_TRACE3",t[t.SEVERITY_NUMBER_TRACE4=4]="SEVERITY_NUMBER_TRACE4",t[t.SEVERITY_NUMBER_DEBUG=5]="SEVERITY_NUMBER_DEBUG",t[t.SEVERITY_NUMBER_DEBUG2=6]="SEVERITY_NUMBER_DEBUG2",t[t.SEVERITY_NUMBER_DEBUG3=7]="SEVERITY_NUMBER_DEBUG3",t[t.SEVERITY_NUMBER_DEBUG4=8]="SEVERITY_NUMBER_DEBUG4",t[t.SEVERITY_NUMBER_INFO=9]="SEVERITY_NUMBER_INFO",t[t.SEVERITY_NUMBER_INFO2=10]="SEVERITY_NUMBER_INFO2",t[t.SEVERITY_NUMBER_INFO3=11]="SEVERITY_NUMBER_INFO3",t[t.SEVERITY_NUMBER_INFO4=12]="SEVERITY_NUMBER_INFO4",t[t.SEVERITY_NUMBER_WARN=13]="SEVERITY_NUMBER_WARN",t[t.SEVERITY_NUMBER_WARN2=14]="SEVERITY_NUMBER_WARN2",t[t.SEVERITY_NUMBER_WARN3=15]="SEVERITY_NUMBER_WARN3",t[t.SEVERITY_NUMBER_WARN4=16]="SEVERITY_NUMBER_WARN4",t[t.SEVERITY_NUMBER_ERROR=17]="SEVERITY_NUMBER_ERROR",t[t.SEVERITY_NUMBER_ERROR2=18]="SEVERITY_NUMBER_ERROR2",t[t.SEVERITY_NUMBER_ERROR3=19]="SEVERITY_NUMBER_ERROR3",t[t.SEVERITY_NUMBER_ERROR4=20]="SEVERITY_NUMBER_ERROR4",t[t.SEVERITY_NUMBER_FATAL=21]="SEVERITY_NUMBER_FATAL",t[t.SEVERITY_NUMBER_FATAL2=22]="SEVERITY_NUMBER_FATAL2",t[t.SEVERITY_NUMBER_FATAL3=23]="SEVERITY_NUMBER_FATAL3",t[t.SEVERITY_NUMBER_FATAL4=24]="SEVERITY_NUMBER_FATAL4"}(Mi||(Mi={}));const Di=t=>{switch(typeof t){case"number":return Number.isInteger(t)?{intValue:t}:{doubleValue:t};case"boolean":return{boolValue:t};case"object":if(Array.isArray(t))return{arrayValue:{values:t.map((t=>Di(t)))}};if(null!=t)return{kvlistValue:{values:Object.entries(t).map((([t,e])=>xi(t,e)))}};default:return{stringValue:String(t)}}},xi=(t,e)=>({key:t,value:Di(e)}),Bi=t=>Object.entries(t).map((([t,e])=>xi(t,e)));let ki=1/0;class Vi{constructor({resource:t,attributes:e,collectorUrl:n,maxQueueSize:r,scheduledDelayMillis:s}){this.onVisibilityChange=()=>{"hidden"===document.visibilityState&&this.export()},this.onPageHide=()=>{this.export()},this.recordCustomError=(t,e)=>{this.recordLog({type:"customError",message:t,attributes:e})},this.resource=t,this.defaultAttributes=e,this.collectorUrl=n,this.maxQueueSize=r,this.scheduledDelayMillis=s,this.logs=[]}enable(){null!=document&&(this.disable(),document.addEventListener("visibilitychange",this.onVisibilityChange),document.addEventListener("pagehide",this.onPageHide))}disable(){document.removeEventListener("visibilitychange",this.onVisibilityChange),document.removeEventListener("pagehide",this.onPageHide)}exportWhenNeeded(){this.logs.length>=this.maxQueueSize?this.export():void 0===this.timer&&(this.timer=Number(setTimeout((()=>this.export()),this.scheduledDelayMillis)))}recordLog(t){var e;const n=[...Bi(this.defaultAttributes),xi("type",t.type),xi("http.url",location.href)],r=Mt.getSpan(mt.active());if(r&&(t=>"name"in t&&"instrumentationLibrary"in t)(r)){const t=null===(e=(t=>{const e=Oi[t];if(e){const{rootSpan:t,spans:n}=e;return{rootSpan:t,spans:n}}})(r.spanContext().traceId))||void 0===e?void 0:e.rootSpan;if(t){n.push(xi(ei,t.name));const e=pi(t);e&&n.push(xi(ni,e));const r=hi(t);r&&n.push(xi(si,r))}}t.element&&n.push(xi("element.xpath",t.element.xpath)),t.error&&(n.push(xi("error.name",t.error.name)),n.push(xi("error.message",t.error.message)),t.error.stack&&n.push(xi("error.stack",t.error.stack))),t.arguments&&n.push(xi("arguments",t.arguments)),t.attributes&&Object.entries(t.attributes).forEach((([t,e])=>{n.push(xi(t,e))})),this.logs.push({timeUnixNano:Ve(Be()),severityNumber:Mi.SEVERITY_NUMBER_ERROR,body:{stringValue:t.message},attributes:n,droppedAttributesCount:0,traceId:null==r?void 0:r.spanContext().traceId,spanId:null==r?void 0:r.spanContext().spanId}),this.exportWhenNeeded()}export(){clearTimeout(this.timer),this.timer=void 0;const{logs:t}=this;if(!t.length)return;this.logs=[];const e=JSON.stringify({resourceLogs:[{resource:{attributes:Bi(this.resource.attributes)},instrumentationLibraryLogs:[{instrumentationLibrary:{name:"@sumologic/opentelemetry-rum",version:Ui},logs:t}]}]});((t,e)=>{const n=new Blob([e],{type:"application/json"});(n.size>=ki||!navigator.sendBeacon(t,n))&&(ki=n.size,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:e}))})(this.collectorUrl,e)}}const Fi=(t,e)=>t.length>e?`${t.slice(0,e)}...`:t,ji=t=>t instanceof Error?{name:t.name,message:t.message,stack:t.stack?Fi(t.stack,5e3):void 0}:void 0,Hi=(t,e=0)=>{if("string"==typeof t){const n=Fi(t,500);return e>0?`"${n}"`:n}return Array.isArray(t)?e>0?"...":`[${t.map((t=>Hi(t,e+1))).join(", ")}]`:t instanceof Error?Hi({name:t.name,message:t.message},e):null!=t&&"object"==typeof t?e>0?"...":`{ ${Object.getOwnPropertyNames(t).map((n=>`${n}: ${Hi(t[n],e+1)}`)).join(", ")} }`:String(t)},$i=(t,e=new Set)=>{const n=!e.has(t);if(e.add(t),Array.isArray(t))return t.map((t=>$i(t,e)));if(null!=t&&"object"==typeof t){const r={};return Object.getOwnPropertyNames(t).forEach((s=>{const i=t[s];r[s]=e.has(i)&&(i!==t||n)?"[Circular]":$i(i)})),r}return t};class Gi{constructor({exporter:t}){this.isEnabled=!1,this.onError=t=>{this.exporter.recordLog({type:"uncaughtException",message:t.message,error:ji(t.error)})},this.onUnhandledRejection=({reason:t})=>{if(!t)return;const e=ji(t);this.exporter.recordLog({type:"unhandledRejection",message:e?`Unhandled rejection ${t}`:String(t),error:e})},this.onDocumentError=({target:t})=>{if(!t)return;const e=nr(t);e&&this.exporter.recordLog({type:"documentError",message:`Uncaught error in element ${e}`,element:{xpath:e}})},this.onConsoleError=t=>{const e=t.find(ji),n=t.length>3||t.find((t=>null!=t&&"object"==typeof t&&!(t instanceof Error)))?t.map((t=>$i(t))):void 0;this.exporter.recordLog({type:"consoleError",message:t.map((t=>Hi(t))).join(" "),arguments:n,error:e})},this.exporter=t;const e=console.error;console.error=(...t)=>{this.isEnabled&&this.onConsoleError(t),e.apply(console,t)}}enable(){this.disable(),window.addEventListener("error",this.onError),window.addEventListener("unhandledrejection",this.onUnhandledRejection),document.documentElement.addEventListener("error",this.onDocumentError,{capture:!0}),this.isEnabled=!0}disable(){window.removeEventListener("error",this.onError),window.removeEventListener("unhandledrejection",this.onUnhandledRejection),document.documentElement.removeEventListener("error",this.onDocumentError,{capture:!0}),this.isEnabled=!1}}const Xi=t=>"number"==typeof t?t:null!=t&&Number.isFinite(+t)?+t:void 0;var Yi;const zi="object"==typeof window&&null!=window;zi&&(window.sumoLogicOpenTelemetryRum=window.sumoLogicOpenTelemetryRum||{});const Wi=new class{constructor(){this._enabled=!1,this._currentContext=R}_bindFunction(t=R,e){const n=this,r=function(...r){var s;return n.with(null!==(s=Yr(this))&&void 0!==s?s:t,(()=>e.apply(this,r)))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:e.length}),r}active(){return this._currentContext}bind(t=this.active(),e){return"function"==typeof e?this._bindFunction(t,e):e}disable(){return this._enabled?(pr.unwrap(window,"Promise"),pr.unwrap(window,"setTimeout"),pr.unwrap(window,"setInterval"),null!=window.setImmediate&&pr.unwrap(window,"setImmediate"),pr.unwrap(window,"requestAnimationFrame"),null!=window.queueMicrotask&&pr.unwrap(window,"queueMicrotask"),Vr(),self.MessageChannel&&self.MessagePort&&(pr.unwrap(window,"MessageChannel"),pr.unwrap(MessagePort.prototype,"postMessage")),jr.forEach((t=>{globalThis[t]&&pr.unwrap(globalThis,t)})),this._currentContext=R,this._enabled=!1,this):this}enable(){return this._enabled||($r(this),Xr(this),kr(this),Fr(this),Hr(this),this._enabled=!0,this._currentContext=R),this}with(t,e,n,...r){const s=this._currentContext;this._currentContext=null!=t?t:R;try{return e.apply(n,r)}finally{this._currentContext=s}}};Wi.enable();const qi=({collectionSourceUrl:t,authorizationToken:e,serviceName:n,applicationName:r,deploymentEnvironment:s,defaultAttributes:i,samplingProbability:o=1,bufferMaxSpans:a=2048,maxExportBatchSize:c=50,bufferTimeout:u=2e3,ignoreUrls:l=[],propagateTraceHeaderCorsUrls:d=[],collectSessionId:h,dropSingleUserInteractionTraces:p,collectErrors:_=!0,userInteractionElementNameLimit:E=20,getOverriddenServiceName:m})=>{var T;if(!t)throw new Error("collectionSourceUrl needs to be defined to initialize Sumo Logic OpenTelemetry RUM");const f=null!==(T=Xi(o))&&void 0!==T?T:1,g=null!=n?n:"unknown",v={[ye]:g,"sumologic.rum.version":Ui};r&&(v.application=r),s&&(v[Ne]=s);const S=new Hn(v),R=S.merge(new Hn(Object.assign(Object.assign({},i),{"sampling.probability":f}))),O=new qn({resource:R,sampler:new wn(f)});O.register({contextManager:Wi,propagator:new Je});const b=Object.assign({},i),L=(t=>{const e=new URL(t);return e.pathname=e.pathname.replace(/\/v1\/(traces|metrics|logs)\/?$/,""),e.pathname.endsWith("/")||(e.pathname+="/"),e.href})(t),A=new Ys({url:`${L}v1/traces`,headers:e?{Authorization:e}:void 0}),N=new zs(A);O.addSpanProcessor(new wi(N,{maxQueueSize:a,maxExportBatchSize:c,scheduledDelayMillis:u,collectSessionId:h,dropSingleUserInteractionTraces:p,getOverriddenServiceName:m,defaultServiceName:g}));const y=S.merge(new Hn({[be]:navigator.userAgent})),w=new Vi({resource:y,attributes:b,collectorUrl:`${L}v1/logs`,maxQueueSize:a,scheduledDelayMillis:u}),P=_?new Gi({exporter:w}):void 0;let I;const C=()=>{I&&(I(),null==P||P.disable(),w.disable(),I=void 0)},M=()=>{C(),w.enable(),null==P||P.enable(),I=ir({tracerProvider:O,instrumentations:[new Ci({enabled:!1}),new Rs({enabled:!1}),new ys({enabled:!1,eventNames:ti,shouldPreventSpanCreation:(t,e,n)=>{const r=((t,e,n)=>{var r;let s="",i=e;for(;i&&!s;)s=i.getAttribute("aria-label")||i.id||i.textContent||"",s=s.trim(),i=i.parentElement;if(s){const e=null!==(r=Xi(n))&&void 0!==r?r:20;return e>0&&s.length>e&&(s=`${s.slice(0,e-3)}...`),`${t} on '${s}'`}})(t,e,E);return r&&n.updateName(r),!1}}),new gr({enabled:!1,propagateTraceHeaderCorsUrls:d,ignoreUrls:[t,...l]}),new Rr({enabled:!1,propagateTraceHeaderCorsUrls:d,ignoreUrls:l})]})},U=O.getTracer("@sumologic/opentelemetry-rum");M();const D={readyListeners:[],onReady:t=>{t()},api:Dt,tracer:U,registerInstrumentations:M,disableInstrumentations:C,setDefaultAttribute:(t,e)=>{O.resource.attributes[t]=e,b[t]=e},getCurrentSessionId:yi,recordError:w.recordCustomError};return zi&&Object.assign(window.sumoLogicOpenTelemetryRum,D),D};if(zi){window.sumoLogicOpenTelemetryRum.initialize=qi;const t=null===(Yi=window.sumoLogicOpenTelemetryRum)||void 0===Yi?void 0:Yi.readyListeners;Array.isArray(t)&&t.forEach((t=>t()))}const Ki=t=>{if(t)try{return JSON.parse(t)}catch(t){return}},Qi=t=>{var e;return null===(e=Ki(t)||(t=>{if("string"==typeof t)return t.split(",").map((t=>t.trim()))})(t))||void 0===e?void 0:e.map((t=>new RegExp(t)))};if("object"==typeof document&&null!=document&&document.currentScript&&document.currentScript.dataset.collectionSourceUrl){const{collectionSourceUrl:t,authorizationToken:e,serviceName:n,applicationName:r,defaultAttributes:s,samplingProbability:i,bufferMaxSpans:o,bufferTimeout:a,ignoreUrls:c,propagateTraceHeaderCorsUrls:u}=document.currentScript.dataset;window.opentelemetry=qi({collectionSourceUrl:t,authorizationToken:e,serviceName:n,applicationName:r,defaultAttributes:Ki(s),samplingProbability:Xi(i),bufferMaxSpans:Xi(o),bufferTimeout:Xi(a),ignoreUrls:Qi(c),propagateTraceHeaderCorsUrls:Qi(u)||[/.*/]})}t.initialize=qi,Object.defineProperty(t,"__esModule",{value:!0})}({});
//# sourceMappingURL=browser.js.map
