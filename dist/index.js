"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},e=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;const n=function(t){const n=new Set([t]),r=new Set,s=t.match(e);if(!s)return()=>!1;const i=+s[1],o=+s[2],a=+s[3];if(null!=s[4])return function(e){return e===t};function c(t){return r.add(t),!1}function u(t){return n.add(t),!0}return function(t){if(n.has(t))return!0;if(r.has(t))return!1;const s=t.match(e);if(!s)return c(t);const l=+s[1],d=+s[2],h=+s[3];return null!=s[4]||i!==l?c(t):0===i?o===d&&a<=h?u(t):c(t):o<=d?u(t):c(t)}}("1.4.0"),r="1.4.0".split(".")[0],s=Symbol.for(`opentelemetry.js.api.${r}`),i=t;function o(t,e,n,r=!1){var o;const a=i[s]=null!==(o=i[s])&&void 0!==o?o:{version:"1.4.0"};if(!r&&a[t]){const e=new Error(`@opentelemetry/api: Attempted duplicate registration of API: ${t}`);return n.error(e.stack||e.message),!1}if("1.4.0"!==a.version){const t=new Error("@opentelemetry/api: All API registration versions must match");return n.error(t.stack||t.message),!1}return a[t]=e,n.debug(`@opentelemetry/api: Registered a global for ${t} v1.4.0.`),!0}function a(t){var e,r;const o=null===(e=i[s])||void 0===e?void 0:e.version;if(o&&n(o))return null===(r=i[s])||void 0===r?void 0:r[t]}function c(t,e){e.debug(`@opentelemetry/api: Unregistering a global for ${t} v1.4.0.`);const n=i[s];n&&delete n[t]}class u{constructor(t){this._namespace=t.namespace||"DiagComponentLogger"}debug(...t){return l("debug",this._namespace,t)}error(...t){return l("error",this._namespace,t)}info(...t){return l("info",this._namespace,t)}warn(...t){return l("warn",this._namespace,t)}verbose(...t){return l("verbose",this._namespace,t)}}function l(t,e,n){const r=a("diag");if(r)return n.unshift(e),r[t](...n)}var d;!function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"}(d||(d={}));class h{constructor(){function t(t){return function(...e){const n=a("diag");if(n)return n[t](...e)}}const e=this;e.setLogger=(t,n={logLevel:d.INFO})=>{var r,s,i;if(t===e){const t=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return e.error(null!==(r=t.stack)&&void 0!==r?r:t.message),!1}"number"==typeof n&&(n={logLevel:n});const c=a("diag"),u=function(t,e){function n(n,r){const s=e[n];return"function"==typeof s&&t>=r?s.bind(e):function(){}}return t<d.NONE?t=d.NONE:t>d.ALL&&(t=d.ALL),e=e||{},{error:n("error",d.ERROR),warn:n("warn",d.WARN),info:n("info",d.INFO),debug:n("debug",d.DEBUG),verbose:n("verbose",d.VERBOSE)}}(null!==(s=n.logLevel)&&void 0!==s?s:d.INFO,t);if(c&&!n.suppressOverrideMessage){const t=null!==(i=(new Error).stack)&&void 0!==i?i:"<failed to generate stacktrace>";c.warn(`Current logger will be overwritten from ${t}`),u.warn(`Current logger will overwrite one already registered from ${t}`)}return o("diag",u,e,!0)},e.disable=()=>{c("diag",e)},e.createComponentLogger=t=>new u(t),e.verbose=t("verbose"),e.debug=t("debug"),e.info=t("info"),e.warn=t("warn"),e.error=t("error")}static instance(){return this._instance||(this._instance=new h),this._instance}}class p{constructor(t){this._entries=t?new Map(t):new Map}getEntry(t){const e=this._entries.get(t);if(e)return Object.assign({},e)}getAllEntries(){return Array.from(this._entries.entries()).map((([t,e])=>[t,e]))}setEntry(t,e){const n=new p(this._entries);return n._entries.set(t,e),n}removeEntry(t){const e=new p(this._entries);return e._entries.delete(t),e}removeEntries(...t){const e=new p(this._entries);for(const n of t)e._entries.delete(n);return e}clear(){return new p}}const _=Symbol("BaggageEntryMetadata"),E=h.instance();function m(t={}){return new p(new Map(Object.entries(t)))}function T(t){return"string"!=typeof t&&(E.error("Cannot create baggage metadata from unknown type: "+typeof t),t=""),{__TYPE__:_,toString:()=>t}}function f(t){return Symbol.for(t)}class g{constructor(t){const e=this;e._currentContext=t?new Map(t):new Map,e.getValue=t=>e._currentContext.get(t),e.setValue=(t,n)=>{const r=new g(e._currentContext);return r._currentContext.set(t,n),r},e.deleteValue=t=>{const n=new g(e._currentContext);return n._currentContext.delete(t),n}}}const v=new g,S=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}];class R{}class O{addCallback(t){}removeCallback(t){}}const b=new class{constructor(){}createHistogram(t,e){return A}createCounter(t,e){return L}createUpDownCounter(t,e){return N}createObservableGauge(t,e){return w}createObservableCounter(t,e){return y}createObservableUpDownCounter(t,e){return P}addBatchObservableCallback(t,e){}removeBatchObservableCallback(t){}},L=new class extends R{add(t,e){}},A=new class extends R{record(t,e){}},N=new class extends R{add(t,e){}},y=new class extends O{},w=new class extends O{},P=new class extends O{};var I;!function(t){t[t.INT=0]="INT",t[t.DOUBLE=1]="DOUBLE"}(I||(I={}));const C={get(t,e){if(null!=t)return t[e]},keys:t=>null==t?[]:Object.keys(t)},M={set(t,e,n){null!=t&&(t[e]=n)}};const U=new class{active(){return v}with(t,e,n,...r){return e.call(n,...r)}bind(t,e){return e}enable(){return this}disable(){return this}};class D{constructor(){}static getInstance(){return this._instance||(this._instance=new D),this._instance}setGlobalContextManager(t){return o("context",t,h.instance())}active(){return this._getContextManager().active()}with(t,e,n,...r){return this._getContextManager().with(t,e,n,...r)}bind(t,e){return this._getContextManager().bind(t,e)}_getContextManager(){return a("context")||U}disable(){this._getContextManager().disable(),c("context",h.instance())}}var x;!function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"}(x||(x={}));const B="00000000000000000000000000000000",k={traceId:B,spanId:"0000000000000000",traceFlags:x.NONE};class V{constructor(t=k){this._spanContext=t}spanContext(){return this._spanContext}setAttribute(t,e){return this}setAttributes(t){return this}addEvent(t,e){return this}setStatus(t){return this}updateName(t){return this}end(t){}isRecording(){return!1}recordException(t,e){}}const j=f("OpenTelemetry Context Key SPAN");function F(t){return t.getValue(j)||void 0}function H(){return F(D.getInstance().active())}function $(t,e){return t.setValue(j,e)}function G(t){return t.deleteValue(j)}function X(t,e){return $(t,new V(e))}function Y(t){var e;return null===(e=F(t))||void 0===e?void 0:e.spanContext()}const z=/^([0-9a-f]{32})$/i,W=/^[0-9a-f]{16}$/i;function q(t){return z.test(t)&&t!==B}function K(t){return W.test(t)&&"0000000000000000"!==t}function Q(t){return q(t.traceId)&&K(t.spanId)}function J(t){return new V(t)}const Z=D.getInstance();class tt{startSpan(t,e,n=Z.active()){if(Boolean(null==e?void 0:e.root))return new V;const r=n&&Y(n);return"object"==typeof(s=r)&&"string"==typeof s.spanId&&"string"==typeof s.traceId&&"number"==typeof s.traceFlags&&Q(r)?new V(r):new V;var s}startActiveSpan(t,e,n,r){let s,i,o;if(arguments.length<2)return;2===arguments.length?o=e:3===arguments.length?(s=e,o=n):(s=e,i=n,o=r);const a=null!=i?i:Z.active(),c=this.startSpan(t,s,a),u=$(a,c);return Z.with(u,o,void 0,c)}}const et=new tt;class nt{constructor(t,e,n,r){this._provider=t,this.name=e,this.version=n,this.options=r}startSpan(t,e,n){return this._getTracer().startSpan(t,e,n)}startActiveSpan(t,e,n,r){const s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)}_getTracer(){if(this._delegate)return this._delegate;const t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):et}}const rt=new class{getTracer(t,e,n){return new tt}};class st{getTracer(t,e,n){var r;return null!==(r=this.getDelegateTracer(t,e,n))&&void 0!==r?r:new nt(this,t,e,n)}getDelegate(){var t;return null!==(t=this._delegate)&&void 0!==t?t:rt}setDelegate(t){this._delegate=t}getDelegateTracer(t,e,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(t,e,n)}}var it,ot,at;!function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(it||(it={})),function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"}(ot||(ot={})),function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"}(at||(at={}));const ct=new RegExp("^(?:[a-z][_0-9a-z-*/]{0,255}|[a-z0-9][_0-9a-z-*/]{0,240}@[a-z][_0-9a-z-*/]{0,13})$"),ut=/^[ -~]{0,255}[!-~]$/,lt=/,|=/;class dt{constructor(t){this._internalState=new Map,t&&this._parse(t)}set(t,e){const n=this._clone();return n._internalState.has(t)&&n._internalState.delete(t),n._internalState.set(t,e),n}unset(t){const e=this._clone();return e._internalState.delete(t),e}get(t){return this._internalState.get(t)}serialize(){return this._keys().reduce(((t,e)=>(t.push(e+"="+this.get(e)),t)),[]).join(",")}_parse(t){t.length>512||(this._internalState=t.split(",").reverse().reduce(((t,e)=>{const n=e.trim(),r=n.indexOf("=");if(-1!==r){const s=n.slice(0,r),i=n.slice(r+1,e.length);(function(t){return ct.test(t)})(s)&&function(t){return ut.test(t)&&!lt.test(t)}(i)&&t.set(s,i)}return t}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const t=new dt;return t._internalState=new Map(this._internalState),t}}const ht=D.getInstance(),pt=h.instance();const _t=new class{getMeter(t,e,n){return b}};class Et{constructor(){}static getInstance(){return this._instance||(this._instance=new Et),this._instance}setGlobalMeterProvider(t){return o("metrics",t,h.instance())}getMeterProvider(){return a("metrics")||_t}getMeter(t,e,n){return this.getMeterProvider().getMeter(t,e,n)}disable(){c("metrics",h.instance())}}const mt=Et.getInstance();const Tt=f("OpenTelemetry Baggage Key");function ft(t){return t.getValue(Tt)||void 0}function gt(){return ft(D.getInstance().active())}function vt(t,e){return t.setValue(Tt,e)}function St(t){return t.deleteValue(Tt)}const Rt=new class{inject(t,e){}extract(t,e){return t}fields(){return[]}};class Ot{constructor(){this.createBaggage=m,this.getBaggage=ft,this.getActiveBaggage=gt,this.setBaggage=vt,this.deleteBaggage=St}static getInstance(){return this._instance||(this._instance=new Ot),this._instance}setGlobalPropagator(t){return o("propagation",t,h.instance())}inject(t,e,n=M){return this._getGlobalPropagator().inject(t,e,n)}extract(t,e,n=C){return this._getGlobalPropagator().extract(t,e,n)}fields(){return this._getGlobalPropagator().fields()}disable(){c("propagation",h.instance())}_getGlobalPropagator(){return a("propagation")||Rt}}const bt=Ot.getInstance();class Lt{constructor(){this._proxyTracerProvider=new st,this.wrapSpanContext=J,this.isSpanContextValid=Q,this.deleteSpan=G,this.getSpan=F,this.getActiveSpan=H,this.getSpanContext=Y,this.setSpan=$,this.setSpanContext=X}static getInstance(){return this._instance||(this._instance=new Lt),this._instance}setGlobalTracerProvider(t){const e=o("trace",this._proxyTracerProvider,h.instance());return e&&this._proxyTracerProvider.setDelegate(t),e}getTracerProvider(){return a("trace")||this._proxyTracerProvider}getTracer(t,e){return this.getTracerProvider().getTracer(t,e)}disable(){c("trace",h.instance()),this._proxyTracerProvider=new st}}const At=Lt.getInstance();var Nt={context:ht,diag:pt,metrics:mt,propagation:bt,trace:At},yt=Object.freeze({__proto__:null,context:ht,diag:pt,metrics:mt,propagation:bt,trace:At,default:Nt,baggageEntryMetadataFromString:T,createContextKey:f,ROOT_CONTEXT:v,DiagConsoleLogger:class{constructor(){function t(t){return function(...e){if(console){let n=console[t];if("function"!=typeof n&&(n=console.log),"function"==typeof n)return n.apply(console,e)}}}for(let e=0;e<S.length;e++)this[S[e].n]=t(S[e].c)}},get DiagLogLevel(){return d},createNoopMeter:function(){return b},get ValueType(){return I},defaultTextMapGetter:C,defaultTextMapSetter:M,ProxyTracer:nt,ProxyTracerProvider:st,get SamplingDecision(){return it},get SpanKind(){return ot},get SpanStatusCode(){return at},get TraceFlags(){return x},createTraceState:function(t){return new dt(t)},isSpanContextValid:Q,isValidTraceId:q,isValidSpanId:K,INVALID_SPANID:"0000000000000000",INVALID_TRACEID:B,INVALID_SPAN_CONTEXT:k});const wt=f("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function Pt(t){return!0===t.getValue(wt)}function It(t){const e=t.split(";");if(e.length<=0)return;const n=e.shift();if(!n)return;const r=n.split("=");if(2!==r.length)return;const s=decodeURIComponent(r[0].trim()),i=decodeURIComponent(r[1].trim());let o;return e.length>0&&(o=T(e.join(";"))),{key:s,value:i,metadata:o}}function Ct(t){return"string"!=typeof t||0===t.length?{}:t.split(",").map((t=>It(t))).filter((t=>void 0!==t&&t.value.length>0)).reduce(((t,e)=>(t[e.key]=e.value,t)),{})}class Mt{inject(t,e,n){const r=bt.getBaggage(t);if(!r||Pt(t))return;const s=function(t){return t.reduce(((t,e)=>{const n=`${t}${""!==t?",":""}${e}`;return n.length>8192?t:n}),"")}(function(t){return t.getAllEntries().map((([t,e])=>{let n=`${encodeURIComponent(t)}=${encodeURIComponent(e.value)}`;return void 0!==e.metadata&&(n+=";"+e.metadata.toString()),n}))}(r).filter((t=>t.length<=4096)).slice(0,180));s.length>0&&n.set(e,"baggage",s)}extract(t,e,n){const r=n.get(e,"baggage"),s=Array.isArray(r)?r.join(","):r;if(!s)return t;const i={};if(0===s.length)return t;return s.split(",").forEach((t=>{const e=It(t);if(e){const t={value:e.value};e.metadata&&(t.metadata=e.metadata),i[e.key]=t}})),0===Object.entries(i).length?t:bt.setBaggage(t,bt.createBaggage(i))}fields(){return["baggage"]}}function Ut(t){const e={};if("object"!=typeof t||null==t)return e;for(const[n,r]of Object.entries(t))Dt(n)?xt(r)?Array.isArray(r)?e[n]=r.slice():e[n]=r:pt.warn(`Invalid attribute value set for key: ${n}`):pt.warn(`Invalid attribute key: ${n}`);return e}function Dt(t){return"string"==typeof t&&t.length>0}function xt(t){return null==t||(Array.isArray(t)?function(t){let e;for(const n of t)if(null!=n){if(!e){if(Bt(n)){e=typeof n;continue}return!1}if(typeof n!==e)return!1}return!0}(t):Bt(t))}function Bt(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}let kt=t=>{pt.error(function(t){return"string"==typeof t?t:JSON.stringify(function(t){const e={};let n=t;for(;null!==n;)Object.getOwnPropertyNames(n).forEach((t=>{if(e[t])return;const r=n[t];r&&(e[t]=String(r))})),n=Object.getPrototypeOf(n);return e}(t))}(t))};function Vt(t){try{kt(t)}catch(t){}}var jt;!function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"}(jt||(jt={}));const Ft="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},Ht=["OTEL_SDK_DISABLED"];function $t(t){return Ht.indexOf(t)>-1}const Gt=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function Xt(t){return Gt.indexOf(t)>-1}const Yt=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function zt(t){return Yt.indexOf(t)>-1}const Wt={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:d.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:Infinity,OTEL_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:Infinity,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:jt.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};function qt(t,e,n){if(void 0===n[t])return;const r=String(n[t]);e[t]="true"===r.toLowerCase()}function Kt(t,e,n,r=-1/0,s=1/0){if(void 0!==n[t]){const i=Number(n[t]);isNaN(i)||(e[t]=i<r?r:i>s?s:i)}}function Qt(t,e,n,r=","){const s=n[t];"string"==typeof s&&(e[t]=s.split(r).map((t=>t.trim())))}const Jt={ALL:d.ALL,VERBOSE:d.VERBOSE,DEBUG:d.DEBUG,INFO:d.INFO,WARN:d.WARN,ERROR:d.ERROR,NONE:d.NONE};function Zt(t,e,n){const r=n[t];if("string"==typeof r){const n=Jt[r.toUpperCase()];null!=n&&(e[t]=n)}}function te(t){const e={};for(const n in Wt){const r=n;switch(r){case"OTEL_LOG_LEVEL":Zt(r,e,t);break;default:if($t(r))qt(r,e,t);else if(Xt(r))Kt(r,e,t);else if(zt(r))Qt(r,e,t);else{const n=t[r];null!=n&&(e[r]=String(n))}}}return e}function ee(){const t=te(Ft);return Object.assign({},Wt,t)}function ne(t){const e=t.length;let n="";for(let r=0;r<e;r+=2){const e=t.substring(r,r+2),s=parseInt(e,16);n+=String.fromCharCode(s)}return btoa(n)}const re=Array(32);function se(t){return function(){for(let e=0;e<2*t;e++)re[e]=Math.floor(16*Math.random())+48,re[e]>=58&&(re[e]+=39);return String.fromCharCode.apply(null,re.slice(0,2*t))}}const ie=performance,oe="exception.type",ae="exception.message",ce="exception.stacktrace",ue="http.method",le="http.url",de="http.host",he="http.scheme",pe="http.status_code",_e="http.user_agent",Ee="http.response_content_length",me="http.response_content_length_uncompressed",Te="deployment.environment",fe="service.name",ge="telemetry.sdk.name",ve="telemetry.sdk.language",Se="telemetry.sdk.version",Re={[ge]:"opentelemetry",["process.runtime.name"]:"browser",[ve]:"webjs",[Se]:"1.9.0"};const Oe=Math.pow(10,6),be=Math.pow(10,9);function Le(t){const e=t/1e3;return[Math.trunc(e),Math.round(t%1e3*Oe)]}function Ae(){let t=ie.timeOrigin;if("number"!=typeof t){const e=ie;t=e.timing&&e.timing.fetchStart}return t}function Ne(t){return Ce(Le(Ae()),Le("number"==typeof t?t:ie.now()))}function ye(t){if(Pe(t))return t;if("number"==typeof t)return t<Ae()?Ne(t):Le(t);if(t instanceof Date)return Le(t.getTime());throw TypeError("Invalid input type")}function we(t){return t[0]*be+t[1]}function Pe(t){return Array.isArray(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]}function Ie(t){return Pe(t)||"number"==typeof t||t instanceof Date}function Ce(t,e){const n=[t[0]+e[0],t[1]+e[1]];return n[1]>=be&&(n[1]-=be,n[0]+=1),n}var Me;!function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"}(Me||(Me={}));class Ue{constructor(t={}){var e;this._propagators=null!==(e=t.propagators)&&void 0!==e?e:[],this._fields=Array.from(new Set(this._propagators.map((t=>"function"==typeof t.fields?t.fields():[])).reduce(((t,e)=>t.concat(e)),[])))}inject(t,e,n){for(const r of this._propagators)try{r.inject(t,e,n)}catch(t){pt.warn(`Failed to inject with ${r.constructor.name}. Err: ${t.message}`)}}extract(t,e,n){return this._propagators.reduce(((t,r)=>{try{return r.extract(t,e,n)}catch(t){pt.warn(`Failed to inject with ${r.constructor.name}. Err: ${t.message}`)}return t}),t)}fields(){return this._fields.slice()}}const De=new RegExp("^(?:[a-z][_0-9a-z-*/]{0,255}|[a-z0-9][_0-9a-z-*/]{0,240}@[a-z][_0-9a-z-*/]{0,13})$"),xe=/^[ -~]{0,255}[!-~]$/,Be=/,|=/;class ke{constructor(t){this._internalState=new Map,t&&this._parse(t)}set(t,e){const n=this._clone();return n._internalState.has(t)&&n._internalState.delete(t),n._internalState.set(t,e),n}unset(t){const e=this._clone();return e._internalState.delete(t),e}get(t){return this._internalState.get(t)}serialize(){return this._keys().reduce(((t,e)=>(t.push(e+"="+this.get(e)),t)),[]).join(",")}_parse(t){t.length>512||(this._internalState=t.split(",").reverse().reduce(((t,e)=>{const n=e.trim(),r=n.indexOf("=");if(-1!==r){const s=n.slice(0,r),i=n.slice(r+1,e.length);(function(t){return De.test(t)})(s)&&function(t){return xe.test(t)&&!Be.test(t)}(i)&&t.set(s,i)}return t}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const t=new ke;return t._internalState=new Map(this._internalState),t}}const Ve=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");class je{inject(t,e,n){const r=At.getSpanContext(t);if(!r||Pt(t)||!Q(r))return;const s=`00-${r.traceId}-${r.spanId}-0${Number(r.traceFlags||x.NONE).toString(16)}`;n.set(e,"traceparent",s),r.traceState&&n.set(e,"tracestate",r.traceState.serialize())}extract(t,e,n){const r=n.get(e,"traceparent");if(!r)return t;const s=Array.isArray(r)?r[0]:r;if("string"!=typeof s)return t;const i=function(t){const e=Ve.exec(t);return e?"00"===e[1]&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}:null}(s);if(!i)return t;i.isRemote=!0;const o=n.get(e,"tracestate");if(o){const t=Array.isArray(o)?o.join(","):o;i.traceState=new ke("string"==typeof t?t:void 0)}return At.setSpanContext(t,i)}fields(){return["traceparent","tracestate"]}}var Fe;!function(t){t.HTTP="http"}(Fe||(Fe={}));const He=Function.prototype.toString,$e=He.call(Object),Ge=(Xe=Object.getPrototypeOf,Ye=Object,function(t){return Xe(Ye(t))});var Xe,Ye;const ze=Object.prototype,We=ze.hasOwnProperty,qe=Symbol?Symbol.toStringTag:void 0,Ke=ze.toString;function Qe(t){if(!function(t){return null!=t&&"object"==typeof t}(t)||"[object Object]"!==function(t){if(null==t)return void 0===t?"[object Undefined]":"[object Null]";return qe&&qe in Object(t)?function(t){const e=We.call(t,qe),n=t[qe];let r=!1;try{t[qe]=void 0,r=!0}catch(t){}const s=Ke.call(t);r&&(e?t[qe]=n:delete t[qe]);return s}(t):function(t){return Ke.call(t)}(t)}(t))return!1;const e=Ge(t);if(null===e)return!0;const n=We.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&He.call(n)===$e}function Je(t){return en(t)?t.slice():t}function Ze(t,e,n=0,r){let s;if(!(n>20)){if(n++,sn(t)||sn(e)||nn(e))s=Je(e);else if(en(t)){if(s=t.slice(),en(e))for(let t=0,n=e.length;t<n;t++)s.push(Je(e[t]));else if(rn(e)){const t=Object.keys(e);for(let n=0,r=t.length;n<r;n++){const r=t[n];s[r]=Je(e[r])}}}else if(rn(t))if(rn(e)){if(!function(t,e){if(!Qe(t)||!Qe(e))return!1;return!0}(t,e))return e;s=Object.assign({},t);const i=Object.keys(e);for(let o=0,a=i.length;o<a;o++){const a=i[o],c=e[a];if(sn(c))void 0===c?delete s[a]:s[a]=c;else{const i=s[a],o=c;if(tn(t,a,r)||tn(e,a,r))delete s[a];else{if(rn(i)&&rn(o)){const n=r.get(i)||[],s=r.get(o)||[];n.push({obj:t,key:a}),s.push({obj:e,key:a}),r.set(i,n),r.set(o,s)}s[a]=Ze(s[a],c,n,r)}}}}else s=e;return s}}function tn(t,e,n){const r=n.get(t[e])||[];for(let n=0,s=r.length;n<s;n++){const s=r[n];if(s.key===e&&s.obj===t)return!0}return!1}function en(t){return Array.isArray(t)}function nn(t){return"function"==typeof t}function rn(t){return!sn(t)&&!en(t)&&!nn(t)&&"object"==typeof t}function sn(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||void 0===t||t instanceof Date||t instanceof RegExp||null===t}function on(t,e){return"string"==typeof e?t===e:!!t.match(e)}function an(t,e){if(!e)return!1;for(const n of e)if(on(t,n))return!0;return!1}class cn{constructor(){this._promise=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}get promise(){return this._promise}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}class un{constructor(t,e){this._callback=t,this._that=e,this._isCalled=!1,this._deferred=new cn}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...t){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...t)).then((t=>this._deferred.resolve(t)),(t=>this._deferred.reject(t)))}catch(t){this._deferred.reject(t)}}return this._deferred.promise}}class ln{constructor(t,e,n,r,s,i,o=[],a,c){this.attributes={},this.links=[],this.events=[],this.status={code:at.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=n,this._spanContext=r,this.parentSpanId=i,this.kind=s,this.links=o;const u=Date.now();this._performanceStartTime=ie.now(),this._performanceOffset=u-(this._performanceStartTime+Ae()),this._startTimeProvided=null!=a,this.startTime=this._getTime(null!=a?a:u),this.resource=t.resource,this.instrumentationLibrary=t.instrumentationLibrary,this._spanLimits=t.getSpanLimits(),this._spanProcessor=t.getActiveSpanProcessor(),this._spanProcessor.onStart(this,e),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0}spanContext(){return this._spanContext}setAttribute(t,e){return null==e||this._isSpanEnded()?this:0===t.length?(pt.warn(`Invalid attribute key: ${t}`),this):xt(e)?(Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,t)||(this.attributes[t]=this._truncateToSize(e)),this):(pt.warn(`Invalid attribute value set for key: ${t}`),this)}setAttributes(t){for(const[e,n]of Object.entries(t))this.setAttribute(e,n);return this}addEvent(t,e,n){if(this._isSpanEnded())return this;if(0===this._spanLimits.eventCountLimit)return pt.warn("No events allowed."),this;this.events.length>=this._spanLimits.eventCountLimit&&(pt.warn("Dropping extra events."),this.events.shift()),Ie(e)&&(Ie(n)||(n=e),e=void 0);const r=Ut(e);return this.events.push({name:t,attributes:r,time:this._getTime(n)}),this}setStatus(t){return this._isSpanEnded()||(this.status=t),this}updateName(t){return this._isSpanEnded()||(this.name=t),this}end(t){this._isSpanEnded()?pt.error("You can only call end() on a span once."):(this._ended=!0,this.endTime=this._getTime(t),this._duration=function(t,e){let n=e[0]-t[0],r=e[1]-t[1];return r<0&&(n-=1,r+=be),[n,r]}(this.startTime,this.endTime),this._duration[0]<0&&(pt.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._spanProcessor.onEnd(this))}_getTime(t){if("number"==typeof t&&t<ie.now())return Ne(t+this._performanceOffset);if("number"==typeof t)return Le(t);if(t instanceof Date)return Le(t.getTime());if(Pe(t))return t;if(this._startTimeProvided)return Le(Date.now());const e=ie.now()-this._performanceStartTime;return Ce(this.startTime,Le(e))}isRecording(){return!1===this._ended}recordException(t,e){const n={};"string"==typeof t?n[ae]=t:t&&(t.code?n[oe]=t.code.toString():t.name&&(n[oe]=t.name),t.message&&(n[ae]=t.message),t.stack&&(n[ce]=t.stack)),n[oe]||n[ae]?this.addEvent("exception",n,e):pt.warn(`Failed to record an exception ${t}`)}get duration(){return this._duration}get ended(){return this._ended}_isSpanEnded(){return this._ended&&pt.warn(`Can not execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`),this._ended}_truncateToLimitUtil(t,e){return t.length<=e?t:t.substr(0,e)}_truncateToSize(t){const e=this._attributeValueLengthLimit;return e<=0?(pt.warn(`Attribute value limit must be positive, got ${e}`),t):"string"==typeof t?this._truncateToLimitUtil(t,e):Array.isArray(t)?t.map((t=>"string"==typeof t?this._truncateToLimitUtil(t,e):t)):t}}var dn;!function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(dn||(dn={}));class hn{shouldSample(){return{decision:dn.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}class pn{shouldSample(){return{decision:dn.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}class _n{constructor(t){var e,n,r,s;this._root=t.root,this._root||(Vt(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new pn),this._remoteParentSampled=null!==(e=t.remoteParentSampled)&&void 0!==e?e:new pn,this._remoteParentNotSampled=null!==(n=t.remoteParentNotSampled)&&void 0!==n?n:new hn,this._localParentSampled=null!==(r=t.localParentSampled)&&void 0!==r?r:new pn,this._localParentNotSampled=null!==(s=t.localParentNotSampled)&&void 0!==s?s:new hn}shouldSample(t,e,n,r,s,i){const o=At.getSpanContext(t);return o&&Q(o)?o.isRemote?o.traceFlags&x.SAMPLED?this._remoteParentSampled.shouldSample(t,e,n,r,s,i):this._remoteParentNotSampled.shouldSample(t,e,n,r,s,i):o.traceFlags&x.SAMPLED?this._localParentSampled.shouldSample(t,e,n,r,s,i):this._localParentNotSampled.shouldSample(t,e,n,r,s,i):this._root.shouldSample(t,e,n,r,s,i)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}}class En{constructor(t=0){this._ratio=t,this._ratio=this._normalize(t),this._upperBound=Math.floor(4294967295*this._ratio)}shouldSample(t,e){return{decision:q(e)&&this._accumulate(e)<this._upperBound?dn.RECORD_AND_SAMPLED:dn.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(t){return"number"!=typeof t||isNaN(t)?0:t>=1?1:t<=0?0:t}_accumulate(t){let e=0;for(let n=0;n<t.length/8;n++){const r=8*n;e=(e^parseInt(t.slice(r,r+8),16))>>>0}return e}}const mn=ee(),Tn=jt.AlwaysOn;function fn(){return{sampler:gn(mn),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:ee().OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:ee().OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:ee().OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:ee().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:ee().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:ee().OTEL_SPAN_EVENT_COUNT_LIMIT}}}function gn(t=ee()){switch(t.OTEL_TRACES_SAMPLER){case jt.AlwaysOn:return new pn;case jt.AlwaysOff:return new hn;case jt.ParentBasedAlwaysOn:return new _n({root:new pn});case jt.ParentBasedAlwaysOff:return new _n({root:new hn});case jt.TraceIdRatio:return new En(vn(t));case jt.ParentBasedTraceIdRatio:return new _n({root:new En(vn(t))});default:return pt.error(`OTEL_TRACES_SAMPLER value "${t.OTEL_TRACES_SAMPLER} invalid, defaulting to ${Tn}".`),new pn}}function vn(t){if(void 0===t.OTEL_TRACES_SAMPLER_ARG||""===t.OTEL_TRACES_SAMPLER_ARG)return pt.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1;const e=Number(t.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(pt.error(`OTEL_TRACES_SAMPLER_ARG=${t.OTEL_TRACES_SAMPLER_ARG} was given, but it is invalid, defaulting to 1.`),1):e<0||e>1?(pt.error(`OTEL_TRACES_SAMPLER_ARG=${t.OTEL_TRACES_SAMPLER_ARG} was given, but it is out of range ([0..1]), defaulting to 1.`),1):e}function Sn(t){var e,n,r,s,i,o,a,c,u,l,d,h;const p=Object.assign({},t.spanLimits),_="undefined"!=typeof process?te(process.env):te(Ft);return p.attributeCountLimit=null!==(o=null!==(i=null!==(s=null!==(n=null===(e=t.spanLimits)||void 0===e?void 0:e.attributeCountLimit)&&void 0!==n?n:null===(r=t.generalLimits)||void 0===r?void 0:r.attributeCountLimit)&&void 0!==s?s:_.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)&&void 0!==i?i:_.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==o?o:128,p.attributeValueLengthLimit=null!==(h=null!==(d=null!==(l=null!==(c=null===(a=t.spanLimits)||void 0===a?void 0:a.attributeValueLengthLimit)&&void 0!==c?c:null===(u=t.generalLimits)||void 0===u?void 0:u.attributeValueLengthLimit)&&void 0!==l?l:_.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==d?d:_.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==h?h:Infinity,Object.assign({},t,{spanLimits:p})}class Rn extends class{constructor(t,e){this._exporter=t,this._finishedSpans=[];const n=ee();this._maxExportBatchSize="number"==typeof(null==e?void 0:e.maxExportBatchSize)?e.maxExportBatchSize:n.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==e?void 0:e.maxQueueSize)?e.maxQueueSize:n.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==e?void 0:e.scheduledDelayMillis)?e.scheduledDelayMillis:n.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==e?void 0:e.exportTimeoutMillis)?e.exportTimeoutMillis:n.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new un(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(pt.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}onStart(t,e){}onEnd(t){this._shutdownOnce.isCalled||0!=(t.spanContext().traceFlags&x.SAMPLED)&&this._addToBuffer(t)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return Promise.resolve().then((()=>this.onShutdown())).then((()=>this._flushAll())).then((()=>this._exporter.shutdown()))}_addToBuffer(t){this._finishedSpans.length>=this._maxQueueSize||(this._finishedSpans.push(t),this._maybeStartTimer())}_flushAll(){return new Promise(((t,e)=>{const n=[];for(let t=0,e=Math.ceil(this._finishedSpans.length/this._maxExportBatchSize);t<e;t++)n.push(this._flushOneBatch());Promise.all(n).then((()=>{t()})).catch(e)}))}_flushOneBatch(){return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise(((t,e)=>{const n=setTimeout((()=>{e(new Error("Timeout"))}),this._exportTimeoutMillis);ht.with(function(t){return t.setValue(wt,!0)}(ht.active()),(()=>{this._exporter.export(this._finishedSpans.splice(0,this._maxExportBatchSize),(r=>{var s;clearTimeout(n),r.code===Me.SUCCESS?t():e(null!==(s=r.error)&&void 0!==s?s:new Error("BatchSpanProcessor: span export failed"))}))}))}))}_maybeStartTimer(){void 0===this._timer&&(this._timer=window.setTimeout((()=>{this._flushOneBatch().then((()=>{this._finishedSpans.length>0&&(this._clearTimer(),this._maybeStartTimer())})).catch((t=>{Vt(t)}))}),this._scheduledDelayMillis),this._timer)}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}}{constructor(t,e){super(t,e),this.onInit(e)}onInit(t){!0!==(null==t?void 0:t.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=()=>{"hidden"===(null===document||void 0===document?void 0:document.visibilityState)&&this.forceFlush()},this._pageHideListener=()=>{this.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))}onShutdown(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))}}class On{constructor(){this.generateTraceId=Ln(16),this.generateSpanId=Ln(8)}}const bn=Array(32);function Ln(t){return function(){for(let e=0;e<2*t;e++)bn[e]=Math.floor(16*Math.random())+48,bn[e]>=58&&(bn[e]+=39);return String.fromCharCode.apply(null,bn.slice(0,2*t))}}class An{constructor(t,e,n){this._tracerProvider=n;const r=function(t){const e={sampler:gn()},n=fn(),r=Object.assign({},n,e,t);return r.generalLimits=Object.assign({},n.generalLimits,t.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,t.spanLimits||{}),r}(e);this._sampler=r.sampler,this._generalLimits=r.generalLimits,this._spanLimits=r.spanLimits,this._idGenerator=e.idGenerator||new On,this.resource=n.resource,this.instrumentationLibrary=t}startSpan(t,e={},n=ht.active()){var r,s;e.root&&(n=At.deleteSpan(n));const i=At.getSpan(n);if(Pt(n)){pt.debug("Instrumentation suppressed, returning Noop Span");return At.wrapSpanContext(k)}const o=null==i?void 0:i.spanContext(),a=this._idGenerator.generateSpanId();let c,u,l;o&&At.isSpanContextValid(o)?(c=o.traceId,u=o.traceState,l=o.spanId):c=this._idGenerator.generateTraceId();const d=null!==(r=e.kind)&&void 0!==r?r:ot.INTERNAL,h=(null!==(s=e.links)&&void 0!==s?s:[]).map((t=>({context:t.context,attributes:Ut(t.attributes)}))),p=Ut(e.attributes),_=this._sampler.shouldSample(n,c,t,d,p,h),E={traceId:c,spanId:a,traceFlags:_.decision===it.RECORD_AND_SAMPLED?x.SAMPLED:x.NONE,traceState:u};if(_.decision===it.NOT_RECORD){pt.debug("Recording is off, propagating context in a non-recording span");return At.wrapSpanContext(E)}const m=new ln(this,n,t,E,d,l,h,e.startTime),T=Ut(Object.assign(p,_.attributes));return m.setAttributes(T),m}startActiveSpan(t,e,n,r){let s,i,o;if(arguments.length<2)return;2===arguments.length?o=e:3===arguments.length?(s=e,o=n):(s=e,i=n,o=r);const a=null!=i?i:ht.active(),c=this.startSpan(t,s,a),u=At.setSpan(a,c);return ht.with(u,o,void 0,c)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}getActiveSpanProcessor(){return this._tracerProvider.getActiveSpanProcessor()}}function Nn(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))}class yn{constructor(t){this.attributes=t}static empty(){return yn.EMPTY}static default(){return new yn({[fe]:"unknown_service",[ve]:Re[ve],[ge]:Re[ge],[Se]:Re[Se]})}merge(t){if(!t||!Object.keys(t.attributes).length)return this;const e=Object.assign({},this.attributes,t.attributes);return new yn(e)}}yn.EMPTY=new yn({});class wn{constructor(t){this._spanProcessors=t}forceFlush(){const t=[];for(const e of this._spanProcessors)t.push(e.forceFlush());return new Promise((e=>{Promise.all(t).then((()=>{e()})).catch((t=>{Vt(t||new Error("MultiSpanProcessor: forceFlush failed")),e()}))}))}onStart(t,e){for(const n of this._spanProcessors)n.onStart(t,e)}onEnd(t){for(const e of this._spanProcessors)e.onEnd(t)}shutdown(){const t=[];for(const e of this._spanProcessors)t.push(e.shutdown());return new Promise(((e,n)=>{Promise.all(t).then((()=>{e()}),n)}))}}class Pn{onStart(t,e){}onEnd(t){}shutdown(){return Promise.resolve()}forceFlush(){return Promise.resolve()}}var In,Cn;!function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"}(In||(In={}));class Mn{constructor(t={}){var e;this._registeredSpanProcessors=[],this._tracers=new Map;const n=function(...t){let e=t.shift();const n=new WeakMap;for(;t.length>0;)e=Ze(e,t.shift(),0,n);return e}({},fn(),Sn(t));this.resource=null!==(e=n.resource)&&void 0!==e?e:yn.empty(),this.resource=yn.default().merge(this.resource),this._config=Object.assign({},n,{resource:this.resource});const r=this._buildExporterFromEnv();if(void 0!==r){const t=new Rn(r);this.activeSpanProcessor=t}else this.activeSpanProcessor=new Pn}getTracer(t,e,n){const r=`${t}@${e||""}:${(null==n?void 0:n.schemaUrl)||""}`;return this._tracers.has(r)||this._tracers.set(r,new An({name:t,version:e,schemaUrl:null==n?void 0:n.schemaUrl},this._config,this)),this._tracers.get(r)}addSpanProcessor(t){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch((t=>pt.error("Error while trying to shutdown current span processor",t))),this._registeredSpanProcessors.push(t),this.activeSpanProcessor=new wn(this._registeredSpanProcessors)}getActiveSpanProcessor(){return this.activeSpanProcessor}register(t={}){At.setGlobalTracerProvider(this),void 0===t.propagator&&(t.propagator=this._buildPropagatorFromEnv()),t.contextManager&&ht.setGlobalContextManager(t.contextManager),t.propagator&&bt.setGlobalPropagator(t.propagator)}forceFlush(){const t=this._config.forceFlushTimeoutMillis,e=this._registeredSpanProcessors.map((e=>new Promise((n=>{let r;const s=setTimeout((()=>{n(new Error(`Span processor did not completed within timeout period of ${t} ms`)),r=In.timeout}),t);e.forceFlush().then((()=>{clearTimeout(s),r!==In.timeout&&(r=In.resolved,n(r))})).catch((t=>{clearTimeout(s),r=In.error,n(t)}))}))));return new Promise(((t,n)=>{Promise.all(e).then((e=>{const r=e.filter((t=>t!==In.resolved));r.length>0?n(r):t()})).catch((t=>n([t])))}))}shutdown(){return this.activeSpanProcessor.shutdown()}_getPropagator(t){var e;return null===(e=this.constructor._registeredPropagators.get(t))||void 0===e?void 0:e()}_getSpanExporter(t){var e;return null===(e=this.constructor._registeredExporters.get(t))||void 0===e?void 0:e()}_buildPropagatorFromEnv(){const t=Array.from(new Set(ee().OTEL_PROPAGATORS)),e=t.map((t=>{const e=this._getPropagator(t);return e||pt.warn(`Propagator "${t}" requested through environment variable is unavailable.`),e})).reduce(((t,e)=>(e&&t.push(e),t)),[]);return 0===e.length?void 0:1===t.length?e[0]:new Ue({propagators:e})}_buildExporterFromEnv(){const t=ee().OTEL_TRACES_EXPORTER;if("none"===t||""===t)return;const e=this._getSpanExporter(t);return e||pt.error(`Exporter "${t}" requested through environment variable is unavailable.`),e}}Mn._registeredPropagators=new Map([["tracecontext",()=>new je],["baggage",()=>new Mt]]),Mn._registeredExporters=new Map;class Un{constructor(){this._enabled=!1,this._currentContext=v}_bindFunction(t=v,e){const n=this,r=function(...r){return n.with(t,(()=>e.apply(this,r)))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:e.length}),r}active(){return this._currentContext}bind(t,e){return void 0===t&&(t=this.active()),"function"==typeof e?this._bindFunction(t,e):e}disable(){return this._currentContext=v,this._enabled=!1,this}enable(){return this._enabled||(this._enabled=!0,this._currentContext=v),this}with(t,e,n,...r){const s=this._currentContext;this._currentContext=t||v;try{return e.call(n,...r)}finally{this._currentContext=s}}}class Dn extends Mn{constructor(t={}){if(super(t),t.contextManager)throw"contextManager should be defined in register method not in constructor";if(t.propagator)throw"propagator should be defined in register method not in constructor"}register(t={}){void 0===t.contextManager&&(t.contextManager=new Un),t.contextManager&&t.contextManager.enable(),super.register(t)}}let xn;function Bn(t,e){return e in t}function kn(t,e,n){if(Bn(n,e)&&"number"==typeof n[e])return t.addEvent(e,n[e]),t}function Vn(t,e){kn(t,Cn.FETCH_START,e),kn(t,Cn.DOMAIN_LOOKUP_START,e),kn(t,Cn.DOMAIN_LOOKUP_END,e),kn(t,Cn.CONNECT_START,e),kn(t,Cn.SECURE_CONNECTION_START,e),kn(t,Cn.CONNECT_END,e),kn(t,Cn.REQUEST_START,e),kn(t,Cn.RESPONSE_START,e),kn(t,Cn.RESPONSE_END,e);const n=e[Cn.ENCODED_BODY_SIZE];void 0!==n&&t.setAttribute(Ee,n);const r=e[Cn.DECODED_BODY_SIZE];void 0!==r&&n!==r&&t.setAttribute(me,r)}function jn(t,e,n,r,s=new WeakSet,i){const o=Fn(t),a=function(t,e,n,r,s,i){const o=we(e),a=we(n);let c=r.filter((e=>{const n=we(ye(e[Cn.FETCH_START])),r=we(ye(e[Cn.RESPONSE_END]));return e.initiatorType.toLowerCase()===(i||"xmlhttprequest")&&e.name===t&&n>=o&&r<=a}));c.length>0&&(c=c.filter((t=>!s.has(t))));return c}(t=o.toString(),e,n,r,s,i);if(0===a.length)return{mainRequest:void 0};if(1===a.length)return{mainRequest:a[0]};const c=function(t){return t.slice().sort(((t,e)=>{const n=t[Cn.FETCH_START],r=e[Cn.FETCH_START];return n>r?1:n<r?-1:0}))}(a);if(o.origin!==location.origin&&c.length>1){let t=c[0],e=function(t,e,n){const r=we(n),s=we(ye(e));let i,o=t[1];const a=t.length;for(let e=1;e<a;e++){const n=t[e],a=we(ye(n[Cn.FETCH_START])),c=r-we(ye(n[Cn.RESPONSE_END]));a>=s&&(!i||c<i)&&(i=c,o=n)}return o}(c,t[Cn.RESPONSE_END],n);const r=t[Cn.RESPONSE_END];return e[Cn.FETCH_START]<r&&(e=t,t=void 0),{corsPreFlightRequest:t,mainRequest:e}}return{mainRequest:a[0]}}function Fn(t){if("function"==typeof URL)return new URL(t,location.href);const e=(xn||(xn=document.createElement("a")),xn);return e.href=t,e}function Hn(t,e){if(t.nodeType===Node.DOCUMENT_NODE)return"/";const n=function(t,e){const n=t.nodeType,r=function(t){if(!t.parentNode)return 0;const e=[t.nodeType];t.nodeType===Node.CDATA_SECTION_NODE&&e.push(Node.TEXT_NODE);let n=Array.from(t.parentNode.childNodes);if(n=n.filter((n=>{const r=n.localName;return e.indexOf(n.nodeType)>=0&&r===t.localName})),n.length>=1)return n.indexOf(t)+1;return 0}(t);let s="";if(n===Node.ELEMENT_NODE){const n=t.getAttribute("id");if(e&&n)return`//*[@id="${n}"]`;s=t.localName}else if(n===Node.TEXT_NODE||n===Node.CDATA_SECTION_NODE)s="text()";else{if(n!==Node.COMMENT_NODE)return"";s="comment()"}if(s&&r>1)return`/${s}[${r}]`;return`/${s}`}(t,e);if(e&&n.indexOf("@id")>0)return n;let r="";return t.parentNode&&(r+=Hn(t.parentNode,!1)),r+=n,r}function $n(t,e){let n=e||[];("string"==typeof n||n instanceof RegExp)&&(n=[n]);return Fn(t).origin===location.origin||n.some((e=>on(t,e)))}function Gn(t=[]){let e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(Array.isArray(r)){const t=Gn(r);e=e.concat(t.instrumentations)}else"function"==typeof r?e.push(new r):r.instrumentationName&&e.push(r)}return{instrumentations:e}}function Xn(t){const{instrumentations:e}=Gn(t.instrumentations),n=t.tracerProvider||At.getTracerProvider(),r=t.meterProvider||mt.getMeterProvider();return function(t,e,n){for(let r=0,s=t.length;r<s;r++){const s=t[r];e&&s.setTracerProvider(e),n&&s.setMeterProvider(n),s.getConfig().enabled||s.enable()}}(e,n,r),()=>{!function(t){t.forEach((t=>t.disable()))}(e)}}function Yn(t){return"function"==typeof t}!function(t){t.CONNECT_END="connectEnd",t.CONNECT_START="connectStart",t.DECODED_BODY_SIZE="decodedBodySize",t.DOM_COMPLETE="domComplete",t.DOM_CONTENT_LOADED_EVENT_END="domContentLoadedEventEnd",t.DOM_CONTENT_LOADED_EVENT_START="domContentLoadedEventStart",t.DOM_INTERACTIVE="domInteractive",t.DOMAIN_LOOKUP_END="domainLookupEnd",t.DOMAIN_LOOKUP_START="domainLookupStart",t.ENCODED_BODY_SIZE="encodedBodySize",t.FETCH_START="fetchStart",t.LOAD_EVENT_END="loadEventEnd",t.LOAD_EVENT_START="loadEventStart",t.NAVIGATION_START="navigationStart",t.REDIRECT_END="redirectEnd",t.REDIRECT_START="redirectStart",t.REQUEST_START="requestStart",t.RESPONSE_END="responseEnd",t.RESPONSE_START="responseStart",t.SECURE_CONNECTION_START="secureConnectionStart",t.UNLOAD_EVENT_END="unloadEventEnd",t.UNLOAD_EVENT_START="unloadEventStart"}(Cn||(Cn={}));var zn=console.error.bind(console);function Wn(t,e,n){var r=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:r,writable:!0,value:n})}function qn(t){t&&t.logger&&(Yn(t.logger)?zn=t.logger:zn("new logger isn't a function, not replacing"))}function Kn(t,e,n){if(t&&t[e]){if(!n)return zn("no wrapper function"),void zn((new Error).stack);if(Yn(t[e])&&Yn(n)){var r=t[e],s=n(r,e);return Wn(s,"__original",r),Wn(s,"__unwrap",(function(){t[e]===s&&Wn(t,e,r)})),Wn(s,"__wrapped",!0),Wn(t,e,s),s}zn("original object and wrapper must be functions")}else zn("no original function "+e+" to wrap")}function Qn(t,e){return t&&t[e]?t[e].__unwrap?t[e].__unwrap():void zn("no original to unwrap to -- has "+e+" already been unwrapped?"):(zn("no function to unwrap."),void zn((new Error).stack))}qn.wrap=Kn,qn.massWrap=function(t,e,n){if(!t)return zn("must provide one or more modules to patch"),void zn((new Error).stack);Array.isArray(t)||(t=[t]),e&&Array.isArray(e)?t.forEach((function(t){e.forEach((function(e){Kn(t,e,n)}))})):zn("must provide one or more functions to wrap on modules")},qn.unwrap=Qn,qn.massUnwrap=function(t,e){if(!t)return zn("must provide one or more modules to patch"),void zn((new Error).stack);Array.isArray(t)||(t=[t]),e&&Array.isArray(e)?t.forEach((function(t){e.forEach((function(e){Qn(t,e)}))})):zn("must provide one or more functions to unwrap on modules")};var Jn,Zn=qn;class tr extends class{constructor(t,e,n={}){this.instrumentationName=t,this.instrumentationVersion=e,this._wrap=Zn.wrap,this._unwrap=Zn.unwrap,this._massWrap=Zn.massWrap,this._massUnwrap=Zn.massUnwrap,this._config=Object.assign({enabled:!0},n),this._diag=pt.createComponentLogger({namespace:t}),this._tracer=At.getTracer(t,e),this._meter=mt.getMeter(t,e),this._updateMetricInstruments()}get meter(){return this._meter}setMeterProvider(t){this._meter=t.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}_updateMetricInstruments(){}getConfig(){return this._config}setConfig(t={}){this._config=Object.assign({},t)}setTracerProvider(t){this._tracer=t.getTracer(this.instrumentationName,this.instrumentationVersion)}get tracer(){return this._tracer}}{constructor(t,e,n={}){super(t,e,n),this._config.enabled&&this.enable()}}function er(t,e,n){let r,s;try{s=t()}catch(t){r=t}finally{if(e(r,s),r&&!n)throw r;return s}}function nr(t){return"function"==typeof t&&"function"==typeof t.__original&&"function"==typeof t.__unwrap&&!0===t.__wrapped}!function(t){t.METHOD_OPEN="open",t.METHOD_SEND="send",t.EVENT_ABORT="abort",t.EVENT_ERROR="error",t.EVENT_LOAD="loaded",t.EVENT_TIMEOUT="timeout"}(Jn||(Jn={}));var rr;(rr||(rr={})).HTTP_STATUS_TEXT="http.status_text";class sr extends tr{constructor(t){super("@opentelemetry/instrumentation-xml-http-request","0.35.0",t),this.component="xml-http-request",this.version="0.35.0",this.moduleName=this.component,this._tasksCount=0,this._xhrMem=new WeakMap,this._usedResources=new WeakSet}init(){}_getConfig(){return this._config}_addHeaders(t,e){if(!$n(Fn(e).href,this._getConfig().propagateTraceHeaderCorsUrls)){const t={};return bt.inject(ht.active(),t),void(Object.keys(t).length>0&&this._diag.debug("headers inject skipped due to CORS policy"))}const n={};bt.inject(ht.active(),n),Object.keys(n).forEach((e=>{t.setRequestHeader(e,String(n[e]))}))}_addChildSpan(t,e){ht.with(At.setSpan(ht.active(),t),(()=>{const t=this.tracer.startSpan("CORS Preflight",{startTime:e[Cn.FETCH_START]});Vn(t,e),t.end(e[Cn.RESPONSE_END])}))}_addFinalSpanAttributes(t,e,n){if("string"==typeof n){const r=Fn(n);void 0!==e.status&&t.setAttribute(pe,e.status),void 0!==e.statusText&&t.setAttribute(rr.HTTP_STATUS_TEXT,e.statusText),t.setAttribute(de,r.host),t.setAttribute(he,r.protocol.replace(":","")),t.setAttribute(_e,navigator.userAgent)}}_applyAttributesAfterXHR(t,e){const n=this._getConfig().applyCustomAttributesOnSpan;"function"==typeof n&&er((()=>n(t,e)),(t=>{t&&this._diag.error("applyCustomAttributesOnSpan",t)}),!0)}_addResourceObserver(t,e){const n=this._xhrMem.get(t);n&&"function"==typeof PerformanceObserver&&"function"==typeof PerformanceResourceTiming&&(n.createdResources={observer:new PerformanceObserver((t=>{const r=t.getEntries(),s=Fn(e);r.forEach((t=>{"xmlhttprequest"===t.initiatorType&&t.name===s.href&&n.createdResources&&n.createdResources.entries.push(t)}))})),entries:[]},n.createdResources.observer.observe({entryTypes:["resource"]}))}_clearResources(){0===this._tasksCount&&this._getConfig().clearTimingResources&&(ie.clearResourceTimings(),this._xhrMem=new WeakMap,this._usedResources=new WeakSet)}_findResourceAndAddNetworkEvents(t,e,n,r,s){if(!(n&&r&&s&&t.createdResources))return;let i=t.createdResources.entries;i&&i.length||(i=ie.getEntriesByType("resource"));const o=jn(Fn(n).href,r,s,i,this._usedResources);if(o.mainRequest){const t=o.mainRequest;this._markResourceAsUsed(t);const n=o.corsPreFlightRequest;n&&(this._addChildSpan(e,n),this._markResourceAsUsed(n)),Vn(e,t)}}_cleanPreviousSpanInformation(t){const e=this._xhrMem.get(t);if(e){const n=e.callbackToRemoveEvents;n&&n(),this._xhrMem.delete(t)}}_createSpan(t,e,n){if(an(e,this._getConfig().ignoreUrls))return void this._diag.debug("ignoring span as url matches ignored url");const r=`HTTP ${n.toUpperCase()}`,s=this.tracer.startSpan(r,{kind:ot.CLIENT,attributes:{[ue]:n,[le]:Fn(e).toString()}});return s.addEvent(Jn.METHOD_OPEN),this._cleanPreviousSpanInformation(t),this._xhrMem.set(t,{span:s,spanUrl:e}),s}_markResourceAsUsed(t){this._usedResources.add(t)}_patchOpen(){return t=>{const e=this;return function(...n){const r=n[0],s=n[1];return e._createSpan(this,s,r),t.apply(this,n)}}}_patchSend(){const t=this;function e(e,n){const r=t._xhrMem.get(n);if(!r)return;r.status=n.status,r.statusText=n.statusText,t._xhrMem.delete(n),r.span&&t._applyAttributesAfterXHR(r.span,n);const s=Ne(),i=Date.now();setTimeout((()=>{!function(e,n,r,s){const i=n.callbackToRemoveEvents;"function"==typeof i&&i();const{span:o,spanUrl:a,sendStartTime:c}=n;o&&(t._findResourceAndAddNetworkEvents(n,o,a,c,r),o.addEvent(e,s),t._addFinalSpanAttributes(o,n,a),o.end(s),t._tasksCount--),t._clearResources()}(e,r,s,i)}),300)}function n(){e(Jn.EVENT_ERROR,this)}function r(){e(Jn.EVENT_ABORT,this)}function s(){e(Jn.EVENT_TIMEOUT,this)}function i(){this.status<299?e(Jn.EVENT_LOAD,this):e(Jn.EVENT_ERROR,this)}return e=>function(...o){const a=t._xhrMem.get(this);if(!a)return e.apply(this,o);const c=a.span,u=a.spanUrl;return c&&u&&ht.with(At.setSpan(ht.active(),c),(()=>{t._tasksCount++,a.sendStartTime=Ne(),c.addEvent(Jn.METHOD_SEND),this.addEventListener("abort",r),this.addEventListener("error",n),this.addEventListener("load",i),this.addEventListener("timeout",s),a.callbackToRemoveEvents=()=>{!function(e){e.removeEventListener("abort",r),e.removeEventListener("error",n),e.removeEventListener("load",i),e.removeEventListener("timeout",s);const o=t._xhrMem.get(e);o&&(o.callbackToRemoveEvents=void 0)}(this),a.createdResources&&a.createdResources.observer.disconnect()},t._addHeaders(this,u),t._addResourceObserver(this,u)})),e.apply(this,o)}}enable(){this._diag.debug("applying patch to",this.moduleName,this.version),nr(XMLHttpRequest.prototype.open)&&(this._unwrap(XMLHttpRequest.prototype,"open"),this._diag.debug("removing previous patch from method open")),nr(XMLHttpRequest.prototype.send)&&(this._unwrap(XMLHttpRequest.prototype,"send"),this._diag.debug("removing previous patch from method send")),this._wrap(XMLHttpRequest.prototype,"open",this._patchOpen()),this._wrap(XMLHttpRequest.prototype,"send",this._patchSend())}disable(){this._diag.debug("removing patch from",this.moduleName,this.version),this._unwrap(XMLHttpRequest.prototype,"open"),this._unwrap(XMLHttpRequest.prototype,"send"),this._tasksCount=0,this._xhrMem=new WeakMap,this._usedResources=new WeakSet}}var ir;!function(t){t.COMPONENT="component",t.HTTP_ERROR_NAME="http.error_name",t.HTTP_STATUS_TEXT="http.status_text"}(ir||(ir={}));class or extends tr{constructor(t){super("@opentelemetry/instrumentation-fetch","0.35.0",t),this.component="fetch",this.version="0.35.0",this.moduleName=this.component,this._usedResources=new WeakSet,this._tasksCount=0}init(){}_getConfig(){return this._config}_addChildSpan(t,e){const n=this.tracer.startSpan("CORS Preflight",{startTime:e[Cn.FETCH_START]},At.setSpan(ht.active(),t));this._getConfig().ignoreNetworkEvents||Vn(n,e),n.end(e[Cn.RESPONSE_END])}_addFinalSpanAttributes(t,e){const n=Fn(e.url);t.setAttribute(pe,e.status),null!=e.statusText&&t.setAttribute(ir.HTTP_STATUS_TEXT,e.statusText),t.setAttribute(de,n.host),t.setAttribute(he,n.protocol.replace(":","")),t.setAttribute(_e,navigator.userAgent)}_addHeaders(t,e){if(!$n(e,this._getConfig().propagateTraceHeaderCorsUrls)){const t={};return bt.inject(ht.active(),t),void(Object.keys(t).length>0&&this._diag.debug("headers inject skipped due to CORS policy"))}if(t instanceof Request)bt.inject(ht.active(),t.headers,{set:(t,e,n)=>t.set(e,"string"==typeof n?n:String(n))});else if(t.headers instanceof Headers)bt.inject(ht.active(),t.headers,{set:(t,e,n)=>t.set(e,"string"==typeof n?n:String(n))});else{const e={};bt.inject(ht.active(),e),t.headers=Object.assign({},e,t.headers||{})}}_clearResources(){0===this._tasksCount&&this._getConfig().clearTimingResources&&(performance.clearResourceTimings(),this._usedResources=new WeakSet)}_createSpan(t,e={}){if(an(t,this._getConfig().ignoreUrls))return void this._diag.debug("ignoring span as url matches ignored url");const n=(e.method||"GET").toUpperCase(),r=`HTTP ${n}`;return this.tracer.startSpan(r,{kind:ot.CLIENT,attributes:{[ir.COMPONENT]:this.moduleName,[ue]:n,[le]:t}})}_findResourceAndAddNetworkEvents(t,e,n){let r=e.entries;if(!r.length){if(!performance.getEntriesByType)return;r=performance.getEntriesByType("resource")}const s=jn(e.spanUrl,e.startTime,n,r,this._usedResources,"fetch");if(s.mainRequest){const e=s.mainRequest;this._markResourceAsUsed(e);const n=s.corsPreFlightRequest;n&&(this._addChildSpan(t,n),this._markResourceAsUsed(n)),this._getConfig().ignoreNetworkEvents||Vn(t,e)}}_markResourceAsUsed(t){this._usedResources.add(t)}_endSpan(t,e,n){const r=Le(Date.now()),s=Ne();this._addFinalSpanAttributes(t,n),setTimeout((()=>{var n;null===(n=e.observer)||void 0===n||n.disconnect(),this._findResourceAndAddNetworkEvents(t,e,s),this._tasksCount--,this._clearResources(),t.end(r)}),300)}_patchConstructor(){return t=>{const e=this;return function(...n){const r=this,s=Fn(n[0]instanceof Request?n[0].url:n[0]).href,i=n[0]instanceof Request?n[0]:n[1]||{},o=e._createSpan(s,i);if(!o)return t.apply(this,n);const a=e._prepareSpanData(s);function c(t,n){e._applyAttributesAfterFetch(t,i,n),e._endSpan(t,a,{status:n.status||0,statusText:n.message,url:s})}function u(t,n){e._applyAttributesAfterFetch(t,i,n),n.status>=200&&n.status<400?e._endSpan(t,a,n):e._endSpan(t,a,{status:n.status,statusText:n.statusText,url:s})}function l(t,e,n){try{const r=n.clone(),s=n.clone(),i=r.body;if(i){const e=i.getReader(),n=()=>{e.read().then((({done:e})=>{e?u(t,s):n()}),(e=>{c(t,e)}))};n()}else u(t,n)}finally{e(n)}}function d(t,e,n){try{c(t,n)}finally{e(n)}}return new Promise(((n,a)=>ht.with(At.setSpan(ht.active(),o),(()=>(e._addHeaders(i,s),e._tasksCount++,t.apply(r,i instanceof Request?[i]:[s,i]).then(l.bind(r,o,n),d.bind(r,o,a)))))))}}}_applyAttributesAfterFetch(t,e,n){const r=this._getConfig().applyCustomAttributesOnSpan;r&&er((()=>r(t,e,n)),(t=>{t&&this._diag.error("applyCustomAttributesOnSpan",t)}),!0)}_prepareSpanData(t){const e=Ne(),n=[];if("function"!=typeof PerformanceObserver)return{entries:n,startTime:e,spanUrl:t};const r=new PerformanceObserver((e=>{e.getEntries().forEach((e=>{"fetch"===e.initiatorType&&e.name===t&&n.push(e)}))}));return r.observe({entryTypes:["resource"]}),{entries:n,observer:r,startTime:e,spanUrl:t}}enable(){nr(fetch)&&(this._unwrap(Ft,"fetch"),this._diag.debug("removing previous patch for constructor")),this._wrap(Ft,"fetch",this._patchConstructor())}disable(){this._unwrap(Ft,"fetch"),this._usedResources=new WeakSet}}const ar=(t,e,n)=>{const r=t[e];return"function"!=typeof r?r:(Zn.wrap(t,e,n),cr(t[e],r),t[e])},cr=(t,e)=>{const n=e.toString;Object.defineProperty(t,"toString",{enumerable:!1,configurable:!0,writable:!0,value(){return n.call(this===t?e:this)}})},ur=new WeakMap,lr=(t,e)=>ur.set(t,e);var dr,hr,pr,_r,Er,mr,Tr,fr,gr,vr;const Sr=new Map([[[null===(dr=globalThis.XMLHttpRequest)||void 0===dr?void 0:dr.prototype],["abort","error","load","loadend","loadstart","progress","readystatechange","timeout"]],[[null===(hr=globalThis.MessagePort)||void 0===hr?void 0:hr.prototype],["message","messageerror"]],[[null===(pr=globalThis.WebSocket)||void 0===pr?void 0:pr.prototype],["close","error","open","message"]],[[null===(_r=globalThis.Worker)||void 0===_r?void 0:_r.prototype],["error","message"]],[[null===(Er=globalThis.IDBIndex)||void 0===Er?void 0:Er.prototype,null===(mr=globalThis.IDBRequest)||void 0===mr?void 0:mr.prototype,null===(Tr=globalThis.IDBOpenDBRequest)||void 0===Tr?void 0:Tr.prototype,null===(fr=globalThis.IDBDatabase)||void 0===fr?void 0:fr.prototype,null===(gr=globalThis.IDBTransaction)||void 0===gr?void 0:gr.prototype,null===(vr=globalThis.IDBCursor)||void 0===vr?void 0:vr.prototype],["abort","blocked","close","complete","error","success","upgradeneeded","versionchange"]]]),Rr=t=>{const e=new WeakMap,n=(r,s)=>{const i=Object.getOwnPropertyDescriptor(r,s);if(!i){const t=Object.getPrototypeOf(r);if(!t)return;return n(t,s)}ar(i,"get",(t=>function(){var n;const r=null==t?void 0:t.call(this);return null!==(n=e.get(r))&&void 0!==n?n:r})),ar(i,"set",(n=>function(r){let s=null;r&&(s=t.bind(t.active(),r),e.set(s,r)),n.call(this,s)})),Object.defineProperty(r,s,i)},r=new WeakMap;ar(EventTarget.prototype,"addEventListener",(e=>function(...n){const s=n[1];if(s){let e=r.get(s);e||("function"==typeof s?e=t.bind(t.active(),s):s&&"function"==typeof s.handleEvent&&(e=Object.assign(Object.assign({},s),{handleEvent:t.bind(t.active(),s.handleEvent)}))),e&&(r.set(s,e),n[1]=e)}return e.apply(this,n)})),ar(EventTarget.prototype,"removeEventListener",(t=>function(...e){const n=e[1];if(n){const t=r.get(n);t&&(e[1]=t)}return t.apply(this,e)})),Sr.forEach(((t,e)=>{e.forEach((e=>{e&&((t,e)=>{e.forEach((e=>{n(t,`on${e}`)}))})(e,t)}))}))},Or=()=>{const t=(t,e)=>{e.forEach((e=>{((t,e)=>{const n=Object.getOwnPropertyDescriptor(t,e);n&&(Zn.unwrap(n,"get"),Zn.unwrap(n,"set"),Object.defineProperty(t,e,n))})(t,`on${e}`)}))};Zn.unwrap(EventTarget.prototype,"addEventListener"),Zn.unwrap(EventTarget.prototype,"removeEventListener"),Sr.forEach(((e,n)=>{n.forEach((n=>{n&&t(n,e)}))}))},br=t=>{if(!self.MessageChannel||!self.MessagePort)return;const e=new WeakMap;ar(window,"MessageChannel",(t=>class extends t{constructor(...t){super(...t),e.set(this.port1,this.port2),e.set(this.port2,this.port1)}})),ar(MessagePort.prototype,"postMessage",(n=>function(...r){const s=e.get(this);return t.active()&&s&&lr(s,t.active()),n.apply(this,r)}))},Lr=["MutationObserver","IntersectionObserver","ResizeObserver"],Ar=t=>{Lr.forEach((e=>{globalThis[e]&&ar(globalThis,e,(n=>{const r=class extends n{constructor(...e){e[0]=t.bind(t.active(),e[0]),super(...e),setTimeout((()=>{lr(this,v)}),300)}};return Object.defineProperty(r,"name",{enumerable:!1,configurable:!0,writable:!1,value:e}),cr(r,n),r}))}))},Nr=t=>{window.Promise&&ar(window,"Promise",(e=>{const n=class extends e{};return cr(n,e),ar(n.prototype,"then",(e=>function(...n){return n[0]=t.bind(t.active(),n[0]),n[1]=t.bind(t.active(),n[1]),e.apply(this,n)})),ar(n.prototype,"catch",(e=>function(...n){return n[0]=t.bind(t.active(),n[0]),e.apply(this,n)})),ar(n.prototype,"finally",(e=>function(...n){return n[0]=t.bind(t.active(),n[0]),e.apply(this,n)})),n}))},yr=t=>"number"!=typeof t||t<=1500,wr=t=>{ar(window,"setTimeout",(e=>function(...n){return yr(n[1])&&(n[0]=t.bind(t.active(),n[0])),e.apply(this,n)})),ar(window,"setInterval",(e=>function(...n){return yr(n[1])&&(n[0]=t.bind(t.active(),n[0])),e.apply(this,n)})),ar(window,"setImmediate",(e=>function(...n){return n[0]=t.bind(t.active(),n[0]),e.apply(this,n)})),ar(window,"requestAnimationFrame",(e=>function(...n){return n[0]=t.bind(t.active(),n[0]),e.apply(this,n)})),ar(window,"queueMicrotask",(e=>function(...n){return n[0]=t.bind(t.active(),n[0]),e.apply(this,n)}))},Pr=t=>t?(t=>ur.get(t))(t):void 0;var Ir;!function(t){t.COMPONENT="component",t.DOCUMENT_LOAD="documentLoad",t.DOCUMENT_FETCH="documentFetch",t.RESOURCE_FETCH="resourceFetch",t.PAGE_TITLE="page_title"}(Ir||(Ir={}));var Cr,Mr,Ur,Dr,xr,Br=function(t,e){return{name:t,value:void 0===e?-1:e,delta:0,entries:[],id:"v2-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}},kr=function(t,e){try{if(PerformanceObserver.supportedEntryTypes.includes(t)){if("first-input"===t&&!("PerformanceEventTiming"in self))return;var n=new PerformanceObserver((function(t){return t.getEntries().map(e)}));return n.observe({type:t,buffered:!0}),n}}catch(t){}},Vr=function(t,e){var n=function n(r){"pagehide"!==r.type&&"hidden"!==document.visibilityState||(t(r),e&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},jr=function(t){addEventListener("pageshow",(function(e){e.persisted&&t(e)}),!0)},Fr=function(t,e,n){var r;return function(s){e.value>=0&&(s||n)&&(e.delta=e.value-(r||0),(e.delta||void 0===r)&&(r=e.value,t(e)))}},Hr=-1,$r=function(){return"hidden"===document.visibilityState?0:1/0},Gr=function(){Vr((function(t){var e=t.timeStamp;Hr=e}),!0)},Xr=function(){return Hr<0&&(Hr=$r(),Gr(),jr((function(){setTimeout((function(){Hr=$r(),Gr()}),0)}))),{get firstHiddenTime(){return Hr}}},Yr=function(t,e){var n,r=Xr(),s=Br("FCP"),i=function(t){"first-contentful-paint"===t.name&&(a&&a.disconnect(),t.startTime<r.firstHiddenTime&&(s.value=t.startTime,s.entries.push(t),n(!0)))},o=window.performance&&performance.getEntriesByName&&performance.getEntriesByName("first-contentful-paint")[0],a=o?null:kr("paint",i);(o||a)&&(n=Fr(t,s,e),o&&i(o),jr((function(r){s=Br("FCP"),n=Fr(t,s,e),requestAnimationFrame((function(){requestAnimationFrame((function(){s.value=performance.now()-r.timeStamp,n(!0)}))}))})))},zr=!1,Wr=-1,qr={passive:!0,capture:!0},Kr=new Date,Qr=function(t,e){Cr||(Cr=e,Mr=t,Ur=new Date,ts(removeEventListener),Jr())},Jr=function(){if(Mr>=0&&Mr<Ur-Kr){var t={entryType:"first-input",name:Cr.type,target:Cr.target,cancelable:Cr.cancelable,startTime:Cr.timeStamp,processingStart:Cr.timeStamp+Mr};Dr.forEach((function(e){e(t)})),Dr=[]}},Zr=function(t){if(t.cancelable){var e=(t.timeStamp>1e12?new Date:performance.now())-t.timeStamp;"pointerdown"==t.type?function(t,e){var n=function(){Qr(t,e),s()},r=function(){s()},s=function(){removeEventListener("pointerup",n,qr),removeEventListener("pointercancel",r,qr)};addEventListener("pointerup",n,qr),addEventListener("pointercancel",r,qr)}(e,t):Qr(e,t)}},ts=function(t){["mousedown","keydown","touchstart","pointerdown"].forEach((function(e){return t(e,Zr,qr)}))},es={};!function(t){t.FIRST_PAINT="firstPaint",t.FIRST_CONTENTFUL_PAINT="firstContentfulPaint",t.LARGEST_CONTENTFUL_PAINT="largestContentfulPaint",t.CUMULATIVE_LAYOUT_SHIFT="cumulativeLayoutShift",t.FIRST_INPUT_DELAY="firstInputDelay",t.TIME_TO_FIRST_BYTE="timeToFirstByte"}(xr||(xr={}));const ns={FCP:xr.FIRST_CONTENTFUL_PAINT,FID:xr.FIRST_INPUT_DELAY,TTFB:xr.TIME_TO_FIRST_BYTE,LCP:xr.LARGEST_CONTENTFUL_PAINT,CLS:xr.CUMULATIVE_LAYOUT_SHIFT},rs={"first-paint":xr.FIRST_PAINT},ss=new Set([xr.CUMULATIVE_LAYOUT_SHIFT]),is=(t,e)=>{const n={},r=new Set(["FCP","FID","TTFB"]);"chrome"in globalThis&&(r.add("LCP"),r.add("CLS"));let s=!1;const i=()=>{var r,o;if(document.removeEventListener("visibilitychange",i),globalThis.removeEventListener("pagehide",i),!s){const i=null===(o=(r=ie).getEntriesByType)||void 0===o?void 0:o.call(r,"paint");i&&i.forEach((({name:t,startTime:e})=>{Bn(rs,t)&&(n[rs[t]]=e)})),s=!0,Object.entries(n).forEach((([e,n])=>{t[ss.has(e)?"setAttribute":"addEvent"](e,n)})),e()}},o=t=>{r.delete(t.name),n[ns[t.name]]=t.value,r.size||i()};if(document.addEventListener("visibilitychange",i),globalThis.addEventListener("pagehide",i),function(t,e){zr||(Yr((function(t){Wr=t.value})),zr=!0);var n,r=function(e){Wr>-1&&t(e)},s=Br("CLS",0),i=0,o=[],a=function(t){if(!t.hadRecentInput){var e=o[0],r=o[o.length-1];i&&t.startTime-r.startTime<1e3&&t.startTime-e.startTime<5e3?(i+=t.value,o.push(t)):(i=t.value,o=[t]),i>s.value&&(s.value=i,s.entries=o,n())}},c=kr("layout-shift",a);c&&(n=Fr(r,s,e),Vr((function(){c.takeRecords().map(a),n(!0)})),jr((function(){i=0,Wr=-1,s=Br("CLS",0),n=Fr(r,s,e)})))}(o),Yr(o),function(t,e){var n,r=Xr(),s=Br("FID"),i=function(t){t.startTime<r.firstHiddenTime&&(s.value=t.processingStart-t.startTime,s.entries.push(t),n(!0))},o=kr("first-input",i);n=Fr(t,s,e),o&&Vr((function(){o.takeRecords().map(i),o.disconnect()}),!0),o&&jr((function(){var r;s=Br("FID"),n=Fr(t,s,e),Dr=[],Mr=-1,Cr=null,ts(addEventListener),r=i,Dr.push(r),Jr()}))}(o),function(t,e){var n,r=Xr(),s=Br("LCP"),i=function(t){var e=t.startTime;e<r.firstHiddenTime&&(s.value=e,s.entries.push(t),n())},o=kr("largest-contentful-paint",i);if(o){n=Fr(t,s,e);var a=function(){es[s.id]||(o.takeRecords().map(i),o.disconnect(),es[s.id]=!0,n(!0))};["keydown","click"].forEach((function(t){addEventListener(t,a,{once:!0,capture:!0})})),Vr(a,!0),jr((function(r){s=Br("LCP"),n=Fr(t,s,e),requestAnimationFrame((function(){requestAnimationFrame((function(){s.value=performance.now()-r.timeStamp,es[s.id]=!0,n(!0)}))}))}))}}(o),function(t){var e,n=Br("TTFB");e=function(){try{var e=performance.getEntriesByType("navigation")[0]||function(){var t=performance.timing,e={entryType:"navigation",startTime:0};for(var n in t)"navigationStart"!==n&&"toJSON"!==n&&(e[n]=Math.max(t[n]-t.navigationStart,0));return e}();if(n.value=n.delta=e.responseStart,n.value<0||n.value>performance.now())return;n.entries=[e],t(n)}catch(t){}},"complete"===document.readyState?setTimeout(e,0):addEventListener("load",(function(){return setTimeout(e,0)}))}(o),"function"==typeof PerformanceObserver){const t=new PerformanceObserver((()=>{}));if(t.observe({type:"largest-contentful-paint",buffered:!0}),"function"==typeof t.takeRecords){const[e]=t.takeRecords();e&&(r.delete("LCP"),n[xr.LARGEST_CONTENTFUL_PAINT]=e.startTime)}}};class os extends tr{constructor(t={}){super("@opentelemetry/instrumentation-document-load","0.31.0",t),this.component="document-load",this.version="1",this.moduleName=this.component,this._enabled=!1}init(){}_onDocumentLoaded(){window.setTimeout((()=>{this._collectPerformance()}))}_addResourcesSpans(t){var e,n;const r=null===(n=(e=ie).getEntriesByType)||void 0===n?void 0:n.call(e,"resource");r&&r.forEach((e=>{this._initResourceSpan(e,t)}))}_collectPerformance(){const t=Array.from(document.getElementsByTagName("meta")).find((t=>"traceparent"===t.getAttribute("name"))),e=(()=>{var t,e;const n={},r=null===(e=(t=ie).getEntriesByType)||void 0===e?void 0:e.call(t,"navigation")[0];if(r)Object.values(Cn).forEach((t=>{if(Bn(r,t)){const e=r[t];"number"==typeof e&&(n[t]=e)}}));else{const t=ie.timing;t&&Object.values(Cn).forEach((e=>{if(Bn(t,e)){const r=t[e];"number"==typeof r&&(n[e]=r)}}))}return n})(),n=t&&t.content||"";ht.with(bt.extract(v,{traceparent:n}),(()=>{const t=this._startSpan(Ir.DOCUMENT_LOAD,Cn.FETCH_START,e);t&&(ht.with(At.setSpan(ht.active(),t),(()=>{const t=this._startSpan(Ir.DOCUMENT_FETCH,Cn.FETCH_START,e);t&&(t.setAttribute(le,location.href),t.setAttribute(_e,navigator.userAgent),ht.with(At.setSpan(ht.active(),t),(()=>{Vn(t,e),this._endSpan(t,Cn.RESPONSE_END,e)})))})),t.setAttribute(le,location.href),t.setAttribute(_e,navigator.userAgent),t.setAttribute(Ir.PAGE_TITLE,document.title),this._addResourcesSpans(t),kn(t,Cn.FETCH_START,e),kn(t,Cn.UNLOAD_EVENT_START,e),kn(t,Cn.UNLOAD_EVENT_END,e),kn(t,Cn.DOM_INTERACTIVE,e),kn(t,Cn.DOM_CONTENT_LOADED_EVENT_START,e),kn(t,Cn.DOM_CONTENT_LOADED_EVENT_END,e),kn(t,Cn.DOM_COMPLETE,e),kn(t,Cn.LOAD_EVENT_START,e),kn(t,Cn.LOAD_EVENT_END,e),is(t,(()=>{this._endSpan(t,Cn.LOAD_EVENT_END,e)})))}))}_endSpan(t,e,n){t&&(Bn(n,e)?t.end(n[e]):t.end())}_initResourceSpan(t,e){const n=this._startSpan(Ir.RESOURCE_FETCH,Cn.FETCH_START,t,e);n&&(n.setAttribute(le,t.name),Vn(n,t),this._endSpan(n,Cn.RESPONSE_END,t))}_startSpan(t,e,n,r){if(Bn(n,e)&&"number"==typeof n[e]){const s=this.tracer.startSpan(t,{startTime:n[e]},r?At.setSpan(ht.active(),r):void 0);return s.setAttribute(Ir.COMPONENT,this.component),s}}_waitForPageLoad(){"complete"!==window.document.readyState||this._enabled?(this._onDocumentLoaded=this._onDocumentLoaded.bind(this),window.addEventListener("load",this._onDocumentLoaded)):(this._enabled=!0,this._onDocumentLoaded())}enable(){window.removeEventListener("load",this._onDocumentLoaded),this._waitForPageLoad()}disable(){window.removeEventListener("load",this._onDocumentLoaded)}}var as;!function(t){t.COMPONENT="component",t.EVENT_TYPE="event_type",t.TARGET_ELEMENT="target_element",t.TARGET_XPATH="target_xpath",t.HTTP_URL="http.url",t.HTTP_USER_AGENT="http.user_agent"}(as||(as={}));const cs=["click"];function us(){return!1}const ls=()=>`${location.pathname}${location.search}${location.hash}`;class ds extends tr{constructor(t){var e;super("@opentelemetry/instrumentation-user-interaction","0.32.0",t),this.component="user-interaction",this.version="0.32.0",this.moduleName=this.component,this._spansData=new WeakMap,this._isEnabled=!1,this._wrappedListeners=new WeakMap,this._eventsSpanMap=new WeakMap,this._eventNames=new Set(null!==(e=null==t?void 0:t.eventNames)&&void 0!==e?e:cs),this._shouldPreventSpanCreation="function"==typeof(null==t?void 0:t.shouldPreventSpanCreation)?t.shouldPreventSpanCreation:us}init(){}_allowEventName(t){return this._eventNames.has(t)}_createSpan(t,e){if(!(t instanceof HTMLElement))return;if(!t.getAttribute)return;if(t.hasAttribute("disabled"))return;if(!this._allowEventName(e))return;const n=Hn(t,!0);try{const r=this.tracer.startSpan(e,{attributes:{[as.COMPONENT]:this.component,[as.EVENT_TYPE]:e,[as.TARGET_ELEMENT]:t.tagName,[as.TARGET_XPATH]:n,[as.HTTP_URL]:window.location.href,[as.HTTP_USER_AGENT]:navigator.userAgent}},v);if(!0===this._shouldPreventSpanCreation(e,t,r))return;return this._spansData.set(r,{taskCount:0}),r}catch(t){pt.error(this.component,t)}}addPatchedListener(t,e,n,r){let s=this._wrappedListeners.get(n);s||(s=new Map,this._wrappedListeners.set(n,s));let i=s.get(e);return i||(i=new Map,s.set(e,i)),!i.has(t)&&(i.set(t,r),!0)}removePatchedListener(t,e,n){const r=this._wrappedListeners.get(n);if(!r)return;const s=r.get(e);if(!s)return;const i=s.get(t);return i&&(s.delete(t),0===s.size&&(r.delete(e),0===r.size&&this._wrappedListeners.delete(n))),i}_invokeListener(t,e,n){return"function"==typeof t?t.apply(e,n):t.handleEvent(n[0])}_patchAddEventListener(){const t=this;return e=>function(n,r,s){if(!r)return e.call(this,n,r,s);const i=s&&"object"==typeof s&&s.once,o=this,a=function(...e){const s=e[0],a=null==s?void 0:s.target;i&&t.removePatchedListener(o,n,r);const c=s&&t._eventsSpanMap.get(s),u=c||t._createSpan(a,n);if(u){s&&!c&&t._eventsSpanMap.set(s,u);const n=t._spansData.get(u),i=ht.with(At.setSpan(ht.active(),u),(()=>{void 0===n.currentLocation&&(n.currentLocation=ls());const s=t._invokeListener(r,this,e);return n.lastListenerEndHrTime=Ne(),s}));return s&&!c&&setTimeout((()=>{n.currentLocation!==ls()&&t._updateSpanAsNavigation(u),u.end(n.lastListenerEndHrTime)}),200),i}return s instanceof UIEvent&&s.isTrusted?ht.with(v,(()=>t._invokeListener(r,this,e))):t._invokeListener(r,this,e)};return t.addPatchedListener(this,n,r,a)?e.call(this,n,a,s):void 0}}_patchRemoveEventListener(){const t=this;return e=>function(n,r,s){const i=t.removePatchedListener(this,n,r);return i?e.call(this,n,i,s):e.call(this,n,r,s)}}_getPatchableEventTargets(){return window.EventTarget?[EventTarget.prototype]:[Node.prototype,Window.prototype]}_updateSpanAsNavigation(t){t.updateName(`Navigation: ${ls()}`),t.setAttribute("new.location.href",location.href)}enable(){if(this._isEnabled)return;this._isEnabled=!0,pt.debug("applying patch to",this.moduleName,this.version);this._getPatchableEventTargets().forEach((t=>{this._wrap(t,"addEventListener",this._patchAddEventListener()),this._wrap(t,"removeEventListener",this._patchRemoveEventListener())}))}disable(){if(!this._isEnabled)return;this._isEnabled=!1,pt.debug("removing patch from",this.moduleName,this.version);this._getPatchableEventTargets().forEach((t=>{nr(t.addEventListener)&&this._unwrap(t,"addEventListener"),nr(t.removeEventListener)&&this._unwrap(t,"removeEventListener")}))}}function hs(t){return"number"==typeof t?t<=0?ps(t,1e4):t:function(){var t;const e=Number(null!==(t=ee().OTEL_EXPORTER_OTLP_TRACES_TIMEOUT)&&void 0!==t?t:ee().OTEL_EXPORTER_OTLP_TIMEOUT);return e<=0?ps(e,1e4):e}()}function ps(t,e){return pt.warn("Timeout must be greater than 0",t),e}class _s extends Error{constructor(t,e,n){super(t),this.name="OTLPExporterError",this.data=n,this.code=e}}let Es=1/0;var ms,Ts,fs,gs,vs;function Ss(t){return Object.keys(t).map((e=>Rs(e,t[e])))}function Rs(t,e){return{key:t,value:Os(e)}}function Os(t){const e=typeof t;return"string"===e?{stringValue:t}:"number"===e?Number.isInteger(t)?{intValue:t}:{doubleValue:t}:"boolean"===e?{boolValue:t}:t instanceof Uint8Array?{bytesValue:t}:Array.isArray(t)?{arrayValue:{values:t.map(Os)}}:"object"===e&&null!=t?{kvlistValue:{values:Object.entries(t).map((([t,e])=>Rs(t,e)))}}:{}}function bs(t,e){const n=t.spanContext(),r=t.status,s=e?t.parentSpanId:null!=t.parentSpanId?ne(t.parentSpanId):void 0;return{traceId:e?n.traceId:ne(n.traceId),spanId:e?n.spanId:ne(n.spanId),parentSpanId:s,name:t.name,kind:null==t.kind?0:t.kind+1,startTimeUnixNano:we(t.startTime),endTimeUnixNano:we(t.endTime),attributes:Ss(t.attributes),droppedAttributesCount:0,events:t.events.map(Ls),droppedEventsCount:0,status:{code:r.code,message:r.message},links:t.links.map((t=>function(t,e){return{attributes:t.attributes?Ss(t.attributes):[],spanId:e?t.context.spanId:ne(t.context.spanId),traceId:e?t.context.traceId:ne(t.context.traceId),droppedAttributesCount:0}}(t,e))),droppedLinksCount:0}}function Ls(t){return{attributes:t.attributes?Ss(t.attributes):[],name:t.name,timeUnixNano:we(t.time),droppedAttributesCount:0}}function As(t,e){const n=[],r=function(t){const e=new Map;for(const n of t){let t=e.get(n.resource);t||(t=new Map,e.set(n.resource,t));const r=`${n.instrumentationLibrary.name}@${n.instrumentationLibrary.version||""}:${n.instrumentationLibrary.schemaUrl||""}`;let s=t.get(r);s||(s=[],t.set(r,s)),s.push(n)}return e}(t).entries();let s=r.next();for(;!s.done;){const[t,i]=s.value,o=[],a=i.values();let c=a.next();for(;!c.done;){const t=c.value;if(t.length>0){const{name:n,version:r,schemaUrl:s}=t[0].instrumentationLibrary,i=t.map((t=>bs(t,e)));o.push({scope:{name:n,version:r},spans:i,schemaUrl:s})}c=a.next()}const u={resource:{attributes:Ss(t.attributes),droppedAttributesCount:0},scopeSpans:o,schemaUrl:void 0};n.push(u),s=r.next()}return n}!function(t){t[t.SPAN_KIND_UNSPECIFIED=0]="SPAN_KIND_UNSPECIFIED",t[t.SPAN_KIND_INTERNAL=1]="SPAN_KIND_INTERNAL",t[t.SPAN_KIND_SERVER=2]="SPAN_KIND_SERVER",t[t.SPAN_KIND_CLIENT=3]="SPAN_KIND_CLIENT",t[t.SPAN_KIND_PRODUCER=4]="SPAN_KIND_PRODUCER",t[t.SPAN_KIND_CONSUMER=5]="SPAN_KIND_CONSUMER"}(ms||(ms={})),function(t){t[t.DELTA=0]="DELTA",t[t.CUMULATIVE=1]="CUMULATIVE"}(Ts||(Ts={})),function(t){t[t.HISTOGRAM=0]="HISTOGRAM",t[t.EXPONENTIAL_HISTOGRAM=1]="EXPONENTIAL_HISTOGRAM",t[t.GAUGE=2]="GAUGE",t[t.SUM=3]="SUM"}(fs||(fs={})),function(t){t[t.DROP=0]="DROP",t[t.SUM=1]="SUM",t[t.LAST_VALUE=2]="LAST_VALUE",t[t.HISTOGRAM=3]="HISTOGRAM"}(gs||(gs={})),function(t){t.COUNTER="COUNTER",t.HISTOGRAM="HISTOGRAM",t.UP_DOWN_COUNTER="UP_DOWN_COUNTER",t.OBSERVABLE_COUNTER="OBSERVABLE_COUNTER",t.OBSERVABLE_GAUGE="OBSERVABLE_GAUGE",t.OBSERVABLE_UP_DOWN_COUNTER="OBSERVABLE_UP_DOWN_COUNTER"}(vs||(vs={}));class Ns extends class extends class{constructor(t={}){this._sendingPromises=[],this.url=this.getDefaultUrl(t),"string"==typeof t.hostname&&(this.hostname=t.hostname),this.shutdown=this.shutdown.bind(this),this._shutdownOnce=new un(this._shutdown,this),this._concurrencyLimit="number"==typeof t.concurrencyLimit?t.concurrencyLimit:1/0,this.timeoutMillis=hs(t.timeoutMillis),this.onInit(t)}export(t,e){this._shutdownOnce.isCalled?e({code:Me.FAILED,error:new Error("Exporter has been shutdown")}):this._sendingPromises.length>=this._concurrencyLimit?e({code:Me.FAILED,error:new Error("Concurrent export limit reached")}):this._export(t).then((()=>{e({code:Me.SUCCESS})})).catch((t=>{e({code:Me.FAILED,error:t})}))}_export(t){return new Promise(((e,n)=>{try{pt.debug("items to be sent",t),this.send(t,e,n)}catch(t){n(t)}}))}shutdown(){return this._shutdownOnce.call()}_shutdown(){return pt.debug("shutdown started"),this.onShutdown(),Promise.all(this._sendingPromises).then((()=>{}))}}{constructor(t={}){super(t),this._useXHR=!1,this._useXHR=!!t.headers||"function"!=typeof navigator.sendBeacon,this._useXHR?this._headers=Object.assign({},function(t={}){const e={};return Object.entries(t).forEach((([t,n])=>{void 0!==n?e[t]=String(n):pt.warn(`Header "${t}" has wrong value and will be ignored`)})),e}(t.headers),Ct(ee().OTEL_EXPORTER_OTLP_HEADERS)):this._headers={}}onInit(){window.addEventListener("unload",this.shutdown)}onShutdown(){window.removeEventListener("unload",this.shutdown)}send(t,e,n){if(this._shutdownOnce.isCalled)return void pt.debug("Shutdown already started. Cannot send objects");const r=this.convert(t),s=JSON.stringify(r),i=new Promise(((t,e)=>{!this._useXHR&&function(t,e,n){const r=new Blob([t],n);return r.size<Es&&navigator.sendBeacon(e,r)?(pt.debug("sendBeacon - can send",t),!0):(Es=r.size,pt.info("sendBeacon failed because the given payload was too big; try to lower your span processor limits"),!1)}(s,this.url,{type:"application/json"})?t():function(t,e,n,r,s,i){let o;const a=setTimeout((()=>{o=!0,c.abort()}),r),c=new XMLHttpRequest;c.open("POST",e),Object.entries(Object.assign(Object.assign({},{Accept:"application/json","Content-Type":"application/json"}),n)).forEach((([t,e])=>{c.setRequestHeader(t,e)})),c.send(t),c.onreadystatechange=()=>{if(c.readyState===XMLHttpRequest.DONE)if(c.status>=200&&c.status<=299)clearTimeout(a),pt.debug("xhr success",t),s();else if(o){const t=new _s("Request Timeout",c.status);i(t)}else{const t=new _s(`Failed to export with XHR (status: ${c.status})`,c.status);clearTimeout(a),i(t)}}}(s,this.url,this._headers,this.timeoutMillis,t,e)})).then(e,n);this._sendingPromises.push(i);const o=()=>{const t=this._sendingPromises.indexOf(i);this._sendingPromises.splice(t,1)};i.then(o,o)}}{constructor(t={}){super(t),this._headers=Object.assign(this._headers,Ct(ee().OTEL_EXPORTER_OTLP_TRACES_HEADERS))}convert(t){return function(t,e){return{resourceSpans:As(t,e)}}(t,!0)}getDefaultUrl(t){return"string"==typeof t.url?t.url:ee().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT.length>0?function(t){try{const e=new URL(t);return""===e.pathname&&(e.pathname=e.pathname+"/"),e.toString()}catch(e){return pt.warn(`Could not parse export URL: '${t}'`),t}}(ee().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT):ee().OTEL_EXPORTER_OTLP_ENDPOINT.length>0?(e=ee().OTEL_EXPORTER_OTLP_ENDPOINT,n="v1/traces",e.endsWith("/")||(e+="/"),e+n):"http://localhost:4318/v1/traces";var e,n}}class ys{constructor(t){this._exporter=t}export(t,e){const n=(r=Ne(),Math.round(1e3*r[0]+r[1]/1e6));var r;t.forEach((t=>{t.resource.attributes["sumologic.telemetry.sdk.export_timestamp"]=n})),this._exporter.export(t,e)}shutdown(){return Nn(this,void 0,void 0,(function*(){return this._exporter.shutdown()}))}}const ws="object"==typeof document&&null!=document,Ps={visible:"pageshow",hidden:"pagehide"},Is=[];let Cs=ws?null===document||void 0===document?void 0:document.visibilityState:null,Ms=Cs;const Us=()=>{if(!ws)return null;const t=null===document||void 0===document?void 0:document.visibilityState;if(Ms!==t){Ms=t;const e=Ne();Is.push({timestampInNanoseconds:we(e),timestampInHrTime:e,state:t}),Is.length>100&&Is.shift()}};null===document||void 0===document||document.addEventListener("visibilitychange",(()=>{Us()})),null===window||void 0===window||window.addEventListener("pagehide",(()=>{Us()})),null===window||void 0===window||window.addEventListener("pageshow",(()=>{Us()}));const Ds=["click","dblclick","submit","reset","pause","play","dragstart","dragend","drop"];let xs=[],Bs=[];const ks=(t,e,n)=>t+1e7>=e&&t-1e7<=n,Vs=(t,e)=>{t.parentSpanId=e.spanContext().spanId,t.spanContext().traceId=e.spanContext().traceId},js=(t,e)=>{if("@opentelemetry/instrumentation-long-task"===t.instrumentationLibrary.name){if(!t.parentSpanId){const e=(t=>{const e=we(t);for(let t=xs.length-1;t>=0;t-=1){const n=xs[t];if(ks(e,we(n.startTime),we(n.endTime)))return n}})(t.startTime);if(!e)return Bs.push(t),void(Bs.length>10&&Bs.shift());Vs(t,e)}}else xs.push(t),xs.length>100&&xs.shift(),((t,e)=>{const n=we(t.startTime),r=we(t.endTime);for(let s=Bs.length-1;s>=0;s-=1){const i=Bs[s];ks(we(i.startTime),n,r)&&(Bs.splice(s,1),Vs(i,t),e(i))}})(t,e);e(t)},Fs=t=>t.name.startsWith("HTTP ")&&t.kind===ot.CLIENT,Hs=t=>{var e;if(t)return"documentLoad"===(e=t).name&&"@opentelemetry/instrumentation-document-load"===e.instrumentationLibrary.name?"document_loads":t.attributes["xhr.is_root_span"]?(t=>t.name.startsWith("Navigation: ")&&"@opentelemetry/instrumentation-user-interaction"===t.instrumentationLibrary.name)(t)?"route_changes":"xhr_requests":void 0},$s=t=>t.attributes["new.location.href"]||t.attributes["location.href"],Gs={},Xs=[],Ys=new WeakMap,zs=t=>Gs[t.spanContext().traceId],Ws=t=>t.name.startsWith("HTTP ")&&t.kind===ot.CLIENT,qs=t=>"@opentelemetry/instrumentation-long-task"===t.instrumentationLibrary.name,Ks=(t,e)=>{const n=$s(e);t.attributes["root_span.operation"]=e.name,n&&(t.attributes["root_span.http.url"]=n);if(qs(t)){const n=Hs(e);n&&(t.attributes["http.action_type"]=n)}};var Qs;!function(t){t[t.DROP_ROOT_SPAN=0]="DROP_ROOT_SPAN"}(Qs||(Qs={}));const Js=[(t,e,n)=>{if(n.shouldDropSingleUserInteractionTraces&&"@opentelemetry/instrumentation-user-interaction"===t.instrumentationLibrary.name&&1===e.length)return Qs.DROP_ROOT_SPAN},(t,e)=>{const n=e.filter((t=>"@opentelemetry/instrumentation-long-task"===t.instrumentationLibrary.name&&"longtask"===t.name));if(n.length>0){const e=n.map((t=>we(t.duration))).reduce(((t,e)=>t+e),0);t.attributes["http.longtasks_sum"]=e}},(t,e)=>{const n=e.filter(Fs).sort(((t,e)=>we(t.startTime)-we(e.startTime)));if(!n.length)return;const[r]=n,s=n[n.length-1];t.attributes["http.time_to_first_xhr"]=we(r.startTime)-we(t.startTime),t.attributes["http.time_to_last_xhr"]=we(s.endTime)-we(t.startTime);const i=Math.max(...e.map((t=>we(t.endTime))));t.attributes["http.time_to_xhr_processing_end"]=i-we(t.startTime);const o=[];n.forEach((t=>{const e=we(t.startTime),n=we(t.endTime),r=o[o.length-1];!r||e>r[1]?o.push([e,n]):n>r[1]&&(r[1]=n)})),t.attributes["http.time_in_xhr_calls"]=o.reduce(((t,[e,n])=>t+(n-e)),0)}],Zs={},ti="sumoLogicOpenTelemetryRumSessionId",ei=({sessionId:t,lastActivityTimestamp:e})=>{document.cookie=`${ti}=${t}-${e}; path=/`},ni=new class{constructor(){this.generateTraceId=se(16),this.generateSpanId=se(8)}};let ri=(()=>{const t=document.cookie.split("; ").find((t=>t.startsWith(`${ti}=`)));if(!t)return;const[e,n]=t.split("=")[1].split("-");return{sessionId:e,lastActivityTimestamp:parseInt(n,10)}})();const si=()=>{const t=Date.now();if(ri){const e=t-ri.lastActivityTimestamp;e>3e5?ri=void 0:e>3e4&&(ri.lastActivityTimestamp=t,ei(ri))}return ri||(ri={sessionId:ni.generateTraceId(),lastActivityTimestamp:t},ei(ri)),ri.sessionId};class ii extends Rn{constructor(t,e){var n,r;super(t,e),this.shouldCollectSessionId=null===(n=e.collectSessionId)||void 0===n||n,this.shouldDropSingleUserInteractionTraces=null===(r=e.dropSingleUserInteractionTraces)||void 0===r||r,this.getOverriddenServiceName=e.getOverriddenServiceName,this.defaultServiceName=e.defaultServiceName,this.traceProcessor=(t=>{const e=()=>{Object.values(Zs).forEach((t=>{n(t)}))};document.addEventListener("visibilitychange",(()=>{e()})),window.addEventListener("pagehide",(()=>{e()}));const n=({traceId:e,rootSpan:n,send:r,spans:s})=>{if(delete Zs[e],!n||!r)return;let i=!0;Js.forEach((e=>{e(n,s,t)===Qs.DROP_ROOT_SPAN&&(i=!1)})),i&&r()},r=t=>{clearTimeout(t.timeout),t.timeout=setTimeout((()=>{n(t)}),3e4)};return{onStart:(t,e)=>{const n=t.spanContext().traceId;let s=Zs[n];s||(s={traceId:n,timeout:-1,spans:[]},Zs[n]=s),t.parentSpanId||s.rootSpan||(s.rootSpan=t),r(s)},onEnd:(t,e)=>{let n=!0;const s=t,i=s.spanContext().traceId,o=Zs[i];o&&(o.spans.push(s),o.rootSpan===s&&(n=!1,o.send=()=>{e(t)}),r(o)),n&&e(t)}}})(this)}onStart(t,e=v){((t,e)=>{if(!ws)return;null!=Cs&&t.setAttribute("document.visibilityState",Cs);const n=we(t.startTime);for(let e=Is.length-1;e>=0;e-=1){const{timestampInNanoseconds:r,state:s}=Is[e];if(r<=n){t.setAttribute("document.visibilityState",s);break}}})(t),((t,e)=>{const{parentSpanId:n}=t;if(Ws(t)&&n){const e=zs(t);e&&(e.attributes["xhr.is_root_span"]=!0)}if(!n){const{traceId:e}=t.spanContext();if(Gs[e]=t,Xs.push(e),Xs.length>50){const t=Xs.shift();delete Gs[t]}}})(t),this.traceProcessor.onStart(t,e),this.shouldCollectSessionId&&((t,e)=>{t.setAttribute("rum.session_id",si())})(t),((t,e,n)=>{var r;const s=null===(r=null==n?void 0:n.getOverriddenServiceName)||void 0===r?void 0:r.call(n,t);void 0!==s&&(t.setAttribute(fe,s),t.setAttribute("default.service.name",n.defaultServiceName))})(t,0,{getOverriddenServiceName:this.getOverriddenServiceName,defaultServiceName:this.defaultServiceName}),t.setAttribute("location.href",location.href),super.onStart(t,e)}onEnd(t){(t=>{const e=t,n=we(e.startTime),r=t.parentSpanId?we(e.endTime):1/0;for(let t=Is.length-1;t>=0;t-=1){const{timestampInNanoseconds:s,timestampInHrTime:i,state:o}=Is[t];if(s<n)break;s>=n&&s<=r&&(e.events.push({name:Ps[o],attributes:void 0,time:i}),"hidden"===o&&(e.attributes["document.visibilityState"]=o))}})(t),js(t,(t=>{(t=>{const e=t,n=Ys.get(e);n&&n.forEach((t=>Ks(t,e)));const r=Ws(e),s=qs(e);if(t.parentSpanId&&(r||s)){const t=zs(e);if(t&&(Ks(e,t),!t.ended)){const n=Ys.get(t);n?n.push(e):Ys.set(t,[e])}}})(t),this.traceProcessor.onEnd(t,(t=>{super.onEnd(t)}))}))}}class oi extends tr{constructor(t={}){super("@opentelemetry/instrumentation-long-task","0.32.0",t),this.component="long-task",this.version="0.32.0",this.moduleName=this.component}init(){}isSupported(){return!("undefined"==typeof PerformanceObserver||!PerformanceObserver.supportedEntryTypes)&&PerformanceObserver.supportedEntryTypes.includes("longtask")}_createSpanFromEntry(t){const e=this.tracer.startSpan("longtask",{startTime:Ne(t.startTime)});if(this._config.observerCallback)try{this._config.observerCallback(e,{longtaskEntry:t})}catch(t){pt.error("longtask instrumentation: observer callback failed",t)}e.setAttribute("component",this.component),e.setAttribute("http.url",location.href),e.setAttribute("longtask.name",t.name),e.setAttribute("longtask.entry_type",t.entryType),e.setAttribute("longtask.duration",t.duration),Array.isArray(t.attribution)&&t.attribution.forEach(((n,r)=>{const s=t.attribution.length>1?`longtask.attribution[${r}]`:"longtask.attribution";e.setAttribute(`${s}.name`,n.name),e.setAttribute(`${s}.entry_type`,n.entryType),e.setAttribute(`${s}.start_time`,n.startTime),e.setAttribute(`${s}.duration`,n.duration),e.setAttribute(`${s}.container_type`,n.containerType),e.setAttribute(`${s}.container_src`,n.containerSrc),e.setAttribute(`${s}.container_id`,n.containerId),e.setAttribute(`${s}.container_name`,n.containerName)})),e.end(Ne(t.startTime+t.duration))}enable(){this.isSupported()?this._observer||(this._observer=new PerformanceObserver((t=>{t.getEntries().forEach((t=>this._createSpanFromEntry(t)))})),this._observer.observe({type:"longtask",buffered:!0})):this._diag.debug("Environment not supported")}disable(){this._observer&&(this._observer.disconnect(),this._observer=void 0)}}var ai;!function(t){t[t.SEVERITY_NUMBER_UNSPECIFIED=0]="SEVERITY_NUMBER_UNSPECIFIED",t[t.SEVERITY_NUMBER_TRACE=1]="SEVERITY_NUMBER_TRACE",t[t.SEVERITY_NUMBER_TRACE2=2]="SEVERITY_NUMBER_TRACE2",t[t.SEVERITY_NUMBER_TRACE3=3]="SEVERITY_NUMBER_TRACE3",t[t.SEVERITY_NUMBER_TRACE4=4]="SEVERITY_NUMBER_TRACE4",t[t.SEVERITY_NUMBER_DEBUG=5]="SEVERITY_NUMBER_DEBUG",t[t.SEVERITY_NUMBER_DEBUG2=6]="SEVERITY_NUMBER_DEBUG2",t[t.SEVERITY_NUMBER_DEBUG3=7]="SEVERITY_NUMBER_DEBUG3",t[t.SEVERITY_NUMBER_DEBUG4=8]="SEVERITY_NUMBER_DEBUG4",t[t.SEVERITY_NUMBER_INFO=9]="SEVERITY_NUMBER_INFO",t[t.SEVERITY_NUMBER_INFO2=10]="SEVERITY_NUMBER_INFO2",t[t.SEVERITY_NUMBER_INFO3=11]="SEVERITY_NUMBER_INFO3",t[t.SEVERITY_NUMBER_INFO4=12]="SEVERITY_NUMBER_INFO4",t[t.SEVERITY_NUMBER_WARN=13]="SEVERITY_NUMBER_WARN",t[t.SEVERITY_NUMBER_WARN2=14]="SEVERITY_NUMBER_WARN2",t[t.SEVERITY_NUMBER_WARN3=15]="SEVERITY_NUMBER_WARN3",t[t.SEVERITY_NUMBER_WARN4=16]="SEVERITY_NUMBER_WARN4",t[t.SEVERITY_NUMBER_ERROR=17]="SEVERITY_NUMBER_ERROR",t[t.SEVERITY_NUMBER_ERROR2=18]="SEVERITY_NUMBER_ERROR2",t[t.SEVERITY_NUMBER_ERROR3=19]="SEVERITY_NUMBER_ERROR3",t[t.SEVERITY_NUMBER_ERROR4=20]="SEVERITY_NUMBER_ERROR4",t[t.SEVERITY_NUMBER_FATAL=21]="SEVERITY_NUMBER_FATAL",t[t.SEVERITY_NUMBER_FATAL2=22]="SEVERITY_NUMBER_FATAL2",t[t.SEVERITY_NUMBER_FATAL3=23]="SEVERITY_NUMBER_FATAL3",t[t.SEVERITY_NUMBER_FATAL4=24]="SEVERITY_NUMBER_FATAL4"}(ai||(ai={}));const ci=t=>{switch(typeof t){case"number":return Number.isInteger(t)?{intValue:t}:{doubleValue:t};case"boolean":return{boolValue:t};case"object":if(Array.isArray(t))return{arrayValue:{values:t.map((t=>ci(t)))}};if(null!=t)return{kvlistValue:{values:Object.entries(t).map((([t,e])=>ui(t,e)))}};default:return{stringValue:String(t)}}},ui=(t,e)=>({key:t,value:ci(e)}),li=t=>Object.entries(t).map((([t,e])=>ui(t,e)));let di=1/0;class hi{constructor({resource:t,attributes:e,collectorUrl:n,maxQueueSize:r,scheduledDelayMillis:s}){this.onVisibilityChange=()=>{"hidden"===(null===document||void 0===document?void 0:document.visibilityState)&&this.export()},this.onPageHide=()=>{this.export()},this.recordCustomError=(t,e)=>{this.recordLog({type:"customError",message:t,attributes:e})},this.resource=t,this.defaultAttributes=e,this.collectorUrl=n,this.maxQueueSize=r,this.scheduledDelayMillis=s,this.logs=[]}enable(){null!=document&&(this.disable(),document.addEventListener("visibilitychange",this.onVisibilityChange),document.addEventListener("pagehide",this.onPageHide))}disable(){document.removeEventListener("visibilitychange",this.onVisibilityChange),document.removeEventListener("pagehide",this.onPageHide)}exportWhenNeeded(){this.logs.length>=this.maxQueueSize?this.export():void 0===this.timer&&(this.timer=Number(setTimeout((()=>this.export()),this.scheduledDelayMillis)))}recordLog(t){var e;const n=[...li(this.defaultAttributes),ui("type",t.type),ui("http.url",location.href)],r=At.getSpan(ht.active());if(r&&(t=>"name"in t&&"instrumentationLibrary"in t)(r)){const t=null===(e=(t=>{const e=Zs[t];if(e){const{rootSpan:t,spans:n}=e;return{rootSpan:t,spans:n}}})(r.spanContext().traceId))||void 0===e?void 0:e.rootSpan;if(t){n.push(ui("root_span.operation",t.name));const e=$s(t);e&&n.push(ui("root_span.http.url",e));const r=Hs(t);r&&n.push(ui("http.action_type",r))}}t.element&&n.push(ui("element.xpath",t.element.xpath)),t.error&&(n.push(ui("error.name",t.error.name)),n.push(ui("error.message",t.error.message)),t.error.stack&&n.push(ui("error.stack",t.error.stack))),t.arguments&&n.push(ui("arguments",t.arguments)),t.attributes&&Object.entries(t.attributes).forEach((([t,e])=>{n.push(ui(t,e))})),this.logs.push({timeUnixNano:we(Ne()),severityNumber:ai.SEVERITY_NUMBER_ERROR,body:{stringValue:t.message},attributes:n,droppedAttributesCount:0,traceId:null==r?void 0:r.spanContext().traceId,spanId:null==r?void 0:r.spanContext().spanId}),this.exportWhenNeeded()}export(){clearTimeout(this.timer),this.timer=void 0;const{logs:t}=this;if(!t.length)return;this.logs=[];const e=JSON.stringify({resourceLogs:[{resource:{attributes:li(this.resource.attributes)},instrumentationLibraryLogs:[{instrumentationLibrary:{name:"@sumologic/opentelemetry-rum",version:"4.3.0"},logs:t}]}]});((t,e)=>{const n=new Blob([e],{type:"application/json"});(n.size>=di||!navigator.sendBeacon(t,n))&&(di=n.size,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:e}))})(this.collectorUrl,e)}}const pi=(t,e)=>t.length>e?`${t.slice(0,e)}...`:t,_i=t=>t instanceof Error?{name:t.name,message:t.message,stack:t.stack?pi(t.stack,5e3):void 0}:void 0,Ei=(t,e=0)=>{if("string"==typeof t){const n=pi(t,500);return e>0?`"${n}"`:n}return Array.isArray(t)?e>0?"...":`[${t.map((t=>Ei(t,e+1))).join(", ")}]`:t instanceof Error?Ei({name:t.name,message:t.message},e):null!=t&&"object"==typeof t?e>0?"...":`{ ${Object.getOwnPropertyNames(t).map((n=>`${n}: ${Ei(t[n],e+1)}`)).join(", ")} }`:String(t)},mi=(t,e=new Set)=>{const n=!e.has(t);if(e.add(t),Array.isArray(t))return t.map((t=>mi(t,e)));if(null!=t&&"object"==typeof t){const r={};return Object.getOwnPropertyNames(t).forEach((s=>{const i=t[s];r[s]=e.has(i)&&(i!==t||n)?"[Circular]":mi(i)})),r}return t};class Ti{constructor({exporter:t}){this.isEnabled=!1,this.onError=t=>{this.exporter.recordLog({type:"uncaughtException",message:t.message,error:_i(t.error)})},this.onUnhandledRejection=({reason:t})=>{if(!t)return;const e=_i(t);this.exporter.recordLog({type:"unhandledRejection",message:e?`Unhandled rejection ${t}`:String(t),error:e})},this.onDocumentError=({target:t})=>{if(!t)return;const e=Hn(t);e&&this.exporter.recordLog({type:"documentError",message:`Uncaught error in element ${e}`,element:{xpath:e}})},this.onConsoleError=t=>{const e=t.find(_i),n=t.length>3||t.find((t=>null!=t&&"object"==typeof t&&!(t instanceof Error)))?t.map((t=>mi(t))):void 0;this.exporter.recordLog({type:"consoleError",message:t.map((t=>Ei(t))).join(" "),arguments:n,error:e})},this.exporter=t;const e=console.error;console.error=(...t)=>{this.isEnabled&&this.onConsoleError(t),e.apply(console,t)}}enable(){this.disable(),window.addEventListener("error",this.onError),window.addEventListener("unhandledrejection",this.onUnhandledRejection),document.documentElement.addEventListener("error",this.onDocumentError,{capture:!0}),this.isEnabled=!0}disable(){window.removeEventListener("error",this.onError),window.removeEventListener("unhandledrejection",this.onUnhandledRejection),document.documentElement.removeEventListener("error",this.onDocumentError,{capture:!0}),this.isEnabled=!1}}const fi=t=>"number"==typeof t?t:null!=t&&Number.isFinite(+t)?+t:void 0;var gi;const vi="object"==typeof window&&null!=window,Si="object"==typeof document&&null!=document;vi&&(window.sumoLogicOpenTelemetryRum=window.sumoLogicOpenTelemetryRum||{});const Ri=new class{constructor(){this._enabled=!1,this._currentContext=v}_bindFunction(t=v,e){const n=this,r=function(...r){var s;return n.with(null!==(s=Pr(this))&&void 0!==s?s:t,(()=>e.apply(this,r)))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:e.length}),r}active(){return this._currentContext}bind(t=this.active(),e){return"function"==typeof e?this._bindFunction(t,e):e}disable(){return this._enabled?(Zn.unwrap(window,"Promise"),Zn.unwrap(window,"setTimeout"),Zn.unwrap(window,"setInterval"),null!=window.setImmediate&&Zn.unwrap(window,"setImmediate"),Zn.unwrap(window,"requestAnimationFrame"),null!=window.queueMicrotask&&Zn.unwrap(window,"queueMicrotask"),Or(),self.MessageChannel&&self.MessagePort&&(Zn.unwrap(window,"MessageChannel"),Zn.unwrap(MessagePort.prototype,"postMessage")),Lr.forEach((t=>{globalThis[t]&&Zn.unwrap(globalThis,t)})),this._currentContext=v,this._enabled=!1,this):this}enable(){return this._enabled||(Nr(this),wr(this),Rr(this),br(this),Ar(this),this._enabled=!0,this._currentContext=v),this}with(t,e,n,...r){const s=this._currentContext;this._currentContext=null!=t?t:v;try{return e.apply(n,r)}finally{this._currentContext=s}}};Ri.enable();const Oi=({collectionSourceUrl:t,authorizationToken:e,serviceName:n,applicationName:r,deploymentEnvironment:s,defaultAttributes:i,samplingProbability:o=1,bufferMaxSpans:a=2048,maxExportBatchSize:c=50,bufferTimeout:u=2e3,ignoreUrls:l=[],propagateTraceHeaderCorsUrls:d=[],collectSessionId:h,dropSingleUserInteractionTraces:p,collectErrors:_=!0,userInteractionElementNameLimit:E=20,getOverriddenServiceName:m})=>{var T;if(!t)throw new Error("collectionSourceUrl needs to be defined to initialize Sumo Logic OpenTelemetry RUM");const f=null!==(T=fi(o))&&void 0!==T?T:1,g=null!=n?n:"unknown",v={[fe]:g,"sumologic.rum.version":"4.3.0"};r&&(v.application=r),s&&(v[Te]=s);const S=new yn(v),R=S.merge(new yn(Object.assign(Object.assign({},i),{"sampling.probability":f}))),O=new Dn({resource:R,sampler:new En(f)});O.register({contextManager:Ri,propagator:new je});const b=Object.assign({},i),L=(t=>{const e=new URL(t);return e.pathname=e.pathname.replace(/\/v1\/(traces|metrics|logs)\/?$/,""),e.pathname.endsWith("/")||(e.pathname+="/"),e.href})(t),A=new Ns({url:`${L}v1/traces`,headers:e?{Authorization:e}:void 0}),N=new ys(A);O.addSpanProcessor(new ii(N,{maxQueueSize:a,maxExportBatchSize:c,scheduledDelayMillis:u,collectSessionId:h,dropSingleUserInteractionTraces:p,getOverriddenServiceName:m,defaultServiceName:g}));const y=S.merge(new yn({[_e]:navigator.userAgent})),w=new hi({resource:y,attributes:b,collectorUrl:`${L}v1/logs`,maxQueueSize:a,scheduledDelayMillis:u}),P=_?new Ti({exporter:w}):void 0;let I;const C=()=>{I&&(I(),null==P||P.disable(),w.disable(),I=void 0)},M=(e=!0)=>{C(),w.enable(),null==P||P.enable(),I=Xn({tracerProvider:O,instrumentations:[new oi({enabled:!1}),...e?[new os({enabled:!1})]:[],new ds({enabled:!1,eventNames:Ds,shouldPreventSpanCreation:(t,e,n)=>{const r=((t,e,n)=>{var r;let s="",i=e;for(;i&&!s;)s=i.getAttribute("aria-label")||i.id||i.textContent||"",s=s.trim(),i=i.parentElement;if(s){const e=null!==(r=fi(n))&&void 0!==r?r:20;return e>0&&s.length>e&&(s=`${s.slice(0,e-3)}...`),`${t} on '${s}'`}})(t,e,E);return r&&n.updateName(r),!1}}),new sr({enabled:!1,propagateTraceHeaderCorsUrls:d,ignoreUrls:[t,...l]}),new or({enabled:!1,propagateTraceHeaderCorsUrls:d,ignoreUrls:l})]})},U=O.getTracer("@sumologic/opentelemetry-rum");M(Si);const D={readyListeners:[],onReady:t=>{t()},api:yt,tracer:U,registerInstrumentations:M,disableInstrumentations:C,setDefaultAttribute:(t,e)=>{O.resource.attributes[t]=e,b[t]=e},getCurrentSessionId:si,recordError:w.recordCustomError};return vi&&Object.assign(window.sumoLogicOpenTelemetryRum,D),D};if(vi){window.sumoLogicOpenTelemetryRum.initialize=Oi;const t=null===(gi=window.sumoLogicOpenTelemetryRum)||void 0===gi?void 0:gi.readyListeners;Array.isArray(t)&&t.forEach((t=>t()))}const bi=t=>{if(t)try{return JSON.parse(t)}catch(t){return}},Li=t=>{var e;return null===(e=bi(t)||(t=>{if("string"==typeof t)return t.split(",").map((t=>t.trim()))})(t))||void 0===e?void 0:e.map((t=>new RegExp(t)))};if("object"==typeof document&&null!=document&&document.currentScript&&document.currentScript.dataset.collectionSourceUrl){const{collectionSourceUrl:t,authorizationToken:e,serviceName:n,applicationName:r,defaultAttributes:s,samplingProbability:i,bufferMaxSpans:o,bufferTimeout:a,ignoreUrls:c,propagateTraceHeaderCorsUrls:u}=document.currentScript.dataset;window.opentelemetry=Oi({collectionSourceUrl:t,authorizationToken:e,serviceName:n,applicationName:r,defaultAttributes:bi(s),samplingProbability:fi(i),bufferMaxSpans:fi(o),bufferTimeout:fi(a),ignoreUrls:Li(c),propagateTraceHeaderCorsUrls:Li(u)||[/.*/]})}exports.initialize=Oi;
